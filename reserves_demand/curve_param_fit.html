<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>reserves_demand.curve_param_fit API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../reserves_demand.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;reserves_demand</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#CurveParamFit">CurveParamFit</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CurveParamFit.__init__">CurveParamFit</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveParamFit.varselect_result">varselect_result</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveParamFit.best_curves_params">best_curves_params</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.cross_validate">cross_validate</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.variable_select">variable_select</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.indep_vars_occurence">indep_vars_occurence</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.fit_best_curves">fit_best_curves</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.compare_best_curves">compare_best_curves</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.predict_best_curve">predict_best_curve</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.most_probable_value">most_probable_value</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.plot_x_y">plot_x_y</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveParamFit.plot_curve_with_confidence_interval">plot_curve_with_confidence_interval</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../reserves_demand.html">reserves_demand</a><wbr>.curve_param_fit    </h1>

                
                        <input id="mod-curve_param_fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-curve_param_fit-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">reserves_demand.utils</span> <span class="kn">import</span> <span class="n">evaluate_metrics</span><span class="p">,</span> <span class="n">perf_metrics</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>    
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span> 
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="k">class</span> <span class="nc">CurveParamFit</span><span class="p">:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    Class to fit a curve to a dataset using a variety of curve types.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    The class uses a cross-validated approach to select the best curve type and the best set of variables.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    The class supports the following curve types:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        - Logistic</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        - Reduced Logistic</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        - Fixed Logistic</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        - Double Exponential</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        - Exponential</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        - Fixed Exponential</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        - Arctan</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        - Linear</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    Parameters</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    ----------</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            The dataset containing the dependent and independent variables.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        dep_var : str</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">            The name of the dependent variable.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        main_indep_var : str</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">            The name of the main independent variable.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        dep_var_name : str, optional</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">            The name of the dependent variable for plotting. Default is None.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        main_indep_var_name : str, optional</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">            The name of the main independent variable for plotting. Default is None.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        constant : bool, optional</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">            Whether to include a constant column in the independent variables. Default is True.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        curves : list, optional</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">            The list of curve types to consider. Default is None.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        Q : float, optional</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">            The confidence level for the confidence interval. Default is 0.9.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        nFolds : int, optional</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            The number of folds for cross-validation. Default is 5.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        parallel : bool, optional</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">            Whether to run cross-validation in parallel. Default is False.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        search_method : str, optional</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">            The method to use for variable selection. Default is &#39;backward&#39;. Available options are </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">            - backward: Backward elimination removing variables that are not improving the prediction accuracy</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">            - forward: Forward selection, adding variables only if they increase predictive power</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">            - all_combinations: Exhaustive search testing all variable combinations and selecting the best</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    </span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    Methods:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    --------</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        cross_validate(curvename, on=&#39;RMSE&#39;)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">            Performs cross-validation to find the best combination of variables for the specified curve type.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        variable_select(on=&#39;RMSE&#39;, verbose=True, plot=True)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">            Performs variable selection for each curve type and returns the best curve based on the specified metric.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        indep_vars_occurence(normalize=True, plot=True, title=&#39;&#39;)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">            Gives the number of occurrences of each independent variable in the best combinations of variables for each curve.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        fit_best_curves()</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            Fits the best curve for each curve type based on the selected variables.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        compare_best_curves(plot=True, CI = True)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">            Compares the best curves for each curve type based on the performance metrics.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        predict_best_curve(curvename, X=None)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            Predicts the dependent variable using the best curve for the specified curve type.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        most_probable_value(curvename, known_value, verbose=True)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">            Estimates the most probable value of a dependent or independent variable using a fitted curve.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        plot_x_y(title =&#39;&#39;)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">            Plots the dependent variable y against all the independent variables x.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        plot_curve_with_confidence_interval(ypred, yqlb=None, yqub=None, ax = None, title =&#39;&#39;)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            Plots the fitted curve along with the confidence interval.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    Attributes:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    -----------</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        varselect_result : pd.DataFrame</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">            The performance metrics for each curve type.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        best_curves_params : dict</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            The parameters for each curve type.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    Example:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    --------</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    ```python</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    import pandas as pd</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    from reserves_demand.curve_param_fit import CurveParamFit</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">    # Load the dataset</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    data = pd.read_csv(&#39;../data/reserve_demand_cruve_data.csv&#39;)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">    # Initialize the CurveParamFit object</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    curve_fit = CurveParamFit(</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">                data = dat, </span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">                dep_var = &#39;Normalized&#39;,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">                main_indep_var= &#39;excess_reserve&#39;,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">                dep_var_name= &#39;Normalized Overnight Rate&#39;,                 </span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">                main_indep_var_name= &#39;Excess Reserve&#39;,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">            )</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    # Perform variable selection for each curve</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    best_curve, varselect_result = curve_fit.variable_select(on=&#39;RMSE&#39;, verbose=True, plot=True)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    # Fit the best curves</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">    best_curves_params = curve_fit.fit_best_curves()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">    # Compare the best curves</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">    perf_metrics_df, predictions_df, param_df = curve_fit.compare_best_curves()</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">    # Predict the dependent variable using the best curve</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">    predictions = curve_fit.predict_best_curve(best_curve)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">    # Estimate the most probable value of a variable</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">    known_value = (&#39;Normalized&#39;, 100)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">    most_probable_value = curve_fit.most_probable_value(best_curve, known_value)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">    ```</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    &quot;&quot;&quot;</span>   
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                 <span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                 <span class="n">curves</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                 <span class="n">nFolds</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                 <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                 <span class="n">search_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>                 <span class="p">):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Q should be between 0 and 1 for valid confidence intervals&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">assert</span> <span class="n">nFolds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;nFolds must be greater than 1 for cross-validation&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">assert</span> <span class="n">search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">],</span> <span class="s2">&quot;search_method must be &#39;backward&#39;, &#39;forward&#39;, or &#39;all_combinations&#39;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="c1"># add constant column if requested</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span> <span class="o">=</span> <span class="n">Q</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span> <span class="o">=</span> <span class="n">parallel</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">=</span> <span class="n">search_method</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">curves</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logistic</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redLogistic</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixLogistic</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doubleExp</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exponential</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixExponential</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arctan</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="p">}</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">param_names</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="c1"># Names of parameters for each curve type</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">],</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">],</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="p">}</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">init_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="c1"># Initial parameters for each curve type</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">]),</span> 
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="p">}</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="k">if</span> <span class="n">curves</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="n">curves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">curves</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">param_names</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">init_params</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies the specified curve function to the input data x.&quot;&quot;&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">assert</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">:]</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gX</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">[</span><span class="n">curvename</span><span class="p">](</span><span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the quantile loss for curve fitting.&quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">ypred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ypred</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">_curveOpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">winit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optimizes the curve parameters for the given data and curve type.&quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="k">assert</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type: </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="c1"># Initial parameters setup</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="n">winit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">M</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">xinit</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">winit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">],</span> <span class="n">xinit</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">winit</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Invalid initial parameters&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="c1"># Use minimize for other cases</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loss</span><span class="p">,</span> <span class="n">winit</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization failed for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2"> curve with message: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="n">popt</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="k">def</span> <span class="nf">_run_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes a single fold of cross-validation for the given columns and curve.&quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">][</span><span class="n">columns</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="c1"># Fit the model using the specified curve type and predict on both training and testing sets</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="c1"># The ross validation is chosen on the mean absolute error loss q=0.5</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="c1"># Evaluate and return performance metrics for both sets</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">_run_cv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs cross-validation for the specified columns subset and curve type.&quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="c1"># Initialize lists to store metrics for all folds</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">train_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">test_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_fold</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                        <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="c1"># Collect results as they complete</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                    <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                    <span class="n">train_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                    <span class="n">test_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_metrics</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_fold</span><span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="n">train_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                <span class="n">test_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_metrics</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="c1"># Convert lists of Series to DataFrames and compute mean for each metric</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="n">train_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_metrics_list</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="n">test_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_metrics_list</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="n">train_metrics_mean</span> <span class="o">=</span> <span class="n">train_metrics_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">validation_metrics_mean</span> <span class="o">=</span> <span class="n">test_metrics_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">train_metrics_mean</span><span class="p">,</span> <span class="n">validation_metrics_mean</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">_find_best_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds the best combination of columns based on the specified performance metric for a specific curve type.&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">validation_metrics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                <span class="n">future_to_comb</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">,</span> <span class="n">comb</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span> <span class="n">comb</span> <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">}</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; it&quot;</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_comb</span><span class="p">):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                    <span class="n">comb</span> <span class="o">=</span> <span class="n">future_to_comb</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                        <span class="n">train_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>                        
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Combination </span><span class="si">{</span><span class="n">comb</span><span class="si">}</span><span class="s1"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                    <span class="k">finally</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                        <span class="c1"># Update progress bar by one step for each completed task</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                        <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>            
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">combinations</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                <span class="n">train_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">(</span><span class="n">comb</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                 
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="c1"># Select the combination with the best (minimum) specified validation metric</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="k">if</span> <span class="n">validation_metrics</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">on</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="k">for</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">validation_metrics</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">validation_metrics</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">on</span><span class="p">])</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="n">train_metrics</span><span class="p">[</span><span class="n">best_combination</span><span class="p">],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="n">best_combination</span><span class="p">]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_combination</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The metric &#39;</span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">&#39; is not found in the validation metrics&quot;</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">):</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        Performs cross-validation to find the best combination of variables for the specified curve type.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        </span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">        Parameters:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        -----------</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">            curvename : str</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">                The name of the curve used for fitting the data. This curve should be one of the supported curves.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">            on : str, optional</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        Returns:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        --------</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            best_combination : list</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">                The best combination of independent variables for the specified curve type.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">            best_train_metrics : dict</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">                The performance metrics on the training set for the best combination.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">            best_validation_metrics : dict</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">                The performance metrics on the validation set for the best combination.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="n">perf_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MSLE&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">assert</span> <span class="n">on</span> <span class="ow">in</span> <span class="n">perf_stats</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Performance comparison is made on one of the following metrics </span><span class="si">{</span><span class="n">perf_stats</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="c1"># Generate combinations based on the specified search method</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">]:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">(</span><span class="n">best_combination</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># Initialize for minimization</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="c1"># Generate candidate combinations for the next iteration</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">best_combination</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_combination</span><span class="p">))]</span> 
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                <span class="c1"># If no candidate combinations are available, break from the loop</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">candidate_columns</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                    <span class="k">break</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>                <span class="c1"># Find the best combination from the candidates</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>                <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">candidate_columns</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>                <span class="k">if</span> <span class="n">candidates_best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">best_validation_metric_value</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                    <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>                    <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                    <span class="k">break</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="c1"># In forward search, remove selected columns from the list of remaining columns</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">and</span> <span class="n">best_combination</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>                    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                        <span class="k">break</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="c1"># Evaluate all possible combinations of columns</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="c1"># Return the best combination of features and the corresponding training and validation metrics</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="k">return</span> <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="k">def</span> <span class="nf">variable_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Performs variable selection for each curve type and returns the best curve based on the specified metric.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        The function also returns the performance metrics for each curve type.</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        </span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        Parameters:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        -----------</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">            on : str, optional</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">                Whether to print the results. Default is True.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">                Whether to plot the performance comparison. Default is True.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        Returns:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">        --------</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">            best_curve : str</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">                The best curve based on the specified metric.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">            varselect_result : pd.DataFrame</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2"> curve&quot;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="c1"># Perform cross-validation and gather metrics</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="n">combination</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>                <span class="s1">&#39;Curve&#39;</span><span class="p">:</span> <span class="n">curvename</span><span class="p">,</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                <span class="s1">&#39;Best Combination&#39;</span><span class="p">:</span> <span class="n">combination</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="p">}</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best combination for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">combination</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">cv_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># Store for later use</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">cv_result</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="c1"># Optionally identify the best curve based on a specific validation metric, e.g., RMSE</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">best_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best curve based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_curve</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m curve&quot;</span><span class="p">)</span>            
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="n">_oncomp</span> <span class="o">=</span> <span class="n">cv_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Curve&#39;</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">_oncomp</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for different curves&#39;</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="k">return</span> <span class="n">best_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="k">def</span> <span class="nf">indep_vars_occurence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        Gives the number of occurences of each independent variable in the best combinations of variables for each curve.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        The function can be used to identify the most important variables in the dataset.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        Parameters</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        ----------</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">                Whether to normalize the occurrences as a percentage. Default is True.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">                Whether to plot the occurrences. Default is True.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">            title : str, optional</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Returns</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        -------</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">            variable_percentage : pd.Series</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">                The percentage of occurrence of each independent variable in the best combinations.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">curves_best_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="c1"># curves_best_combo = self.varselect_result.set_index(&#39;Curve&#39;)[&#39;Best Combination&#39;]</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="n">all_variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">curves_best_combo</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="c1"># Count occurrences of each variable</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">variable_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_variables</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="c1"># Compute the percentage for each variable</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">total_curves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_best_combo</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">total_curves</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">variable_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">variable_counts</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Percentage of Occurrence&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;Number of Occurrence&#39;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="n">variable_percentage</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Independent Variables&#39;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Occurrence of Independent Variables in best combinations per curve&#39;</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="k">return</span> <span class="n">variable_percentage</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>    <span class="k">def</span> <span class="nf">_get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">xcols</span><span class="p">):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the parameters from the optimized curve parameters.&quot;&quot;&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">paramnames</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">+</span> <span class="n">xcols</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">paramnames</span><span class="p">[</span><span class="n">_i</span><span class="p">]:</span> <span class="n">popt</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramnames</span><span class="p">))}</span>           
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>    
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">_fit_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">xcols</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits the curve to the data using a selected list of exogenous variables.&quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="c1"># Fit the model with the best combination of variables</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="c1"># Fit the mean curve        </span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="c1"># Fit the upper and lower curves for the confidence interval</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">qlb</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">qub</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">qlb</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">popt_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">qub</span><span class="p">,</span> <span class="n">winit</span> <span class="o">=</span> <span class="n">popt</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="n">popt_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">qlb</span><span class="p">,</span> <span class="n">winit</span> <span class="o">=</span> <span class="n">popt</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xcols</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span><span class="p">):</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predicts the dependent variable using the fitted curve and the confidence interval.&quot;&quot;&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">ypred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">yqlb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt_down</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">yqub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">X</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">fit_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits the best curve for each curve type based on the selected variables.&quot;&quot;&quot;</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">curvename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>                
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>                <span class="k">for</span> <span class="n">future</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>                    <span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span> <span class="o">=</span> <span class="n">task</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>                        <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>                        <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="n">popt_down</span><span class="p">}</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s1"> curve fitting generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span> 
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>            <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>                <span class="n">best_combination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>                <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span><span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span><span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span><span class="n">popt_down</span><span class="p">}</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="n">_best_params</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="k">return</span> <span class="n">_best_params</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>    
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>    <span class="k">def</span> <span class="nf">compare_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        Compares the best curves for each curve type based on the performance metrics.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">        The function also returns the performance metrics, the predictions, and the parameters for each curve type.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">        Parameters</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">        ----------</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">                Whether to plot the best curves. Default is True.</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">            CI : bool, optional</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">                Whether to plot the confidence interval. Default is True.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">            </span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">        Returns</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">        -------</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">            perf_metrics_df : pd.DataFrame</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">            predictions_df : pd.DataFrame</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">                The predictions for each curve type.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">            param_df : pd.DataFrame</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">                The parameters for each curve type.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>                
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="n">predictions_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>        <span class="n">params_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="n">perf_metrics_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>            <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>            <span class="n">params_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span> 
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]))</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                                            <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="s1">&#39;upper bound&#39;</span><span class="p">,</span> <span class="s1">&#39;lower bound&#39;</span><span class="p">])</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>            <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>            <span class="n">perf_metrics_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">perf_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="n">curves_l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictions_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>            <span class="n">nplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_l</span><span class="p">)</span> 
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">curves_l</span><span class="p">):</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                <span class="k">if</span> <span class="n">CI</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span> 
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                <span class="k">else</span> <span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="n">perf_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">perf_metrics_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="n">param_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">params_d</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">predictions_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="n">perf_metrics_df</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">,</span> <span class="n">param_df</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>    
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>    <span class="k">def</span> <span class="nf">predict_best_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">        Predicts the dependent variable using the best curve for the specified curve type.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">        Parameters:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">        ----------</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">            curvename : str</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">                The independent variables to use for prediction. Default is None.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">        Returns:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">        -------</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a><span class="sd">            prediction : pd.DataFrame</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">                A DataFrame containing the predicted dependent variable along with the confidence interval.        </span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="c1"># normalize the data</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>            <span class="c1"># add constant column if requested</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>        <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>        <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">])</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>        <span class="c1"># transform back X to the original scale</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="k">if</span> <span class="s1">&#39;constant&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>            <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>    
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>    <span class="k">def</span> <span class="nf">most_probable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">known_value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">        Estimates the most probable value of a dependent or independent variable using a fitted curve,</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a><span class="sd">        based on a provided known value. </span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="sd">        This method performs linear interpolation between the closest data points or uses boundary values</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a><span class="sd">        if the known value exceeds the available data range.</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">        This function is particularly useful when you have a value of one variable and need to estimate</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a><span class="sd">        the corresponding value of another variable based on the relationship defined by the specified curve.</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">        Parameters:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">        -----------</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a><span class="sd">            curvename : str</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">            </span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a><span class="sd">            known_value : tuple</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="sd">                A tuple containing:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">                - The name of the variable (str) for which the value is known.</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">                - The known value (float) of that variable.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">                The variable name must be one of the dependent or main independent variables used in the model.</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">        Returns:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">        --------</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">            float</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">                The estimated value of the other variable. This could be an interpolated value between data points</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">                or a boundary value if the known value is outside the range of the available data.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>        <span class="n">dep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>        <span class="n">main_indep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>        <span class="k">assert</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dep_var</span><span class="p">,</span> <span class="n">main_indep_var</span><span class="p">],</span> <span class="s2">&quot;known_value[0] must be either dep_var or main_indep_var&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>        
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>        <span class="c1"># Fetch the predictions and adjust column names</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="o">=</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">dep_var</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>        
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>        <span class="c1"># Sort DataFrame by the variable of interest</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>        
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>        <span class="c1"># Find rows where the known value is just above and below the input value</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>        <span class="n">filter_above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="n">filter_below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_above</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>            <span class="c1"># If known value is above all available data points</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is above the highest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">filter_below</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="c1"># If known value is below all available data points</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is below the lowest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="n">above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_above</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>        <span class="n">below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_below</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>        
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>        <span class="n">x_above</span><span class="p">,</span> <span class="n">y_above</span> <span class="o">=</span> <span class="n">above</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">above</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>        <span class="n">x_below</span><span class="p">,</span> <span class="n">y_below</span> <span class="o">=</span> <span class="n">below</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">below</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="c1"># Perform linear interpolation</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>            <span class="n">imputname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep_var</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated value of </span><span class="si">{</span><span class="n">imputname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">to_return</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>        <span class="k">return</span> <span class="n">to_return</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>    
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a><span class="sd">        Parameters</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a><span class="sd">        ----------</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a><span class="sd">            title : str, optional</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a><span class="sd">        Returns</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a><span class="sd">        -------</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a><span class="sd">            None        </span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>        
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>    
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yqub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a><span class="sd">        Plots the fitted curve along with the confidence interval.</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">        </span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="sd">        Parameters</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">        ----------</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a><span class="sd">            ypred : pd.Series</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">                The predicted dependent variable.</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">            yqlb : pd.Series, optional</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="sd">                The lower bound of the confidence interval. Default is None.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">            yqub : pd.Series, optional</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">                The upper bound of the confidence interval. Default is None.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">            ax : plt.Axes, optional</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">                The axes to use for plotting. Default is None.</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">            title : str, optional</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">        </span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a><span class="sd">        Returns</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="sd">        -------</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">            ax : plt.Axes</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">                The axes used for plotting.        </span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>        <span class="c1"># Plot the data</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">yqlb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yqub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>                            <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">% CI&#39;</span><span class="p">)</span>            
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>    <span class="c1"># Helper functions</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>    <span class="k">def</span> <span class="nf">_gX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the dot product of x and b for the curve calculations.&quot;&quot;&quot;</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>        
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>    <span class="c1"># Various curves follow, call them through curve()</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>    <span class="k">def</span> <span class="nf">_logistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>    <span class="k">def</span> <span class="nf">_redLogistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>        
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>    <span class="k">def</span> <span class="nf">_fixLogistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>    <span class="k">def</span> <span class="nf">_doubleExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>    <span class="k">def</span> <span class="nf">_exponential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>    <span class="k">def</span> <span class="nf">_fixExponential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>        <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>        <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>    <span class="k">def</span> <span class="nf">_arctan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>    <span class="k">def</span> <span class="nf">_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>        <span class="k">return</span> <span class="n">g</span>
</span></pre></div>


            </section>
                <section id="CurveParamFit">
                            <input id="CurveParamFit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CurveParamFit</span>:

                <label class="view-source-button" for="CurveParamFit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit-24"><a href="#CurveParamFit-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">CurveParamFit</span><span class="p">:</span>
</span><span id="CurveParamFit-25"><a href="#CurveParamFit-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-26"><a href="#CurveParamFit-26"><span class="linenos"> 26</span></a><span class="sd">    Class to fit a curve to a dataset using a variety of curve types.</span>
</span><span id="CurveParamFit-27"><a href="#CurveParamFit-27"><span class="linenos"> 27</span></a><span class="sd">    The class uses a cross-validated approach to select the best curve type and the best set of variables.</span>
</span><span id="CurveParamFit-28"><a href="#CurveParamFit-28"><span class="linenos"> 28</span></a><span class="sd">    The class supports the following curve types:</span>
</span><span id="CurveParamFit-29"><a href="#CurveParamFit-29"><span class="linenos"> 29</span></a><span class="sd">        - Logistic</span>
</span><span id="CurveParamFit-30"><a href="#CurveParamFit-30"><span class="linenos"> 30</span></a><span class="sd">        - Reduced Logistic</span>
</span><span id="CurveParamFit-31"><a href="#CurveParamFit-31"><span class="linenos"> 31</span></a><span class="sd">        - Fixed Logistic</span>
</span><span id="CurveParamFit-32"><a href="#CurveParamFit-32"><span class="linenos"> 32</span></a><span class="sd">        - Double Exponential</span>
</span><span id="CurveParamFit-33"><a href="#CurveParamFit-33"><span class="linenos"> 33</span></a><span class="sd">        - Exponential</span>
</span><span id="CurveParamFit-34"><a href="#CurveParamFit-34"><span class="linenos"> 34</span></a><span class="sd">        - Fixed Exponential</span>
</span><span id="CurveParamFit-35"><a href="#CurveParamFit-35"><span class="linenos"> 35</span></a><span class="sd">        - Arctan</span>
</span><span id="CurveParamFit-36"><a href="#CurveParamFit-36"><span class="linenos"> 36</span></a><span class="sd">        - Linear</span>
</span><span id="CurveParamFit-37"><a href="#CurveParamFit-37"><span class="linenos"> 37</span></a>
</span><span id="CurveParamFit-38"><a href="#CurveParamFit-38"><span class="linenos"> 38</span></a><span class="sd">    Parameters</span>
</span><span id="CurveParamFit-39"><a href="#CurveParamFit-39"><span class="linenos"> 39</span></a><span class="sd">    ----------</span>
</span><span id="CurveParamFit-40"><a href="#CurveParamFit-40"><span class="linenos"> 40</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="CurveParamFit-41"><a href="#CurveParamFit-41"><span class="linenos"> 41</span></a><span class="sd">            The dataset containing the dependent and independent variables.</span>
</span><span id="CurveParamFit-42"><a href="#CurveParamFit-42"><span class="linenos"> 42</span></a><span class="sd">        dep_var : str</span>
</span><span id="CurveParamFit-43"><a href="#CurveParamFit-43"><span class="linenos"> 43</span></a><span class="sd">            The name of the dependent variable.</span>
</span><span id="CurveParamFit-44"><a href="#CurveParamFit-44"><span class="linenos"> 44</span></a><span class="sd">        main_indep_var : str</span>
</span><span id="CurveParamFit-45"><a href="#CurveParamFit-45"><span class="linenos"> 45</span></a><span class="sd">            The name of the main independent variable.</span>
</span><span id="CurveParamFit-46"><a href="#CurveParamFit-46"><span class="linenos"> 46</span></a><span class="sd">        dep_var_name : str, optional</span>
</span><span id="CurveParamFit-47"><a href="#CurveParamFit-47"><span class="linenos"> 47</span></a><span class="sd">            The name of the dependent variable for plotting. Default is None.</span>
</span><span id="CurveParamFit-48"><a href="#CurveParamFit-48"><span class="linenos"> 48</span></a><span class="sd">        main_indep_var_name : str, optional</span>
</span><span id="CurveParamFit-49"><a href="#CurveParamFit-49"><span class="linenos"> 49</span></a><span class="sd">            The name of the main independent variable for plotting. Default is None.</span>
</span><span id="CurveParamFit-50"><a href="#CurveParamFit-50"><span class="linenos"> 50</span></a><span class="sd">        constant : bool, optional</span>
</span><span id="CurveParamFit-51"><a href="#CurveParamFit-51"><span class="linenos"> 51</span></a><span class="sd">            Whether to include a constant column in the independent variables. Default is True.</span>
</span><span id="CurveParamFit-52"><a href="#CurveParamFit-52"><span class="linenos"> 52</span></a><span class="sd">        curves : list, optional</span>
</span><span id="CurveParamFit-53"><a href="#CurveParamFit-53"><span class="linenos"> 53</span></a><span class="sd">            The list of curve types to consider. Default is None.</span>
</span><span id="CurveParamFit-54"><a href="#CurveParamFit-54"><span class="linenos"> 54</span></a><span class="sd">        Q : float, optional</span>
</span><span id="CurveParamFit-55"><a href="#CurveParamFit-55"><span class="linenos"> 55</span></a><span class="sd">            The confidence level for the confidence interval. Default is 0.9.</span>
</span><span id="CurveParamFit-56"><a href="#CurveParamFit-56"><span class="linenos"> 56</span></a><span class="sd">        nFolds : int, optional</span>
</span><span id="CurveParamFit-57"><a href="#CurveParamFit-57"><span class="linenos"> 57</span></a><span class="sd">            The number of folds for cross-validation. Default is 5.</span>
</span><span id="CurveParamFit-58"><a href="#CurveParamFit-58"><span class="linenos"> 58</span></a><span class="sd">        parallel : bool, optional</span>
</span><span id="CurveParamFit-59"><a href="#CurveParamFit-59"><span class="linenos"> 59</span></a><span class="sd">            Whether to run cross-validation in parallel. Default is False.</span>
</span><span id="CurveParamFit-60"><a href="#CurveParamFit-60"><span class="linenos"> 60</span></a><span class="sd">        search_method : str, optional</span>
</span><span id="CurveParamFit-61"><a href="#CurveParamFit-61"><span class="linenos"> 61</span></a><span class="sd">            The method to use for variable selection. Default is &#39;backward&#39;. Available options are </span>
</span><span id="CurveParamFit-62"><a href="#CurveParamFit-62"><span class="linenos"> 62</span></a><span class="sd">            - backward: Backward elimination removing variables that are not improving the prediction accuracy</span>
</span><span id="CurveParamFit-63"><a href="#CurveParamFit-63"><span class="linenos"> 63</span></a><span class="sd">            - forward: Forward selection, adding variables only if they increase predictive power</span>
</span><span id="CurveParamFit-64"><a href="#CurveParamFit-64"><span class="linenos"> 64</span></a><span class="sd">            - all_combinations: Exhaustive search testing all variable combinations and selecting the best</span>
</span><span id="CurveParamFit-65"><a href="#CurveParamFit-65"><span class="linenos"> 65</span></a><span class="sd">    </span>
</span><span id="CurveParamFit-66"><a href="#CurveParamFit-66"><span class="linenos"> 66</span></a><span class="sd">    Methods:</span>
</span><span id="CurveParamFit-67"><a href="#CurveParamFit-67"><span class="linenos"> 67</span></a><span class="sd">    --------</span>
</span><span id="CurveParamFit-68"><a href="#CurveParamFit-68"><span class="linenos"> 68</span></a><span class="sd">        cross_validate(curvename, on=&#39;RMSE&#39;)</span>
</span><span id="CurveParamFit-69"><a href="#CurveParamFit-69"><span class="linenos"> 69</span></a><span class="sd">            Performs cross-validation to find the best combination of variables for the specified curve type.</span>
</span><span id="CurveParamFit-70"><a href="#CurveParamFit-70"><span class="linenos"> 70</span></a><span class="sd">        variable_select(on=&#39;RMSE&#39;, verbose=True, plot=True)</span>
</span><span id="CurveParamFit-71"><a href="#CurveParamFit-71"><span class="linenos"> 71</span></a><span class="sd">            Performs variable selection for each curve type and returns the best curve based on the specified metric.</span>
</span><span id="CurveParamFit-72"><a href="#CurveParamFit-72"><span class="linenos"> 72</span></a><span class="sd">        indep_vars_occurence(normalize=True, plot=True, title=&#39;&#39;)</span>
</span><span id="CurveParamFit-73"><a href="#CurveParamFit-73"><span class="linenos"> 73</span></a><span class="sd">            Gives the number of occurrences of each independent variable in the best combinations of variables for each curve.</span>
</span><span id="CurveParamFit-74"><a href="#CurveParamFit-74"><span class="linenos"> 74</span></a><span class="sd">        fit_best_curves()</span>
</span><span id="CurveParamFit-75"><a href="#CurveParamFit-75"><span class="linenos"> 75</span></a><span class="sd">            Fits the best curve for each curve type based on the selected variables.</span>
</span><span id="CurveParamFit-76"><a href="#CurveParamFit-76"><span class="linenos"> 76</span></a><span class="sd">        compare_best_curves(plot=True, CI = True)</span>
</span><span id="CurveParamFit-77"><a href="#CurveParamFit-77"><span class="linenos"> 77</span></a><span class="sd">            Compares the best curves for each curve type based on the performance metrics.</span>
</span><span id="CurveParamFit-78"><a href="#CurveParamFit-78"><span class="linenos"> 78</span></a><span class="sd">        predict_best_curve(curvename, X=None)</span>
</span><span id="CurveParamFit-79"><a href="#CurveParamFit-79"><span class="linenos"> 79</span></a><span class="sd">            Predicts the dependent variable using the best curve for the specified curve type.</span>
</span><span id="CurveParamFit-80"><a href="#CurveParamFit-80"><span class="linenos"> 80</span></a><span class="sd">        most_probable_value(curvename, known_value, verbose=True)</span>
</span><span id="CurveParamFit-81"><a href="#CurveParamFit-81"><span class="linenos"> 81</span></a><span class="sd">            Estimates the most probable value of a dependent or independent variable using a fitted curve.</span>
</span><span id="CurveParamFit-82"><a href="#CurveParamFit-82"><span class="linenos"> 82</span></a><span class="sd">        plot_x_y(title =&#39;&#39;)</span>
</span><span id="CurveParamFit-83"><a href="#CurveParamFit-83"><span class="linenos"> 83</span></a><span class="sd">            Plots the dependent variable y against all the independent variables x.</span>
</span><span id="CurveParamFit-84"><a href="#CurveParamFit-84"><span class="linenos"> 84</span></a><span class="sd">        plot_curve_with_confidence_interval(ypred, yqlb=None, yqub=None, ax = None, title =&#39;&#39;)</span>
</span><span id="CurveParamFit-85"><a href="#CurveParamFit-85"><span class="linenos"> 85</span></a><span class="sd">            Plots the fitted curve along with the confidence interval.</span>
</span><span id="CurveParamFit-86"><a href="#CurveParamFit-86"><span class="linenos"> 86</span></a>
</span><span id="CurveParamFit-87"><a href="#CurveParamFit-87"><span class="linenos"> 87</span></a><span class="sd">    Attributes:</span>
</span><span id="CurveParamFit-88"><a href="#CurveParamFit-88"><span class="linenos"> 88</span></a><span class="sd">    -----------</span>
</span><span id="CurveParamFit-89"><a href="#CurveParamFit-89"><span class="linenos"> 89</span></a><span class="sd">        varselect_result : pd.DataFrame</span>
</span><span id="CurveParamFit-90"><a href="#CurveParamFit-90"><span class="linenos"> 90</span></a><span class="sd">            The performance metrics for each curve type.</span>
</span><span id="CurveParamFit-91"><a href="#CurveParamFit-91"><span class="linenos"> 91</span></a><span class="sd">        best_curves_params : dict</span>
</span><span id="CurveParamFit-92"><a href="#CurveParamFit-92"><span class="linenos"> 92</span></a><span class="sd">            The parameters for each curve type.</span>
</span><span id="CurveParamFit-93"><a href="#CurveParamFit-93"><span class="linenos"> 93</span></a>
</span><span id="CurveParamFit-94"><a href="#CurveParamFit-94"><span class="linenos"> 94</span></a><span class="sd">    Example:</span>
</span><span id="CurveParamFit-95"><a href="#CurveParamFit-95"><span class="linenos"> 95</span></a><span class="sd">    --------</span>
</span><span id="CurveParamFit-96"><a href="#CurveParamFit-96"><span class="linenos"> 96</span></a><span class="sd">    ```python</span>
</span><span id="CurveParamFit-97"><a href="#CurveParamFit-97"><span class="linenos"> 97</span></a><span class="sd">    import pandas as pd</span>
</span><span id="CurveParamFit-98"><a href="#CurveParamFit-98"><span class="linenos"> 98</span></a><span class="sd">    from reserves_demand.curve_param_fit import CurveParamFit</span>
</span><span id="CurveParamFit-99"><a href="#CurveParamFit-99"><span class="linenos"> 99</span></a>
</span><span id="CurveParamFit-100"><a href="#CurveParamFit-100"><span class="linenos">100</span></a><span class="sd">    # Load the dataset</span>
</span><span id="CurveParamFit-101"><a href="#CurveParamFit-101"><span class="linenos">101</span></a><span class="sd">    data = pd.read_csv(&#39;../data/reserve_demand_cruve_data.csv&#39;)</span>
</span><span id="CurveParamFit-102"><a href="#CurveParamFit-102"><span class="linenos">102</span></a>
</span><span id="CurveParamFit-103"><a href="#CurveParamFit-103"><span class="linenos">103</span></a><span class="sd">    # Initialize the CurveParamFit object</span>
</span><span id="CurveParamFit-104"><a href="#CurveParamFit-104"><span class="linenos">104</span></a><span class="sd">    curve_fit = CurveParamFit(</span>
</span><span id="CurveParamFit-105"><a href="#CurveParamFit-105"><span class="linenos">105</span></a><span class="sd">                data = dat, </span>
</span><span id="CurveParamFit-106"><a href="#CurveParamFit-106"><span class="linenos">106</span></a><span class="sd">                dep_var = &#39;Normalized&#39;,</span>
</span><span id="CurveParamFit-107"><a href="#CurveParamFit-107"><span class="linenos">107</span></a><span class="sd">                main_indep_var= &#39;excess_reserve&#39;,</span>
</span><span id="CurveParamFit-108"><a href="#CurveParamFit-108"><span class="linenos">108</span></a><span class="sd">                dep_var_name= &#39;Normalized Overnight Rate&#39;,                 </span>
</span><span id="CurveParamFit-109"><a href="#CurveParamFit-109"><span class="linenos">109</span></a><span class="sd">                main_indep_var_name= &#39;Excess Reserve&#39;,</span>
</span><span id="CurveParamFit-110"><a href="#CurveParamFit-110"><span class="linenos">110</span></a><span class="sd">            )</span>
</span><span id="CurveParamFit-111"><a href="#CurveParamFit-111"><span class="linenos">111</span></a>
</span><span id="CurveParamFit-112"><a href="#CurveParamFit-112"><span class="linenos">112</span></a><span class="sd">    # Perform variable selection for each curve</span>
</span><span id="CurveParamFit-113"><a href="#CurveParamFit-113"><span class="linenos">113</span></a><span class="sd">    best_curve, varselect_result = curve_fit.variable_select(on=&#39;RMSE&#39;, verbose=True, plot=True)</span>
</span><span id="CurveParamFit-114"><a href="#CurveParamFit-114"><span class="linenos">114</span></a>
</span><span id="CurveParamFit-115"><a href="#CurveParamFit-115"><span class="linenos">115</span></a><span class="sd">    # Fit the best curves</span>
</span><span id="CurveParamFit-116"><a href="#CurveParamFit-116"><span class="linenos">116</span></a><span class="sd">    best_curves_params = curve_fit.fit_best_curves()</span>
</span><span id="CurveParamFit-117"><a href="#CurveParamFit-117"><span class="linenos">117</span></a>
</span><span id="CurveParamFit-118"><a href="#CurveParamFit-118"><span class="linenos">118</span></a><span class="sd">    # Compare the best curves</span>
</span><span id="CurveParamFit-119"><a href="#CurveParamFit-119"><span class="linenos">119</span></a><span class="sd">    perf_metrics_df, predictions_df, param_df = curve_fit.compare_best_curves()</span>
</span><span id="CurveParamFit-120"><a href="#CurveParamFit-120"><span class="linenos">120</span></a>
</span><span id="CurveParamFit-121"><a href="#CurveParamFit-121"><span class="linenos">121</span></a><span class="sd">    # Predict the dependent variable using the best curve</span>
</span><span id="CurveParamFit-122"><a href="#CurveParamFit-122"><span class="linenos">122</span></a><span class="sd">    predictions = curve_fit.predict_best_curve(best_curve)</span>
</span><span id="CurveParamFit-123"><a href="#CurveParamFit-123"><span class="linenos">123</span></a>
</span><span id="CurveParamFit-124"><a href="#CurveParamFit-124"><span class="linenos">124</span></a><span class="sd">    # Estimate the most probable value of a variable</span>
</span><span id="CurveParamFit-125"><a href="#CurveParamFit-125"><span class="linenos">125</span></a><span class="sd">    known_value = (&#39;Normalized&#39;, 100)</span>
</span><span id="CurveParamFit-126"><a href="#CurveParamFit-126"><span class="linenos">126</span></a><span class="sd">    most_probable_value = curve_fit.most_probable_value(best_curve, known_value)</span>
</span><span id="CurveParamFit-127"><a href="#CurveParamFit-127"><span class="linenos">127</span></a><span class="sd">    ```</span>
</span><span id="CurveParamFit-128"><a href="#CurveParamFit-128"><span class="linenos">128</span></a><span class="sd">    &quot;&quot;&quot;</span>   
</span><span id="CurveParamFit-129"><a href="#CurveParamFit-129"><span class="linenos">129</span></a>    
</span><span id="CurveParamFit-130"><a href="#CurveParamFit-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="CurveParamFit-131"><a href="#CurveParamFit-131"><span class="linenos">131</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="CurveParamFit-132"><a href="#CurveParamFit-132"><span class="linenos">132</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CurveParamFit-133"><a href="#CurveParamFit-133"><span class="linenos">133</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="CurveParamFit-134"><a href="#CurveParamFit-134"><span class="linenos">134</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="CurveParamFit-135"><a href="#CurveParamFit-135"><span class="linenos">135</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveParamFit-136"><a href="#CurveParamFit-136"><span class="linenos">136</span></a>                 <span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CurveParamFit-137"><a href="#CurveParamFit-137"><span class="linenos">137</span></a>                 <span class="n">curves</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveParamFit-138"><a href="#CurveParamFit-138"><span class="linenos">138</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="CurveParamFit-139"><a href="#CurveParamFit-139"><span class="linenos">139</span></a>                 <span class="n">nFolds</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="CurveParamFit-140"><a href="#CurveParamFit-140"><span class="linenos">140</span></a>                 <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CurveParamFit-141"><a href="#CurveParamFit-141"><span class="linenos">141</span></a>                 <span class="n">search_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span>
</span><span id="CurveParamFit-142"><a href="#CurveParamFit-142"><span class="linenos">142</span></a>                 <span class="p">):</span>
</span><span id="CurveParamFit-143"><a href="#CurveParamFit-143"><span class="linenos">143</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="CurveParamFit-144"><a href="#CurveParamFit-144"><span class="linenos">144</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveParamFit-145"><a href="#CurveParamFit-145"><span class="linenos">145</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveParamFit-146"><a href="#CurveParamFit-146"><span class="linenos">146</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Q should be between 0 and 1 for valid confidence intervals&quot;</span>
</span><span id="CurveParamFit-147"><a href="#CurveParamFit-147"><span class="linenos">147</span></a>        <span class="k">assert</span> <span class="n">nFolds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;nFolds must be greater than 1 for cross-validation&quot;</span>
</span><span id="CurveParamFit-148"><a href="#CurveParamFit-148"><span class="linenos">148</span></a>        <span class="k">assert</span> <span class="n">search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">],</span> <span class="s2">&quot;search_method must be &#39;backward&#39;, &#39;forward&#39;, or &#39;all_combinations&#39;&quot;</span>
</span><span id="CurveParamFit-149"><a href="#CurveParamFit-149"><span class="linenos">149</span></a>
</span><span id="CurveParamFit-150"><a href="#CurveParamFit-150"><span class="linenos">150</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="CurveParamFit-151"><a href="#CurveParamFit-151"><span class="linenos">151</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="CurveParamFit-152"><a href="#CurveParamFit-152"><span class="linenos">152</span></a>        
</span><span id="CurveParamFit-153"><a href="#CurveParamFit-153"><span class="linenos">153</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="CurveParamFit-154"><a href="#CurveParamFit-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-155"><a href="#CurveParamFit-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="CurveParamFit-156"><a href="#CurveParamFit-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="CurveParamFit-157"><a href="#CurveParamFit-157"><span class="linenos">157</span></a>        
</span><span id="CurveParamFit-158"><a href="#CurveParamFit-158"><span class="linenos">158</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="CurveParamFit-159"><a href="#CurveParamFit-159"><span class="linenos">159</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="CurveParamFit-160"><a href="#CurveParamFit-160"><span class="linenos">160</span></a>        
</span><span id="CurveParamFit-161"><a href="#CurveParamFit-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="CurveParamFit-162"><a href="#CurveParamFit-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="CurveParamFit-163"><a href="#CurveParamFit-163"><span class="linenos">163</span></a>        
</span><span id="CurveParamFit-164"><a href="#CurveParamFit-164"><span class="linenos">164</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="CurveParamFit-165"><a href="#CurveParamFit-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CurveParamFit-166"><a href="#CurveParamFit-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CurveParamFit-167"><a href="#CurveParamFit-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveParamFit-168"><a href="#CurveParamFit-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveParamFit-169"><a href="#CurveParamFit-169"><span class="linenos">169</span></a>        
</span><span id="CurveParamFit-170"><a href="#CurveParamFit-170"><span class="linenos">170</span></a>        <span class="c1"># add constant column if requested</span>
</span><span id="CurveParamFit-171"><a href="#CurveParamFit-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
</span><span id="CurveParamFit-172"><a href="#CurveParamFit-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CurveParamFit-173"><a href="#CurveParamFit-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-174"><a href="#CurveParamFit-174"><span class="linenos">174</span></a>        
</span><span id="CurveParamFit-175"><a href="#CurveParamFit-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span> <span class="o">=</span> <span class="n">Q</span>
</span><span id="CurveParamFit-176"><a href="#CurveParamFit-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="CurveParamFit-177"><a href="#CurveParamFit-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="CurveParamFit-178"><a href="#CurveParamFit-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span> <span class="o">=</span> <span class="n">parallel</span>
</span><span id="CurveParamFit-179"><a href="#CurveParamFit-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">=</span> <span class="n">search_method</span>
</span><span id="CurveParamFit-180"><a href="#CurveParamFit-180"><span class="linenos">180</span></a>        
</span><span id="CurveParamFit-181"><a href="#CurveParamFit-181"><span class="linenos">181</span></a>        <span class="n">curves</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit-182"><a href="#CurveParamFit-182"><span class="linenos">182</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logistic</span><span class="p">,</span>
</span><span id="CurveParamFit-183"><a href="#CurveParamFit-183"><span class="linenos">183</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redLogistic</span><span class="p">,</span>
</span><span id="CurveParamFit-184"><a href="#CurveParamFit-184"><span class="linenos">184</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixLogistic</span><span class="p">,</span>
</span><span id="CurveParamFit-185"><a href="#CurveParamFit-185"><span class="linenos">185</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doubleExp</span><span class="p">,</span>
</span><span id="CurveParamFit-186"><a href="#CurveParamFit-186"><span class="linenos">186</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exponential</span><span class="p">,</span>
</span><span id="CurveParamFit-187"><a href="#CurveParamFit-187"><span class="linenos">187</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixExponential</span><span class="p">,</span>
</span><span id="CurveParamFit-188"><a href="#CurveParamFit-188"><span class="linenos">188</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arctan</span><span class="p">,</span>
</span><span id="CurveParamFit-189"><a href="#CurveParamFit-189"><span class="linenos">189</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>
</span><span id="CurveParamFit-190"><a href="#CurveParamFit-190"><span class="linenos">190</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit-191"><a href="#CurveParamFit-191"><span class="linenos">191</span></a>        <span class="n">param_names</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit-192"><a href="#CurveParamFit-192"><span class="linenos">192</span></a>            <span class="c1"># Names of parameters for each curve type</span>
</span><span id="CurveParamFit-193"><a href="#CurveParamFit-193"><span class="linenos">193</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-194"><a href="#CurveParamFit-194"><span class="linenos">194</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-195"><a href="#CurveParamFit-195"><span class="linenos">195</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-196"><a href="#CurveParamFit-196"><span class="linenos">196</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-197"><a href="#CurveParamFit-197"><span class="linenos">197</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-198"><a href="#CurveParamFit-198"><span class="linenos">198</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-199"><a href="#CurveParamFit-199"><span class="linenos">199</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit-200"><a href="#CurveParamFit-200"><span class="linenos">200</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="CurveParamFit-201"><a href="#CurveParamFit-201"><span class="linenos">201</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit-202"><a href="#CurveParamFit-202"><span class="linenos">202</span></a>        <span class="n">init_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit-203"><a href="#CurveParamFit-203"><span class="linenos">203</span></a>            <span class="c1"># Initial parameters for each curve type</span>
</span><span id="CurveParamFit-204"><a href="#CurveParamFit-204"><span class="linenos">204</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
</span><span id="CurveParamFit-205"><a href="#CurveParamFit-205"><span class="linenos">205</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span><span id="CurveParamFit-206"><a href="#CurveParamFit-206"><span class="linenos">206</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit-207"><a href="#CurveParamFit-207"><span class="linenos">207</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="CurveParamFit-208"><a href="#CurveParamFit-208"><span class="linenos">208</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit-209"><a href="#CurveParamFit-209"><span class="linenos">209</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="CurveParamFit-210"><a href="#CurveParamFit-210"><span class="linenos">210</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit-211"><a href="#CurveParamFit-211"><span class="linenos">211</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="CurveParamFit-212"><a href="#CurveParamFit-212"><span class="linenos">212</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit-213"><a href="#CurveParamFit-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="n">curves</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-214"><a href="#CurveParamFit-214"><span class="linenos">214</span></a>            <span class="n">curves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CurveParamFit-215"><a href="#CurveParamFit-215"><span class="linenos">215</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-216"><a href="#CurveParamFit-216"><span class="linenos">216</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CurveParamFit-217"><a href="#CurveParamFit-217"><span class="linenos">217</span></a>        
</span><span id="CurveParamFit-218"><a href="#CurveParamFit-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">curves</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit-219"><a href="#CurveParamFit-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">param_names</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit-220"><a href="#CurveParamFit-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">init_params</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit-221"><a href="#CurveParamFit-221"><span class="linenos">221</span></a>
</span><span id="CurveParamFit-222"><a href="#CurveParamFit-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CurveParamFit-223"><a href="#CurveParamFit-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveParamFit-224"><a href="#CurveParamFit-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="CurveParamFit-225"><a href="#CurveParamFit-225"><span class="linenos">225</span></a>
</span><span id="CurveParamFit-226"><a href="#CurveParamFit-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="CurveParamFit-227"><a href="#CurveParamFit-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies the specified curve function to the input data x.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-228"><a href="#CurveParamFit-228"><span class="linenos">228</span></a>        <span class="k">assert</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CurveParamFit-229"><a href="#CurveParamFit-229"><span class="linenos">229</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-230"><a href="#CurveParamFit-230"><span class="linenos">230</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">:]</span>
</span><span id="CurveParamFit-231"><a href="#CurveParamFit-231"><span class="linenos">231</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gX</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="CurveParamFit-232"><a href="#CurveParamFit-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">[</span><span class="n">curvename</span><span class="p">](</span><span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
</span><span id="CurveParamFit-233"><a href="#CurveParamFit-233"><span class="linenos">233</span></a>        
</span><span id="CurveParamFit-234"><a href="#CurveParamFit-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="CurveParamFit-235"><a href="#CurveParamFit-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the quantile loss for curve fitting.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-236"><a href="#CurveParamFit-236"><span class="linenos">236</span></a>        <span class="n">ypred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-237"><a href="#CurveParamFit-237"><span class="linenos">237</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ypred</span>
</span><span id="CurveParamFit-238"><a href="#CurveParamFit-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="CurveParamFit-239"><a href="#CurveParamFit-239"><span class="linenos">239</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="CurveParamFit-240"><a href="#CurveParamFit-240"><span class="linenos">240</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-241"><a href="#CurveParamFit-241"><span class="linenos">241</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="CurveParamFit-242"><a href="#CurveParamFit-242"><span class="linenos">242</span></a>
</span><span id="CurveParamFit-243"><a href="#CurveParamFit-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">_curveOpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">winit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CurveParamFit-244"><a href="#CurveParamFit-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optimizes the curve parameters for the given data and curve type.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-245"><a href="#CurveParamFit-245"><span class="linenos">245</span></a>        <span class="k">assert</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type: </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CurveParamFit-246"><a href="#CurveParamFit-246"><span class="linenos">246</span></a>        
</span><span id="CurveParamFit-247"><a href="#CurveParamFit-247"><span class="linenos">247</span></a>        <span class="c1"># Initial parameters setup</span>
</span><span id="CurveParamFit-248"><a href="#CurveParamFit-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="n">winit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-249"><a href="#CurveParamFit-249"><span class="linenos">249</span></a>            <span class="n">M</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CurveParamFit-250"><a href="#CurveParamFit-250"><span class="linenos">250</span></a>            <span class="n">xinit</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">M</span>
</span><span id="CurveParamFit-251"><a href="#CurveParamFit-251"><span class="linenos">251</span></a>            <span class="n">winit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">],</span> <span class="n">xinit</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>  
</span><span id="CurveParamFit-252"><a href="#CurveParamFit-252"><span class="linenos">252</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-253"><a href="#CurveParamFit-253"><span class="linenos">253</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">winit</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">])</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Invalid initial parameters&quot;</span>
</span><span id="CurveParamFit-254"><a href="#CurveParamFit-254"><span class="linenos">254</span></a>
</span><span id="CurveParamFit-255"><a href="#CurveParamFit-255"><span class="linenos">255</span></a>        <span class="c1"># Use minimize for other cases</span>
</span><span id="CurveParamFit-256"><a href="#CurveParamFit-256"><span class="linenos">256</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loss</span><span class="p">,</span> <span class="n">winit</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
</span><span id="CurveParamFit-257"><a href="#CurveParamFit-257"><span class="linenos">257</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="CurveParamFit-258"><a href="#CurveParamFit-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="CurveParamFit-259"><a href="#CurveParamFit-259"><span class="linenos">259</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization failed for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2"> curve with message: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-260"><a href="#CurveParamFit-260"><span class="linenos">260</span></a>
</span><span id="CurveParamFit-261"><a href="#CurveParamFit-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="n">popt</span>
</span><span id="CurveParamFit-262"><a href="#CurveParamFit-262"><span class="linenos">262</span></a>
</span><span id="CurveParamFit-263"><a href="#CurveParamFit-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">_run_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="CurveParamFit-264"><a href="#CurveParamFit-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes a single fold of cross-validation for the given columns and curve.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-265"><a href="#CurveParamFit-265"><span class="linenos">265</span></a>        
</span><span id="CurveParamFit-266"><a href="#CurveParamFit-266"><span class="linenos">266</span></a>        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">][</span><span class="n">columns</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">][</span><span class="n">columns</span><span class="p">]</span>
</span><span id="CurveParamFit-267"><a href="#CurveParamFit-267"><span class="linenos">267</span></a>        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
</span><span id="CurveParamFit-268"><a href="#CurveParamFit-268"><span class="linenos">268</span></a>
</span><span id="CurveParamFit-269"><a href="#CurveParamFit-269"><span class="linenos">269</span></a>        <span class="c1"># Fit the model using the specified curve type and predict on both training and testing sets</span>
</span><span id="CurveParamFit-270"><a href="#CurveParamFit-270"><span class="linenos">270</span></a>        <span class="c1"># The ross validation is chosen on the mean absolute error loss q=0.5</span>
</span><span id="CurveParamFit-271"><a href="#CurveParamFit-271"><span class="linenos">271</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="CurveParamFit-272"><a href="#CurveParamFit-272"><span class="linenos">272</span></a>        <span class="n">y_train_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-273"><a href="#CurveParamFit-273"><span class="linenos">273</span></a>        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-274"><a href="#CurveParamFit-274"><span class="linenos">274</span></a>
</span><span id="CurveParamFit-275"><a href="#CurveParamFit-275"><span class="linenos">275</span></a>        <span class="c1"># Evaluate and return performance metrics for both sets</span>
</span><span id="CurveParamFit-276"><a href="#CurveParamFit-276"><span class="linenos">276</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
</span><span id="CurveParamFit-277"><a href="#CurveParamFit-277"><span class="linenos">277</span></a>        <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
</span><span id="CurveParamFit-278"><a href="#CurveParamFit-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span>
</span><span id="CurveParamFit-279"><a href="#CurveParamFit-279"><span class="linenos">279</span></a>
</span><span id="CurveParamFit-280"><a href="#CurveParamFit-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">_run_cv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span>
</span><span id="CurveParamFit-281"><a href="#CurveParamFit-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs cross-validation for the specified columns subset and curve type.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-282"><a href="#CurveParamFit-282"><span class="linenos">282</span></a>
</span><span id="CurveParamFit-283"><a href="#CurveParamFit-283"><span class="linenos">283</span></a>        <span class="c1"># Initialize lists to store metrics for all folds</span>
</span><span id="CurveParamFit-284"><a href="#CurveParamFit-284"><span class="linenos">284</span></a>        <span class="n">train_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveParamFit-285"><a href="#CurveParamFit-285"><span class="linenos">285</span></a>        <span class="n">test_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveParamFit-286"><a href="#CurveParamFit-286"><span class="linenos">286</span></a>
</span><span id="CurveParamFit-287"><a href="#CurveParamFit-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="CurveParamFit-288"><a href="#CurveParamFit-288"><span class="linenos">288</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="CurveParamFit-289"><a href="#CurveParamFit-289"><span class="linenos">289</span></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_fold</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-290"><a href="#CurveParamFit-290"><span class="linenos">290</span></a>                        <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)]</span>
</span><span id="CurveParamFit-291"><a href="#CurveParamFit-291"><span class="linenos">291</span></a>                <span class="c1"># Collect results as they complete</span>
</span><span id="CurveParamFit-292"><a href="#CurveParamFit-292"><span class="linenos">292</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="CurveParamFit-293"><a href="#CurveParamFit-293"><span class="linenos">293</span></a>                    <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="CurveParamFit-294"><a href="#CurveParamFit-294"><span class="linenos">294</span></a>                    <span class="n">train_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-295"><a href="#CurveParamFit-295"><span class="linenos">295</span></a>                    <span class="n">test_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-296"><a href="#CurveParamFit-296"><span class="linenos">296</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-297"><a href="#CurveParamFit-297"><span class="linenos">297</span></a>            <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">):</span>
</span><span id="CurveParamFit-298"><a href="#CurveParamFit-298"><span class="linenos">298</span></a>                <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_fold</span><span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">columns_subset</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-299"><a href="#CurveParamFit-299"><span class="linenos">299</span></a>                <span class="n">train_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-300"><a href="#CurveParamFit-300"><span class="linenos">300</span></a>                <span class="n">test_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-301"><a href="#CurveParamFit-301"><span class="linenos">301</span></a>
</span><span id="CurveParamFit-302"><a href="#CurveParamFit-302"><span class="linenos">302</span></a>        <span class="c1"># Convert lists of Series to DataFrames and compute mean for each metric</span>
</span><span id="CurveParamFit-303"><a href="#CurveParamFit-303"><span class="linenos">303</span></a>        <span class="n">train_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_metrics_list</span><span class="p">)</span>
</span><span id="CurveParamFit-304"><a href="#CurveParamFit-304"><span class="linenos">304</span></a>        <span class="n">test_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_metrics_list</span><span class="p">)</span>
</span><span id="CurveParamFit-305"><a href="#CurveParamFit-305"><span class="linenos">305</span></a>        <span class="n">train_metrics_mean</span> <span class="o">=</span> <span class="n">train_metrics_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="CurveParamFit-306"><a href="#CurveParamFit-306"><span class="linenos">306</span></a>        <span class="n">validation_metrics_mean</span> <span class="o">=</span> <span class="n">test_metrics_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="CurveParamFit-307"><a href="#CurveParamFit-307"><span class="linenos">307</span></a>
</span><span id="CurveParamFit-308"><a href="#CurveParamFit-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">train_metrics_mean</span><span class="p">,</span> <span class="n">validation_metrics_mean</span>
</span><span id="CurveParamFit-309"><a href="#CurveParamFit-309"><span class="linenos">309</span></a>
</span><span id="CurveParamFit-310"><a href="#CurveParamFit-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">_find_best_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
</span><span id="CurveParamFit-311"><a href="#CurveParamFit-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds the best combination of columns based on the specified performance metric for a specific curve type.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-312"><a href="#CurveParamFit-312"><span class="linenos">312</span></a>
</span><span id="CurveParamFit-313"><a href="#CurveParamFit-313"><span class="linenos">313</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-314"><a href="#CurveParamFit-314"><span class="linenos">314</span></a>        <span class="n">validation_metrics</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-315"><a href="#CurveParamFit-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="CurveParamFit-316"><a href="#CurveParamFit-316"><span class="linenos">316</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="CurveParamFit-317"><a href="#CurveParamFit-317"><span class="linenos">317</span></a>                <span class="n">future_to_comb</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">,</span> <span class="n">comb</span><span class="p">,</span> <span class="n">curvename</span><span class="p">):</span> <span class="n">comb</span> <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">}</span>
</span><span id="CurveParamFit-318"><a href="#CurveParamFit-318"><span class="linenos">318</span></a>                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">combinations</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot; it&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-319"><a href="#CurveParamFit-319"><span class="linenos">319</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_comb</span><span class="p">):</span>
</span><span id="CurveParamFit-320"><a href="#CurveParamFit-320"><span class="linenos">320</span></a>                    <span class="n">comb</span> <span class="o">=</span> <span class="n">future_to_comb</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="CurveParamFit-321"><a href="#CurveParamFit-321"><span class="linenos">321</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CurveParamFit-322"><a href="#CurveParamFit-322"><span class="linenos">322</span></a>                        <span class="n">train_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>                        
</span><span id="CurveParamFit-323"><a href="#CurveParamFit-323"><span class="linenos">323</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CurveParamFit-324"><a href="#CurveParamFit-324"><span class="linenos">324</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Combination </span><span class="si">{</span><span class="n">comb</span><span class="si">}</span><span class="s1"> generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-325"><a href="#CurveParamFit-325"><span class="linenos">325</span></a>                    <span class="k">finally</span><span class="p">:</span>
</span><span id="CurveParamFit-326"><a href="#CurveParamFit-326"><span class="linenos">326</span></a>                        <span class="c1"># Update progress bar by one step for each completed task</span>
</span><span id="CurveParamFit-327"><a href="#CurveParamFit-327"><span class="linenos">327</span></a>                        <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-328"><a href="#CurveParamFit-328"><span class="linenos">328</span></a>            <span class="n">progress_bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="CurveParamFit-329"><a href="#CurveParamFit-329"><span class="linenos">329</span></a>        <span class="k">else</span><span class="p">:</span>            
</span><span id="CurveParamFit-330"><a href="#CurveParamFit-330"><span class="linenos">330</span></a>            <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">combinations</span><span class="p">):</span>
</span><span id="CurveParamFit-331"><a href="#CurveParamFit-331"><span class="linenos">331</span></a>                <span class="n">train_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">comb</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">(</span><span class="n">comb</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-332"><a href="#CurveParamFit-332"><span class="linenos">332</span></a>                 
</span><span id="CurveParamFit-333"><a href="#CurveParamFit-333"><span class="linenos">333</span></a>        <span class="c1"># Select the combination with the best (minimum) specified validation metric</span>
</span><span id="CurveParamFit-334"><a href="#CurveParamFit-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">validation_metrics</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">on</span> <span class="ow">in</span> <span class="n">metrics</span> <span class="k">for</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">validation_metrics</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="CurveParamFit-335"><a href="#CurveParamFit-335"><span class="linenos">335</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">validation_metrics</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">on</span><span class="p">])</span>
</span><span id="CurveParamFit-336"><a href="#CurveParamFit-336"><span class="linenos">336</span></a>            <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="n">train_metrics</span><span class="p">[</span><span class="n">best_combination</span><span class="p">],</span> <span class="n">validation_metrics</span><span class="p">[</span><span class="n">best_combination</span><span class="p">]</span>
</span><span id="CurveParamFit-337"><a href="#CurveParamFit-337"><span class="linenos">337</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_combination</span><span class="p">)</span>
</span><span id="CurveParamFit-338"><a href="#CurveParamFit-338"><span class="linenos">338</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-339"><a href="#CurveParamFit-339"><span class="linenos">339</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The metric &#39;</span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">&#39; is not found in the validation metrics&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-340"><a href="#CurveParamFit-340"><span class="linenos">340</span></a>
</span><span id="CurveParamFit-341"><a href="#CurveParamFit-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span>
</span><span id="CurveParamFit-342"><a href="#CurveParamFit-342"><span class="linenos">342</span></a>
</span><span id="CurveParamFit-343"><a href="#CurveParamFit-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit-344"><a href="#CurveParamFit-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-345"><a href="#CurveParamFit-345"><span class="linenos">345</span></a><span class="sd">        Performs cross-validation to find the best combination of variables for the specified curve type.</span>
</span><span id="CurveParamFit-346"><a href="#CurveParamFit-346"><span class="linenos">346</span></a><span class="sd">        </span>
</span><span id="CurveParamFit-347"><a href="#CurveParamFit-347"><span class="linenos">347</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit-348"><a href="#CurveParamFit-348"><span class="linenos">348</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit-349"><a href="#CurveParamFit-349"><span class="linenos">349</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit-350"><a href="#CurveParamFit-350"><span class="linenos">350</span></a><span class="sd">                The name of the curve used for fitting the data. This curve should be one of the supported curves.</span>
</span><span id="CurveParamFit-351"><a href="#CurveParamFit-351"><span class="linenos">351</span></a><span class="sd">            on : str, optional</span>
</span><span id="CurveParamFit-352"><a href="#CurveParamFit-352"><span class="linenos">352</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="CurveParamFit-353"><a href="#CurveParamFit-353"><span class="linenos">353</span></a>
</span><span id="CurveParamFit-354"><a href="#CurveParamFit-354"><span class="linenos">354</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit-355"><a href="#CurveParamFit-355"><span class="linenos">355</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit-356"><a href="#CurveParamFit-356"><span class="linenos">356</span></a><span class="sd">            best_combination : list</span>
</span><span id="CurveParamFit-357"><a href="#CurveParamFit-357"><span class="linenos">357</span></a><span class="sd">                The best combination of independent variables for the specified curve type.</span>
</span><span id="CurveParamFit-358"><a href="#CurveParamFit-358"><span class="linenos">358</span></a><span class="sd">            best_train_metrics : dict</span>
</span><span id="CurveParamFit-359"><a href="#CurveParamFit-359"><span class="linenos">359</span></a><span class="sd">                The performance metrics on the training set for the best combination.</span>
</span><span id="CurveParamFit-360"><a href="#CurveParamFit-360"><span class="linenos">360</span></a><span class="sd">            best_validation_metrics : dict</span>
</span><span id="CurveParamFit-361"><a href="#CurveParamFit-361"><span class="linenos">361</span></a><span class="sd">                The performance metrics on the validation set for the best combination.</span>
</span><span id="CurveParamFit-362"><a href="#CurveParamFit-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-363"><a href="#CurveParamFit-363"><span class="linenos">363</span></a>        <span class="n">perf_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MSLE&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit-364"><a href="#CurveParamFit-364"><span class="linenos">364</span></a>        <span class="k">assert</span> <span class="n">on</span> <span class="ow">in</span> <span class="n">perf_stats</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Performance comparison is made on one of the following metrics </span><span class="si">{</span><span class="n">perf_stats</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="CurveParamFit-365"><a href="#CurveParamFit-365"><span class="linenos">365</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="CurveParamFit-366"><a href="#CurveParamFit-366"><span class="linenos">366</span></a>    
</span><span id="CurveParamFit-367"><a href="#CurveParamFit-367"><span class="linenos">367</span></a>        <span class="c1"># Generate combinations based on the specified search method</span>
</span><span id="CurveParamFit-368"><a href="#CurveParamFit-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">]:</span>
</span><span id="CurveParamFit-369"><a href="#CurveParamFit-369"><span class="linenos">369</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="CurveParamFit-370"><a href="#CurveParamFit-370"><span class="linenos">370</span></a>            
</span><span id="CurveParamFit-371"><a href="#CurveParamFit-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit-372"><a href="#CurveParamFit-372"><span class="linenos">372</span></a>                <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">(</span><span class="n">best_combination</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-373"><a href="#CurveParamFit-373"><span class="linenos">373</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="CurveParamFit-374"><a href="#CurveParamFit-374"><span class="linenos">374</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-375"><a href="#CurveParamFit-375"><span class="linenos">375</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># Initialize for minimization</span>
</span><span id="CurveParamFit-376"><a href="#CurveParamFit-376"><span class="linenos">376</span></a>                <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="CurveParamFit-377"><a href="#CurveParamFit-377"><span class="linenos">377</span></a>            
</span><span id="CurveParamFit-378"><a href="#CurveParamFit-378"><span class="linenos">378</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="CurveParamFit-379"><a href="#CurveParamFit-379"><span class="linenos">379</span></a>                <span class="c1"># Generate candidate combinations for the next iteration</span>
</span><span id="CurveParamFit-380"><a href="#CurveParamFit-380"><span class="linenos">380</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit-381"><a href="#CurveParamFit-381"><span class="linenos">381</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">best_combination</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_combination</span><span class="p">))]</span> 
</span><span id="CurveParamFit-382"><a href="#CurveParamFit-382"><span class="linenos">382</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-383"><a href="#CurveParamFit-383"><span class="linenos">383</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="CurveParamFit-384"><a href="#CurveParamFit-384"><span class="linenos">384</span></a>                
</span><span id="CurveParamFit-385"><a href="#CurveParamFit-385"><span class="linenos">385</span></a>                <span class="c1"># If no candidate combinations are available, break from the loop</span>
</span><span id="CurveParamFit-386"><a href="#CurveParamFit-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">candidate_columns</span><span class="p">:</span>
</span><span id="CurveParamFit-387"><a href="#CurveParamFit-387"><span class="linenos">387</span></a>                    <span class="k">break</span>
</span><span id="CurveParamFit-388"><a href="#CurveParamFit-388"><span class="linenos">388</span></a>                
</span><span id="CurveParamFit-389"><a href="#CurveParamFit-389"><span class="linenos">389</span></a>                <span class="c1"># Find the best combination from the candidates</span>
</span><span id="CurveParamFit-390"><a href="#CurveParamFit-390"><span class="linenos">390</span></a>                <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">candidate_columns</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit-391"><a href="#CurveParamFit-391"><span class="linenos">391</span></a>                <span class="k">if</span> <span class="n">candidates_best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">best_validation_metric_value</span><span class="p">:</span>
</span><span id="CurveParamFit-392"><a href="#CurveParamFit-392"><span class="linenos">392</span></a>                    <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span>
</span><span id="CurveParamFit-393"><a href="#CurveParamFit-393"><span class="linenos">393</span></a>                    <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="CurveParamFit-394"><a href="#CurveParamFit-394"><span class="linenos">394</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-395"><a href="#CurveParamFit-395"><span class="linenos">395</span></a>                    <span class="k">break</span>
</span><span id="CurveParamFit-396"><a href="#CurveParamFit-396"><span class="linenos">396</span></a>                
</span><span id="CurveParamFit-397"><a href="#CurveParamFit-397"><span class="linenos">397</span></a>                <span class="c1"># In forward search, remove selected columns from the list of remaining columns</span>
</span><span id="CurveParamFit-398"><a href="#CurveParamFit-398"><span class="linenos">398</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">and</span> <span class="n">best_combination</span><span class="p">:</span>
</span><span id="CurveParamFit-399"><a href="#CurveParamFit-399"><span class="linenos">399</span></a>                    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="CurveParamFit-400"><a href="#CurveParamFit-400"><span class="linenos">400</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="CurveParamFit-401"><a href="#CurveParamFit-401"><span class="linenos">401</span></a>                        <span class="k">break</span>
</span><span id="CurveParamFit-402"><a href="#CurveParamFit-402"><span class="linenos">402</span></a>
</span><span id="CurveParamFit-403"><a href="#CurveParamFit-403"><span class="linenos">403</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit-404"><a href="#CurveParamFit-404"><span class="linenos">404</span></a>            <span class="c1"># Evaluate all possible combinations of columns</span>
</span><span id="CurveParamFit-405"><a href="#CurveParamFit-405"><span class="linenos">405</span></a>            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
</span><span id="CurveParamFit-406"><a href="#CurveParamFit-406"><span class="linenos">406</span></a>            <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit-407"><a href="#CurveParamFit-407"><span class="linenos">407</span></a>
</span><span id="CurveParamFit-408"><a href="#CurveParamFit-408"><span class="linenos">408</span></a>        <span class="c1"># Return the best combination of features and the corresponding training and validation metrics</span>
</span><span id="CurveParamFit-409"><a href="#CurveParamFit-409"><span class="linenos">409</span></a>        <span class="k">return</span> <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span>
</span><span id="CurveParamFit-410"><a href="#CurveParamFit-410"><span class="linenos">410</span></a>    
</span><span id="CurveParamFit-411"><a href="#CurveParamFit-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">variable_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit-412"><a href="#CurveParamFit-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-413"><a href="#CurveParamFit-413"><span class="linenos">413</span></a><span class="sd">        Performs variable selection for each curve type and returns the best curve based on the specified metric.</span>
</span><span id="CurveParamFit-414"><a href="#CurveParamFit-414"><span class="linenos">414</span></a><span class="sd">        The function also returns the performance metrics for each curve type.</span>
</span><span id="CurveParamFit-415"><a href="#CurveParamFit-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="CurveParamFit-416"><a href="#CurveParamFit-416"><span class="linenos">416</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit-417"><a href="#CurveParamFit-417"><span class="linenos">417</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit-418"><a href="#CurveParamFit-418"><span class="linenos">418</span></a><span class="sd">            on : str, optional</span>
</span><span id="CurveParamFit-419"><a href="#CurveParamFit-419"><span class="linenos">419</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="CurveParamFit-420"><a href="#CurveParamFit-420"><span class="linenos">420</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="CurveParamFit-421"><a href="#CurveParamFit-421"><span class="linenos">421</span></a><span class="sd">                Whether to print the results. Default is True.</span>
</span><span id="CurveParamFit-422"><a href="#CurveParamFit-422"><span class="linenos">422</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit-423"><a href="#CurveParamFit-423"><span class="linenos">423</span></a><span class="sd">                Whether to plot the performance comparison. Default is True.</span>
</span><span id="CurveParamFit-424"><a href="#CurveParamFit-424"><span class="linenos">424</span></a>
</span><span id="CurveParamFit-425"><a href="#CurveParamFit-425"><span class="linenos">425</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit-426"><a href="#CurveParamFit-426"><span class="linenos">426</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit-427"><a href="#CurveParamFit-427"><span class="linenos">427</span></a><span class="sd">            best_curve : str</span>
</span><span id="CurveParamFit-428"><a href="#CurveParamFit-428"><span class="linenos">428</span></a><span class="sd">                The best curve based on the specified metric.</span>
</span><span id="CurveParamFit-429"><a href="#CurveParamFit-429"><span class="linenos">429</span></a><span class="sd">            varselect_result : pd.DataFrame</span>
</span><span id="CurveParamFit-430"><a href="#CurveParamFit-430"><span class="linenos">430</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="CurveParamFit-431"><a href="#CurveParamFit-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-432"><a href="#CurveParamFit-432"><span class="linenos">432</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveParamFit-433"><a href="#CurveParamFit-433"><span class="linenos">433</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CurveParamFit-434"><a href="#CurveParamFit-434"><span class="linenos">434</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-435"><a href="#CurveParamFit-435"><span class="linenos">435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit-436"><a href="#CurveParamFit-436"><span class="linenos">436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2"> curve&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-437"><a href="#CurveParamFit-437"><span class="linenos">437</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit-438"><a href="#CurveParamFit-438"><span class="linenos">438</span></a>            <span class="c1"># Perform cross-validation and gather metrics</span>
</span><span id="CurveParamFit-439"><a href="#CurveParamFit-439"><span class="linenos">439</span></a>            <span class="n">combination</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit-440"><a href="#CurveParamFit-440"><span class="linenos">440</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit-441"><a href="#CurveParamFit-441"><span class="linenos">441</span></a>                <span class="s1">&#39;Curve&#39;</span><span class="p">:</span> <span class="n">curvename</span><span class="p">,</span>
</span><span id="CurveParamFit-442"><a href="#CurveParamFit-442"><span class="linenos">442</span></a>                <span class="s1">&#39;Best Combination&#39;</span><span class="p">:</span> <span class="n">combination</span><span class="p">,</span>
</span><span id="CurveParamFit-443"><a href="#CurveParamFit-443"><span class="linenos">443</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="CurveParamFit-444"><a href="#CurveParamFit-444"><span class="linenos">444</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CurveParamFit-445"><a href="#CurveParamFit-445"><span class="linenos">445</span></a>            <span class="p">}</span>
</span><span id="CurveParamFit-446"><a href="#CurveParamFit-446"><span class="linenos">446</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="CurveParamFit-447"><a href="#CurveParamFit-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-448"><a href="#CurveParamFit-448"><span class="linenos">448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best combination for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">combination</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-449"><a href="#CurveParamFit-449"><span class="linenos">449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-450"><a href="#CurveParamFit-450"><span class="linenos">450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-451"><a href="#CurveParamFit-451"><span class="linenos">451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-452"><a href="#CurveParamFit-452"><span class="linenos">452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit-453"><a href="#CurveParamFit-453"><span class="linenos">453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-454"><a href="#CurveParamFit-454"><span class="linenos">454</span></a>        <span class="n">cv_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># Store for later use</span>
</span><span id="CurveParamFit-455"><a href="#CurveParamFit-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">cv_result</span>
</span><span id="CurveParamFit-456"><a href="#CurveParamFit-456"><span class="linenos">456</span></a>
</span><span id="CurveParamFit-457"><a href="#CurveParamFit-457"><span class="linenos">457</span></a>        <span class="c1"># Optionally identify the best curve based on a specific validation metric, e.g., RMSE</span>
</span><span id="CurveParamFit-458"><a href="#CurveParamFit-458"><span class="linenos">458</span></a>        <span class="n">best_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit-459"><a href="#CurveParamFit-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-460"><a href="#CurveParamFit-460"><span class="linenos">460</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit-461"><a href="#CurveParamFit-461"><span class="linenos">461</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best curve based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_curve</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m curve&quot;</span><span class="p">)</span>            
</span><span id="CurveParamFit-462"><a href="#CurveParamFit-462"><span class="linenos">462</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit-463"><a href="#CurveParamFit-463"><span class="linenos">463</span></a>
</span><span id="CurveParamFit-464"><a href="#CurveParamFit-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit-465"><a href="#CurveParamFit-465"><span class="linenos">465</span></a>            <span class="n">_oncomp</span> <span class="o">=</span> <span class="n">cv_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Curve&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-466"><a href="#CurveParamFit-466"><span class="linenos">466</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit-467"><a href="#CurveParamFit-467"><span class="linenos">467</span></a>            <span class="n">_oncomp</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveParamFit-468"><a href="#CurveParamFit-468"><span class="linenos">468</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit-469"><a href="#CurveParamFit-469"><span class="linenos">469</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for different curves&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-470"><a href="#CurveParamFit-470"><span class="linenos">470</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit-471"><a href="#CurveParamFit-471"><span class="linenos">471</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit-472"><a href="#CurveParamFit-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">best_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span>
</span><span id="CurveParamFit-473"><a href="#CurveParamFit-473"><span class="linenos">473</span></a>
</span><span id="CurveParamFit-474"><a href="#CurveParamFit-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="nf">indep_vars_occurence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit-475"><a href="#CurveParamFit-475"><span class="linenos">475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-476"><a href="#CurveParamFit-476"><span class="linenos">476</span></a><span class="sd">        Gives the number of occurences of each independent variable in the best combinations of variables for each curve.</span>
</span><span id="CurveParamFit-477"><a href="#CurveParamFit-477"><span class="linenos">477</span></a><span class="sd">        The function can be used to identify the most important variables in the dataset.</span>
</span><span id="CurveParamFit-478"><a href="#CurveParamFit-478"><span class="linenos">478</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit-479"><a href="#CurveParamFit-479"><span class="linenos">479</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit-480"><a href="#CurveParamFit-480"><span class="linenos">480</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="CurveParamFit-481"><a href="#CurveParamFit-481"><span class="linenos">481</span></a><span class="sd">                Whether to normalize the occurrences as a percentage. Default is True.</span>
</span><span id="CurveParamFit-482"><a href="#CurveParamFit-482"><span class="linenos">482</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit-483"><a href="#CurveParamFit-483"><span class="linenos">483</span></a><span class="sd">                Whether to plot the occurrences. Default is True.</span>
</span><span id="CurveParamFit-484"><a href="#CurveParamFit-484"><span class="linenos">484</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit-485"><a href="#CurveParamFit-485"><span class="linenos">485</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit-486"><a href="#CurveParamFit-486"><span class="linenos">486</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit-487"><a href="#CurveParamFit-487"><span class="linenos">487</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit-488"><a href="#CurveParamFit-488"><span class="linenos">488</span></a><span class="sd">            variable_percentage : pd.Series</span>
</span><span id="CurveParamFit-489"><a href="#CurveParamFit-489"><span class="linenos">489</span></a><span class="sd">                The percentage of occurrence of each independent variable in the best combinations.</span>
</span><span id="CurveParamFit-490"><a href="#CurveParamFit-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-491"><a href="#CurveParamFit-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CurveParamFit-492"><a href="#CurveParamFit-492"><span class="linenos">492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit-493"><a href="#CurveParamFit-493"><span class="linenos">493</span></a>        <span class="n">curves_best_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit-494"><a href="#CurveParamFit-494"><span class="linenos">494</span></a>        <span class="c1"># curves_best_combo = self.varselect_result.set_index(&#39;Curve&#39;)[&#39;Best Combination&#39;]</span>
</span><span id="CurveParamFit-495"><a href="#CurveParamFit-495"><span class="linenos">495</span></a>        <span class="n">all_variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">curves_best_combo</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="CurveParamFit-496"><a href="#CurveParamFit-496"><span class="linenos">496</span></a>
</span><span id="CurveParamFit-497"><a href="#CurveParamFit-497"><span class="linenos">497</span></a>        <span class="c1"># Count occurrences of each variable</span>
</span><span id="CurveParamFit-498"><a href="#CurveParamFit-498"><span class="linenos">498</span></a>        <span class="n">variable_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_variables</span><span class="p">)</span>
</span><span id="CurveParamFit-499"><a href="#CurveParamFit-499"><span class="linenos">499</span></a>
</span><span id="CurveParamFit-500"><a href="#CurveParamFit-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="CurveParamFit-501"><a href="#CurveParamFit-501"><span class="linenos">501</span></a>            <span class="c1"># Compute the percentage for each variable</span>
</span><span id="CurveParamFit-502"><a href="#CurveParamFit-502"><span class="linenos">502</span></a>            <span class="n">total_curves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_best_combo</span><span class="p">)</span>
</span><span id="CurveParamFit-503"><a href="#CurveParamFit-503"><span class="linenos">503</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">total_curves</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">variable_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="CurveParamFit-504"><a href="#CurveParamFit-504"><span class="linenos">504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-505"><a href="#CurveParamFit-505"><span class="linenos">505</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">variable_counts</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="CurveParamFit-506"><a href="#CurveParamFit-506"><span class="linenos">506</span></a>
</span><span id="CurveParamFit-507"><a href="#CurveParamFit-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit-508"><a href="#CurveParamFit-508"><span class="linenos">508</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Percentage of Occurrence&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;Number of Occurrence&#39;</span>
</span><span id="CurveParamFit-509"><a href="#CurveParamFit-509"><span class="linenos">509</span></a>            
</span><span id="CurveParamFit-510"><a href="#CurveParamFit-510"><span class="linenos">510</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit-511"><a href="#CurveParamFit-511"><span class="linenos">511</span></a>            <span class="n">variable_percentage</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveParamFit-512"><a href="#CurveParamFit-512"><span class="linenos">512</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
</span><span id="CurveParamFit-513"><a href="#CurveParamFit-513"><span class="linenos">513</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Independent Variables&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-514"><a href="#CurveParamFit-514"><span class="linenos">514</span></a>            <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit-515"><a href="#CurveParamFit-515"><span class="linenos">515</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Occurrence of Independent Variables in best combinations per curve&#39;</span>
</span><span id="CurveParamFit-516"><a href="#CurveParamFit-516"><span class="linenos">516</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveParamFit-517"><a href="#CurveParamFit-517"><span class="linenos">517</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit-518"><a href="#CurveParamFit-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="n">variable_percentage</span>
</span><span id="CurveParamFit-519"><a href="#CurveParamFit-519"><span class="linenos">519</span></a>    
</span><span id="CurveParamFit-520"><a href="#CurveParamFit-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">_get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">xcols</span><span class="p">):</span>
</span><span id="CurveParamFit-521"><a href="#CurveParamFit-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the parameters from the optimized curve parameters.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-522"><a href="#CurveParamFit-522"><span class="linenos">522</span></a>        <span class="n">paramnames</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">+</span> <span class="n">xcols</span>
</span><span id="CurveParamFit-523"><a href="#CurveParamFit-523"><span class="linenos">523</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">paramnames</span><span class="p">[</span><span class="n">_i</span><span class="p">]:</span> <span class="n">popt</span><span class="p">[</span><span class="n">_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paramnames</span><span class="p">))}</span>           
</span><span id="CurveParamFit-524"><a href="#CurveParamFit-524"><span class="linenos">524</span></a>    
</span><span id="CurveParamFit-525"><a href="#CurveParamFit-525"><span class="linenos">525</span></a>    <span class="k">def</span> <span class="nf">_fit_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">xcols</span><span class="p">):</span>
</span><span id="CurveParamFit-526"><a href="#CurveParamFit-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits the curve to the data using a selected list of exogenous variables.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-527"><a href="#CurveParamFit-527"><span class="linenos">527</span></a>        <span class="c1"># Fit the model with the best combination of variables</span>
</span><span id="CurveParamFit-528"><a href="#CurveParamFit-528"><span class="linenos">528</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span>
</span><span id="CurveParamFit-529"><a href="#CurveParamFit-529"><span class="linenos">529</span></a>        <span class="c1"># Fit the mean curve        </span>
</span><span id="CurveParamFit-530"><a href="#CurveParamFit-530"><span class="linenos">530</span></a>        <span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="CurveParamFit-531"><a href="#CurveParamFit-531"><span class="linenos">531</span></a>        <span class="c1"># Fit the upper and lower curves for the confidence interval</span>
</span><span id="CurveParamFit-532"><a href="#CurveParamFit-532"><span class="linenos">532</span></a>        <span class="n">qlb</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="CurveParamFit-533"><a href="#CurveParamFit-533"><span class="linenos">533</span></a>        <span class="n">qub</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">qlb</span>
</span><span id="CurveParamFit-534"><a href="#CurveParamFit-534"><span class="linenos">534</span></a>        <span class="n">popt_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">qub</span><span class="p">,</span> <span class="n">winit</span> <span class="o">=</span> <span class="n">popt</span><span class="p">)</span>
</span><span id="CurveParamFit-535"><a href="#CurveParamFit-535"><span class="linenos">535</span></a>        <span class="n">popt_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curveOpt</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">qlb</span><span class="p">,</span> <span class="n">winit</span> <span class="o">=</span> <span class="n">popt</span><span class="p">)</span>
</span><span id="CurveParamFit-536"><a href="#CurveParamFit-536"><span class="linenos">536</span></a>
</span><span id="CurveParamFit-537"><a href="#CurveParamFit-537"><span class="linenos">537</span></a>        <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span>
</span><span id="CurveParamFit-538"><a href="#CurveParamFit-538"><span class="linenos">538</span></a>
</span><span id="CurveParamFit-539"><a href="#CurveParamFit-539"><span class="linenos">539</span></a>    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xcols</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span><span class="p">):</span>
</span><span id="CurveParamFit-540"><a href="#CurveParamFit-540"><span class="linenos">540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predicts the dependent variable using the fitted curve and the confidence interval.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-541"><a href="#CurveParamFit-541"><span class="linenos">541</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span>
</span><span id="CurveParamFit-542"><a href="#CurveParamFit-542"><span class="linenos">542</span></a>        <span class="n">ypred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-543"><a href="#CurveParamFit-543"><span class="linenos">543</span></a>        <span class="n">yqlb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt_down</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-544"><a href="#CurveParamFit-544"><span class="linenos">544</span></a>        <span class="n">yqub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-545"><a href="#CurveParamFit-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">X</span>
</span><span id="CurveParamFit-546"><a href="#CurveParamFit-546"><span class="linenos">546</span></a>
</span><span id="CurveParamFit-547"><a href="#CurveParamFit-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">fit_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CurveParamFit-548"><a href="#CurveParamFit-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits the best curve for each curve type based on the selected variables.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-549"><a href="#CurveParamFit-549"><span class="linenos">549</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CurveParamFit-550"><a href="#CurveParamFit-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit-551"><a href="#CurveParamFit-551"><span class="linenos">551</span></a>        
</span><span id="CurveParamFit-552"><a href="#CurveParamFit-552"><span class="linenos">552</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="CurveParamFit-553"><a href="#CurveParamFit-553"><span class="linenos">553</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">curvename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
</span><span id="CurveParamFit-554"><a href="#CurveParamFit-554"><span class="linenos">554</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-555"><a href="#CurveParamFit-555"><span class="linenos">555</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="CurveParamFit-556"><a href="#CurveParamFit-556"><span class="linenos">556</span></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
</span><span id="CurveParamFit-557"><a href="#CurveParamFit-557"><span class="linenos">557</span></a>                
</span><span id="CurveParamFit-558"><a href="#CurveParamFit-558"><span class="linenos">558</span></a>                <span class="k">for</span> <span class="n">future</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
</span><span id="CurveParamFit-559"><a href="#CurveParamFit-559"><span class="linenos">559</span></a>                    <span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span> <span class="o">=</span> <span class="n">task</span>
</span><span id="CurveParamFit-560"><a href="#CurveParamFit-560"><span class="linenos">560</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CurveParamFit-561"><a href="#CurveParamFit-561"><span class="linenos">561</span></a>                        <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="CurveParamFit-562"><a href="#CurveParamFit-562"><span class="linenos">562</span></a>                        <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="n">popt_down</span><span class="p">}</span>
</span><span id="CurveParamFit-563"><a href="#CurveParamFit-563"><span class="linenos">563</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CurveParamFit-564"><a href="#CurveParamFit-564"><span class="linenos">564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s1"> curve fitting generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-565"><a href="#CurveParamFit-565"><span class="linenos">565</span></a>        <span class="k">else</span><span class="p">:</span> 
</span><span id="CurveParamFit-566"><a href="#CurveParamFit-566"><span class="linenos">566</span></a>            <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="CurveParamFit-567"><a href="#CurveParamFit-567"><span class="linenos">567</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-568"><a href="#CurveParamFit-568"><span class="linenos">568</span></a>            <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="CurveParamFit-569"><a href="#CurveParamFit-569"><span class="linenos">569</span></a>                <span class="n">best_combination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit-570"><a href="#CurveParamFit-570"><span class="linenos">570</span></a>                <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span><span class="p">)</span>
</span><span id="CurveParamFit-571"><a href="#CurveParamFit-571"><span class="linenos">571</span></a>                <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span><span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span><span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span><span class="n">popt_down</span><span class="p">}</span>
</span><span id="CurveParamFit-572"><a href="#CurveParamFit-572"><span class="linenos">572</span></a>
</span><span id="CurveParamFit-573"><a href="#CurveParamFit-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="n">_best_params</span>
</span><span id="CurveParamFit-574"><a href="#CurveParamFit-574"><span class="linenos">574</span></a>        <span class="k">return</span> <span class="n">_best_params</span>
</span><span id="CurveParamFit-575"><a href="#CurveParamFit-575"><span class="linenos">575</span></a>    
</span><span id="CurveParamFit-576"><a href="#CurveParamFit-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">compare_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit-577"><a href="#CurveParamFit-577"><span class="linenos">577</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-578"><a href="#CurveParamFit-578"><span class="linenos">578</span></a><span class="sd">        Compares the best curves for each curve type based on the performance metrics.</span>
</span><span id="CurveParamFit-579"><a href="#CurveParamFit-579"><span class="linenos">579</span></a><span class="sd">        The function also returns the performance metrics, the predictions, and the parameters for each curve type.</span>
</span><span id="CurveParamFit-580"><a href="#CurveParamFit-580"><span class="linenos">580</span></a>
</span><span id="CurveParamFit-581"><a href="#CurveParamFit-581"><span class="linenos">581</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit-582"><a href="#CurveParamFit-582"><span class="linenos">582</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit-583"><a href="#CurveParamFit-583"><span class="linenos">583</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit-584"><a href="#CurveParamFit-584"><span class="linenos">584</span></a><span class="sd">                Whether to plot the best curves. Default is True.</span>
</span><span id="CurveParamFit-585"><a href="#CurveParamFit-585"><span class="linenos">585</span></a><span class="sd">            CI : bool, optional</span>
</span><span id="CurveParamFit-586"><a href="#CurveParamFit-586"><span class="linenos">586</span></a><span class="sd">                Whether to plot the confidence interval. Default is True.</span>
</span><span id="CurveParamFit-587"><a href="#CurveParamFit-587"><span class="linenos">587</span></a><span class="sd">            </span>
</span><span id="CurveParamFit-588"><a href="#CurveParamFit-588"><span class="linenos">588</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit-589"><a href="#CurveParamFit-589"><span class="linenos">589</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit-590"><a href="#CurveParamFit-590"><span class="linenos">590</span></a><span class="sd">            perf_metrics_df : pd.DataFrame</span>
</span><span id="CurveParamFit-591"><a href="#CurveParamFit-591"><span class="linenos">591</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="CurveParamFit-592"><a href="#CurveParamFit-592"><span class="linenos">592</span></a><span class="sd">            predictions_df : pd.DataFrame</span>
</span><span id="CurveParamFit-593"><a href="#CurveParamFit-593"><span class="linenos">593</span></a><span class="sd">                The predictions for each curve type.</span>
</span><span id="CurveParamFit-594"><a href="#CurveParamFit-594"><span class="linenos">594</span></a><span class="sd">            param_df : pd.DataFrame</span>
</span><span id="CurveParamFit-595"><a href="#CurveParamFit-595"><span class="linenos">595</span></a><span class="sd">                The parameters for each curve type.</span>
</span><span id="CurveParamFit-596"><a href="#CurveParamFit-596"><span class="linenos">596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-597"><a href="#CurveParamFit-597"><span class="linenos">597</span></a>
</span><span id="CurveParamFit-598"><a href="#CurveParamFit-598"><span class="linenos">598</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-599"><a href="#CurveParamFit-599"><span class="linenos">599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="CurveParamFit-600"><a href="#CurveParamFit-600"><span class="linenos">600</span></a>                
</span><span id="CurveParamFit-601"><a href="#CurveParamFit-601"><span class="linenos">601</span></a>        <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="CurveParamFit-602"><a href="#CurveParamFit-602"><span class="linenos">602</span></a>        <span class="n">predictions_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-603"><a href="#CurveParamFit-603"><span class="linenos">603</span></a>        <span class="n">params_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-604"><a href="#CurveParamFit-604"><span class="linenos">604</span></a>        <span class="n">perf_metrics_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit-605"><a href="#CurveParamFit-605"><span class="linenos">605</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="CurveParamFit-606"><a href="#CurveParamFit-606"><span class="linenos">606</span></a>            <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="CurveParamFit-607"><a href="#CurveParamFit-607"><span class="linenos">607</span></a>            <span class="n">params_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span> 
</span><span id="CurveParamFit-608"><a href="#CurveParamFit-608"><span class="linenos">608</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span>
</span><span id="CurveParamFit-609"><a href="#CurveParamFit-609"><span class="linenos">609</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]))</span>
</span><span id="CurveParamFit-610"><a href="#CurveParamFit-610"><span class="linenos">610</span></a>                                            <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="s1">&#39;upper bound&#39;</span><span class="p">,</span> <span class="s1">&#39;lower bound&#39;</span><span class="p">])</span>
</span><span id="CurveParamFit-611"><a href="#CurveParamFit-611"><span class="linenos">611</span></a>            <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-612"><a href="#CurveParamFit-612"><span class="linenos">612</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit-613"><a href="#CurveParamFit-613"><span class="linenos">613</span></a>            <span class="n">perf_metrics_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">perf_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="p">)</span>
</span><span id="CurveParamFit-614"><a href="#CurveParamFit-614"><span class="linenos">614</span></a>        
</span><span id="CurveParamFit-615"><a href="#CurveParamFit-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit-616"><a href="#CurveParamFit-616"><span class="linenos">616</span></a>            <span class="n">curves_l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictions_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CurveParamFit-617"><a href="#CurveParamFit-617"><span class="linenos">617</span></a>            <span class="n">nplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_l</span><span class="p">)</span> 
</span><span id="CurveParamFit-618"><a href="#CurveParamFit-618"><span class="linenos">618</span></a>            <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="CurveParamFit-619"><a href="#CurveParamFit-619"><span class="linenos">619</span></a>            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveParamFit-620"><a href="#CurveParamFit-620"><span class="linenos">620</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit-621"><a href="#CurveParamFit-621"><span class="linenos">621</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">curves_l</span><span class="p">):</span>
</span><span id="CurveParamFit-622"><a href="#CurveParamFit-622"><span class="linenos">622</span></a>                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-623"><a href="#CurveParamFit-623"><span class="linenos">623</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>
</span><span id="CurveParamFit-624"><a href="#CurveParamFit-624"><span class="linenos">624</span></a>                <span class="k">if</span> <span class="n">CI</span><span class="p">:</span>
</span><span id="CurveParamFit-625"><a href="#CurveParamFit-625"><span class="linenos">625</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span> 
</span><span id="CurveParamFit-626"><a href="#CurveParamFit-626"><span class="linenos">626</span></a>                <span class="k">else</span> <span class="p">:</span>
</span><span id="CurveParamFit-627"><a href="#CurveParamFit-627"><span class="linenos">627</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit-628"><a href="#CurveParamFit-628"><span class="linenos">628</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveParamFit-629"><a href="#CurveParamFit-629"><span class="linenos">629</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit-630"><a href="#CurveParamFit-630"><span class="linenos">630</span></a>
</span><span id="CurveParamFit-631"><a href="#CurveParamFit-631"><span class="linenos">631</span></a>        <span class="n">perf_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">perf_metrics_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-632"><a href="#CurveParamFit-632"><span class="linenos">632</span></a>        <span class="n">param_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">params_d</span><span class="p">)</span>
</span><span id="CurveParamFit-633"><a href="#CurveParamFit-633"><span class="linenos">633</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">predictions_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
</span><span id="CurveParamFit-634"><a href="#CurveParamFit-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="n">perf_metrics_df</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">,</span> <span class="n">param_df</span>
</span><span id="CurveParamFit-635"><a href="#CurveParamFit-635"><span class="linenos">635</span></a>    
</span><span id="CurveParamFit-636"><a href="#CurveParamFit-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">predict_best_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CurveParamFit-637"><a href="#CurveParamFit-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-638"><a href="#CurveParamFit-638"><span class="linenos">638</span></a><span class="sd">        Predicts the dependent variable using the best curve for the specified curve type.</span>
</span><span id="CurveParamFit-639"><a href="#CurveParamFit-639"><span class="linenos">639</span></a>
</span><span id="CurveParamFit-640"><a href="#CurveParamFit-640"><span class="linenos">640</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit-641"><a href="#CurveParamFit-641"><span class="linenos">641</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit-642"><a href="#CurveParamFit-642"><span class="linenos">642</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit-643"><a href="#CurveParamFit-643"><span class="linenos">643</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="CurveParamFit-644"><a href="#CurveParamFit-644"><span class="linenos">644</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="CurveParamFit-645"><a href="#CurveParamFit-645"><span class="linenos">645</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="CurveParamFit-646"><a href="#CurveParamFit-646"><span class="linenos">646</span></a><span class="sd">                The independent variables to use for prediction. Default is None.</span>
</span><span id="CurveParamFit-647"><a href="#CurveParamFit-647"><span class="linenos">647</span></a>
</span><span id="CurveParamFit-648"><a href="#CurveParamFit-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit-649"><a href="#CurveParamFit-649"><span class="linenos">649</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit-650"><a href="#CurveParamFit-650"><span class="linenos">650</span></a><span class="sd">            prediction : pd.DataFrame</span>
</span><span id="CurveParamFit-651"><a href="#CurveParamFit-651"><span class="linenos">651</span></a><span class="sd">                A DataFrame containing the predicted dependent variable along with the confidence interval.        </span>
</span><span id="CurveParamFit-652"><a href="#CurveParamFit-652"><span class="linenos">652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-653"><a href="#CurveParamFit-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-654"><a href="#CurveParamFit-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="CurveParamFit-655"><a href="#CurveParamFit-655"><span class="linenos">655</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-656"><a href="#CurveParamFit-656"><span class="linenos">656</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CurveParamFit-657"><a href="#CurveParamFit-657"><span class="linenos">657</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-658"><a href="#CurveParamFit-658"><span class="linenos">658</span></a>            <span class="c1"># normalize the data</span>
</span><span id="CurveParamFit-659"><a href="#CurveParamFit-659"><span class="linenos">659</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveParamFit-660"><a href="#CurveParamFit-660"><span class="linenos">660</span></a>            <span class="c1"># add constant column if requested</span>
</span><span id="CurveParamFit-661"><a href="#CurveParamFit-661"><span class="linenos">661</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">:</span>
</span><span id="CurveParamFit-662"><a href="#CurveParamFit-662"><span class="linenos">662</span></a>                <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-663"><a href="#CurveParamFit-663"><span class="linenos">663</span></a>
</span><span id="CurveParamFit-664"><a href="#CurveParamFit-664"><span class="linenos">664</span></a>        <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="CurveParamFit-665"><a href="#CurveParamFit-665"><span class="linenos">665</span></a>        <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">])</span>
</span><span id="CurveParamFit-666"><a href="#CurveParamFit-666"><span class="linenos">666</span></a>        <span class="c1"># transform back X to the original scale</span>
</span><span id="CurveParamFit-667"><a href="#CurveParamFit-667"><span class="linenos">667</span></a>        <span class="k">if</span> <span class="s1">&#39;constant&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CurveParamFit-668"><a href="#CurveParamFit-668"><span class="linenos">668</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-669"><a href="#CurveParamFit-669"><span class="linenos">669</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="CurveParamFit-670"><a href="#CurveParamFit-670"><span class="linenos">670</span></a>            <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-671"><a href="#CurveParamFit-671"><span class="linenos">671</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-672"><a href="#CurveParamFit-672"><span class="linenos">672</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="CurveParamFit-673"><a href="#CurveParamFit-673"><span class="linenos">673</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-674"><a href="#CurveParamFit-674"><span class="linenos">674</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span><span id="CurveParamFit-675"><a href="#CurveParamFit-675"><span class="linenos">675</span></a>    
</span><span id="CurveParamFit-676"><a href="#CurveParamFit-676"><span class="linenos">676</span></a>    <span class="k">def</span> <span class="nf">most_probable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">known_value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit-677"><a href="#CurveParamFit-677"><span class="linenos">677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-678"><a href="#CurveParamFit-678"><span class="linenos">678</span></a><span class="sd">        Estimates the most probable value of a dependent or independent variable using a fitted curve,</span>
</span><span id="CurveParamFit-679"><a href="#CurveParamFit-679"><span class="linenos">679</span></a><span class="sd">        based on a provided known value. </span>
</span><span id="CurveParamFit-680"><a href="#CurveParamFit-680"><span class="linenos">680</span></a><span class="sd">        This method performs linear interpolation between the closest data points or uses boundary values</span>
</span><span id="CurveParamFit-681"><a href="#CurveParamFit-681"><span class="linenos">681</span></a><span class="sd">        if the known value exceeds the available data range.</span>
</span><span id="CurveParamFit-682"><a href="#CurveParamFit-682"><span class="linenos">682</span></a>
</span><span id="CurveParamFit-683"><a href="#CurveParamFit-683"><span class="linenos">683</span></a><span class="sd">        This function is particularly useful when you have a value of one variable and need to estimate</span>
</span><span id="CurveParamFit-684"><a href="#CurveParamFit-684"><span class="linenos">684</span></a><span class="sd">        the corresponding value of another variable based on the relationship defined by the specified curve.</span>
</span><span id="CurveParamFit-685"><a href="#CurveParamFit-685"><span class="linenos">685</span></a>
</span><span id="CurveParamFit-686"><a href="#CurveParamFit-686"><span class="linenos">686</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit-687"><a href="#CurveParamFit-687"><span class="linenos">687</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit-688"><a href="#CurveParamFit-688"><span class="linenos">688</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit-689"><a href="#CurveParamFit-689"><span class="linenos">689</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="CurveParamFit-690"><a href="#CurveParamFit-690"><span class="linenos">690</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="CurveParamFit-691"><a href="#CurveParamFit-691"><span class="linenos">691</span></a><span class="sd">            </span>
</span><span id="CurveParamFit-692"><a href="#CurveParamFit-692"><span class="linenos">692</span></a><span class="sd">            known_value : tuple</span>
</span><span id="CurveParamFit-693"><a href="#CurveParamFit-693"><span class="linenos">693</span></a><span class="sd">                A tuple containing:</span>
</span><span id="CurveParamFit-694"><a href="#CurveParamFit-694"><span class="linenos">694</span></a><span class="sd">                - The name of the variable (str) for which the value is known.</span>
</span><span id="CurveParamFit-695"><a href="#CurveParamFit-695"><span class="linenos">695</span></a><span class="sd">                - The known value (float) of that variable.</span>
</span><span id="CurveParamFit-696"><a href="#CurveParamFit-696"><span class="linenos">696</span></a>
</span><span id="CurveParamFit-697"><a href="#CurveParamFit-697"><span class="linenos">697</span></a><span class="sd">                The variable name must be one of the dependent or main independent variables used in the model.</span>
</span><span id="CurveParamFit-698"><a href="#CurveParamFit-698"><span class="linenos">698</span></a>
</span><span id="CurveParamFit-699"><a href="#CurveParamFit-699"><span class="linenos">699</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit-700"><a href="#CurveParamFit-700"><span class="linenos">700</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit-701"><a href="#CurveParamFit-701"><span class="linenos">701</span></a><span class="sd">            float</span>
</span><span id="CurveParamFit-702"><a href="#CurveParamFit-702"><span class="linenos">702</span></a><span class="sd">                The estimated value of the other variable. This could be an interpolated value between data points</span>
</span><span id="CurveParamFit-703"><a href="#CurveParamFit-703"><span class="linenos">703</span></a><span class="sd">                or a boundary value if the known value is outside the range of the available data.</span>
</span><span id="CurveParamFit-704"><a href="#CurveParamFit-704"><span class="linenos">704</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-705"><a href="#CurveParamFit-705"><span class="linenos">705</span></a>        <span class="n">dep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span>
</span><span id="CurveParamFit-706"><a href="#CurveParamFit-706"><span class="linenos">706</span></a>        <span class="n">main_indep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span>
</span><span id="CurveParamFit-707"><a href="#CurveParamFit-707"><span class="linenos">707</span></a>        <span class="k">assert</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dep_var</span><span class="p">,</span> <span class="n">main_indep_var</span><span class="p">],</span> <span class="s2">&quot;known_value[0] must be either dep_var or main_indep_var&quot;</span>
</span><span id="CurveParamFit-708"><a href="#CurveParamFit-708"><span class="linenos">708</span></a>        
</span><span id="CurveParamFit-709"><a href="#CurveParamFit-709"><span class="linenos">709</span></a>        <span class="c1"># Fetch the predictions and adjust column names</span>
</span><span id="CurveParamFit-710"><a href="#CurveParamFit-710"><span class="linenos">710</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="o">=</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="CurveParamFit-711"><a href="#CurveParamFit-711"><span class="linenos">711</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">dep_var</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CurveParamFit-712"><a href="#CurveParamFit-712"><span class="linenos">712</span></a>        
</span><span id="CurveParamFit-713"><a href="#CurveParamFit-713"><span class="linenos">713</span></a>        <span class="c1"># Sort DataFrame by the variable of interest</span>
</span><span id="CurveParamFit-714"><a href="#CurveParamFit-714"><span class="linenos">714</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CurveParamFit-715"><a href="#CurveParamFit-715"><span class="linenos">715</span></a>        
</span><span id="CurveParamFit-716"><a href="#CurveParamFit-716"><span class="linenos">716</span></a>        <span class="c1"># Find rows where the known value is just above and below the input value</span>
</span><span id="CurveParamFit-717"><a href="#CurveParamFit-717"><span class="linenos">717</span></a>        <span class="n">filter_above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-718"><a href="#CurveParamFit-718"><span class="linenos">718</span></a>        <span class="n">filter_below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-719"><a href="#CurveParamFit-719"><span class="linenos">719</span></a>        
</span><span id="CurveParamFit-720"><a href="#CurveParamFit-720"><span class="linenos">720</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_above</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CurveParamFit-721"><a href="#CurveParamFit-721"><span class="linenos">721</span></a>            <span class="c1"># If known value is above all available data points</span>
</span><span id="CurveParamFit-722"><a href="#CurveParamFit-722"><span class="linenos">722</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-723"><a href="#CurveParamFit-723"><span class="linenos">723</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-724"><a href="#CurveParamFit-724"><span class="linenos">724</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is above the highest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-725"><a href="#CurveParamFit-725"><span class="linenos">725</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit-726"><a href="#CurveParamFit-726"><span class="linenos">726</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-727"><a href="#CurveParamFit-727"><span class="linenos">727</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-728"><a href="#CurveParamFit-728"><span class="linenos">728</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-729"><a href="#CurveParamFit-729"><span class="linenos">729</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">filter_below</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CurveParamFit-730"><a href="#CurveParamFit-730"><span class="linenos">730</span></a>            <span class="c1"># If known value is below all available data points</span>
</span><span id="CurveParamFit-731"><a href="#CurveParamFit-731"><span class="linenos">731</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit-732"><a href="#CurveParamFit-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-733"><a href="#CurveParamFit-733"><span class="linenos">733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is below the lowest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-734"><a href="#CurveParamFit-734"><span class="linenos">734</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit-735"><a href="#CurveParamFit-735"><span class="linenos">735</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-736"><a href="#CurveParamFit-736"><span class="linenos">736</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-737"><a href="#CurveParamFit-737"><span class="linenos">737</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-738"><a href="#CurveParamFit-738"><span class="linenos">738</span></a>        
</span><span id="CurveParamFit-739"><a href="#CurveParamFit-739"><span class="linenos">739</span></a>        <span class="n">above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_above</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit-740"><a href="#CurveParamFit-740"><span class="linenos">740</span></a>        <span class="n">below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_below</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-741"><a href="#CurveParamFit-741"><span class="linenos">741</span></a>        
</span><span id="CurveParamFit-742"><a href="#CurveParamFit-742"><span class="linenos">742</span></a>        <span class="n">x_above</span><span class="p">,</span> <span class="n">y_above</span> <span class="o">=</span> <span class="n">above</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">above</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-743"><a href="#CurveParamFit-743"><span class="linenos">743</span></a>        <span class="n">x_below</span><span class="p">,</span> <span class="n">y_below</span> <span class="o">=</span> <span class="n">below</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">below</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit-744"><a href="#CurveParamFit-744"><span class="linenos">744</span></a>
</span><span id="CurveParamFit-745"><a href="#CurveParamFit-745"><span class="linenos">745</span></a>        <span class="c1"># Perform linear interpolation</span>
</span><span id="CurveParamFit-746"><a href="#CurveParamFit-746"><span class="linenos">746</span></a>        <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit-747"><a href="#CurveParamFit-747"><span class="linenos">747</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span>
</span><span id="CurveParamFit-748"><a href="#CurveParamFit-748"><span class="linenos">748</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="CurveParamFit-749"><a href="#CurveParamFit-749"><span class="linenos">749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit-750"><a href="#CurveParamFit-750"><span class="linenos">750</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span>
</span><span id="CurveParamFit-751"><a href="#CurveParamFit-751"><span class="linenos">751</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveParamFit-752"><a href="#CurveParamFit-752"><span class="linenos">752</span></a>        
</span><span id="CurveParamFit-753"><a href="#CurveParamFit-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit-754"><a href="#CurveParamFit-754"><span class="linenos">754</span></a>            <span class="n">imputname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep_var</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span>
</span><span id="CurveParamFit-755"><a href="#CurveParamFit-755"><span class="linenos">755</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated value of </span><span class="si">{</span><span class="n">imputname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">to_return</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit-756"><a href="#CurveParamFit-756"><span class="linenos">756</span></a>        <span class="k">return</span> <span class="n">to_return</span>
</span><span id="CurveParamFit-757"><a href="#CurveParamFit-757"><span class="linenos">757</span></a>    
</span><span id="CurveParamFit-758"><a href="#CurveParamFit-758"><span class="linenos">758</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit-759"><a href="#CurveParamFit-759"><span class="linenos">759</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-760"><a href="#CurveParamFit-760"><span class="linenos">760</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="CurveParamFit-761"><a href="#CurveParamFit-761"><span class="linenos">761</span></a>
</span><span id="CurveParamFit-762"><a href="#CurveParamFit-762"><span class="linenos">762</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit-763"><a href="#CurveParamFit-763"><span class="linenos">763</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit-764"><a href="#CurveParamFit-764"><span class="linenos">764</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit-765"><a href="#CurveParamFit-765"><span class="linenos">765</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit-766"><a href="#CurveParamFit-766"><span class="linenos">766</span></a>
</span><span id="CurveParamFit-767"><a href="#CurveParamFit-767"><span class="linenos">767</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit-768"><a href="#CurveParamFit-768"><span class="linenos">768</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit-769"><a href="#CurveParamFit-769"><span class="linenos">769</span></a><span class="sd">            None        </span>
</span><span id="CurveParamFit-770"><a href="#CurveParamFit-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-771"><a href="#CurveParamFit-771"><span class="linenos">771</span></a>        
</span><span id="CurveParamFit-772"><a href="#CurveParamFit-772"><span class="linenos">772</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit-773"><a href="#CurveParamFit-773"><span class="linenos">773</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="CurveParamFit-774"><a href="#CurveParamFit-774"><span class="linenos">774</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveParamFit-775"><a href="#CurveParamFit-775"><span class="linenos">775</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit-776"><a href="#CurveParamFit-776"><span class="linenos">776</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="CurveParamFit-777"><a href="#CurveParamFit-777"><span class="linenos">777</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-778"><a href="#CurveParamFit-778"><span class="linenos">778</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="CurveParamFit-779"><a href="#CurveParamFit-779"><span class="linenos">779</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="CurveParamFit-780"><a href="#CurveParamFit-780"><span class="linenos">780</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit-781"><a href="#CurveParamFit-781"><span class="linenos">781</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit-782"><a href="#CurveParamFit-782"><span class="linenos">782</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="CurveParamFit-783"><a href="#CurveParamFit-783"><span class="linenos">783</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="CurveParamFit-784"><a href="#CurveParamFit-784"><span class="linenos">784</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveParamFit-785"><a href="#CurveParamFit-785"><span class="linenos">785</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveParamFit-786"><a href="#CurveParamFit-786"><span class="linenos">786</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit-787"><a href="#CurveParamFit-787"><span class="linenos">787</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="CurveParamFit-788"><a href="#CurveParamFit-788"><span class="linenos">788</span></a>    
</span><span id="CurveParamFit-789"><a href="#CurveParamFit-789"><span class="linenos">789</span></a>    <span class="k">def</span> <span class="nf">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yqub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit-790"><a href="#CurveParamFit-790"><span class="linenos">790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-791"><a href="#CurveParamFit-791"><span class="linenos">791</span></a><span class="sd">        Plots the fitted curve along with the confidence interval.</span>
</span><span id="CurveParamFit-792"><a href="#CurveParamFit-792"><span class="linenos">792</span></a><span class="sd">        </span>
</span><span id="CurveParamFit-793"><a href="#CurveParamFit-793"><span class="linenos">793</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit-794"><a href="#CurveParamFit-794"><span class="linenos">794</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit-795"><a href="#CurveParamFit-795"><span class="linenos">795</span></a><span class="sd">            ypred : pd.Series</span>
</span><span id="CurveParamFit-796"><a href="#CurveParamFit-796"><span class="linenos">796</span></a><span class="sd">                The predicted dependent variable.</span>
</span><span id="CurveParamFit-797"><a href="#CurveParamFit-797"><span class="linenos">797</span></a><span class="sd">            yqlb : pd.Series, optional</span>
</span><span id="CurveParamFit-798"><a href="#CurveParamFit-798"><span class="linenos">798</span></a><span class="sd">                The lower bound of the confidence interval. Default is None.</span>
</span><span id="CurveParamFit-799"><a href="#CurveParamFit-799"><span class="linenos">799</span></a><span class="sd">            yqub : pd.Series, optional</span>
</span><span id="CurveParamFit-800"><a href="#CurveParamFit-800"><span class="linenos">800</span></a><span class="sd">                The upper bound of the confidence interval. Default is None.</span>
</span><span id="CurveParamFit-801"><a href="#CurveParamFit-801"><span class="linenos">801</span></a><span class="sd">            ax : plt.Axes, optional</span>
</span><span id="CurveParamFit-802"><a href="#CurveParamFit-802"><span class="linenos">802</span></a><span class="sd">                The axes to use for plotting. Default is None.</span>
</span><span id="CurveParamFit-803"><a href="#CurveParamFit-803"><span class="linenos">803</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit-804"><a href="#CurveParamFit-804"><span class="linenos">804</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit-805"><a href="#CurveParamFit-805"><span class="linenos">805</span></a><span class="sd">        </span>
</span><span id="CurveParamFit-806"><a href="#CurveParamFit-806"><span class="linenos">806</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit-807"><a href="#CurveParamFit-807"><span class="linenos">807</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit-808"><a href="#CurveParamFit-808"><span class="linenos">808</span></a><span class="sd">            ax : plt.Axes</span>
</span><span id="CurveParamFit-809"><a href="#CurveParamFit-809"><span class="linenos">809</span></a><span class="sd">                The axes used for plotting.        </span>
</span><span id="CurveParamFit-810"><a href="#CurveParamFit-810"><span class="linenos">810</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit-811"><a href="#CurveParamFit-811"><span class="linenos">811</span></a>        <span class="c1"># Plot the data</span>
</span><span id="CurveParamFit-812"><a href="#CurveParamFit-812"><span class="linenos">812</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit-813"><a href="#CurveParamFit-813"><span class="linenos">813</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit-814"><a href="#CurveParamFit-814"><span class="linenos">814</span></a>
</span><span id="CurveParamFit-815"><a href="#CurveParamFit-815"><span class="linenos">815</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-816"><a href="#CurveParamFit-816"><span class="linenos">816</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit-817"><a href="#CurveParamFit-817"><span class="linenos">817</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit-818"><a href="#CurveParamFit-818"><span class="linenos">818</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit-819"><a href="#CurveParamFit-819"><span class="linenos">819</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveParamFit-820"><a href="#CurveParamFit-820"><span class="linenos">820</span></a>
</span><span id="CurveParamFit-821"><a href="#CurveParamFit-821"><span class="linenos">821</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">yqlb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yqub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CurveParamFit-822"><a href="#CurveParamFit-822"><span class="linenos">822</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span>
</span><span id="CurveParamFit-823"><a href="#CurveParamFit-823"><span class="linenos">823</span></a>                            <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">% CI&#39;</span><span class="p">)</span>            
</span><span id="CurveParamFit-824"><a href="#CurveParamFit-824"><span class="linenos">824</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="CurveParamFit-825"><a href="#CurveParamFit-825"><span class="linenos">825</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span><span id="CurveParamFit-826"><a href="#CurveParamFit-826"><span class="linenos">826</span></a>    <span class="c1"># Helper functions</span>
</span><span id="CurveParamFit-827"><a href="#CurveParamFit-827"><span class="linenos">827</span></a>    <span class="k">def</span> <span class="nf">_gX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="CurveParamFit-828"><a href="#CurveParamFit-828"><span class="linenos">828</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the dot product of x and b for the curve calculations.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit-829"><a href="#CurveParamFit-829"><span class="linenos">829</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="CurveParamFit-830"><a href="#CurveParamFit-830"><span class="linenos">830</span></a>        
</span><span id="CurveParamFit-831"><a href="#CurveParamFit-831"><span class="linenos">831</span></a>    <span class="c1"># Various curves follow, call them through curve()</span>
</span><span id="CurveParamFit-832"><a href="#CurveParamFit-832"><span class="linenos">832</span></a>    <span class="k">def</span> <span class="nf">_logistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-833"><a href="#CurveParamFit-833"><span class="linenos">833</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="CurveParamFit-834"><a href="#CurveParamFit-834"><span class="linenos">834</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">kappa</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="CurveParamFit-835"><a href="#CurveParamFit-835"><span class="linenos">835</span></a>
</span><span id="CurveParamFit-836"><a href="#CurveParamFit-836"><span class="linenos">836</span></a>    <span class="k">def</span> <span class="nf">_redLogistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-837"><a href="#CurveParamFit-837"><span class="linenos">837</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="CurveParamFit-838"><a href="#CurveParamFit-838"><span class="linenos">838</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>        
</span><span id="CurveParamFit-839"><a href="#CurveParamFit-839"><span class="linenos">839</span></a>
</span><span id="CurveParamFit-840"><a href="#CurveParamFit-840"><span class="linenos">840</span></a>    <span class="k">def</span> <span class="nf">_fixLogistic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-841"><a href="#CurveParamFit-841"><span class="linenos">841</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit-842"><a href="#CurveParamFit-842"><span class="linenos">842</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="CurveParamFit-843"><a href="#CurveParamFit-843"><span class="linenos">843</span></a>
</span><span id="CurveParamFit-844"><a href="#CurveParamFit-844"><span class="linenos">844</span></a>    <span class="k">def</span> <span class="nf">_doubleExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-845"><a href="#CurveParamFit-845"><span class="linenos">845</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="CurveParamFit-846"><a href="#CurveParamFit-846"><span class="linenos">846</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="CurveParamFit-847"><a href="#CurveParamFit-847"><span class="linenos">847</span></a>
</span><span id="CurveParamFit-848"><a href="#CurveParamFit-848"><span class="linenos">848</span></a>    <span class="k">def</span> <span class="nf">_exponential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-849"><a href="#CurveParamFit-849"><span class="linenos">849</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="CurveParamFit-850"><a href="#CurveParamFit-850"><span class="linenos">850</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="CurveParamFit-851"><a href="#CurveParamFit-851"><span class="linenos">851</span></a>
</span><span id="CurveParamFit-852"><a href="#CurveParamFit-852"><span class="linenos">852</span></a>    <span class="k">def</span> <span class="nf">_fixExponential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-853"><a href="#CurveParamFit-853"><span class="linenos">853</span></a>        <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit-854"><a href="#CurveParamFit-854"><span class="linenos">854</span></a>        <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="CurveParamFit-855"><a href="#CurveParamFit-855"><span class="linenos">855</span></a>
</span><span id="CurveParamFit-856"><a href="#CurveParamFit-856"><span class="linenos">856</span></a>    <span class="k">def</span> <span class="nf">_arctan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-857"><a href="#CurveParamFit-857"><span class="linenos">857</span></a>        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">w</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="CurveParamFit-858"><a href="#CurveParamFit-858"><span class="linenos">858</span></a>        <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="CurveParamFit-859"><a href="#CurveParamFit-859"><span class="linenos">859</span></a>
</span><span id="CurveParamFit-860"><a href="#CurveParamFit-860"><span class="linenos">860</span></a>    <span class="k">def</span> <span class="nf">_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="CurveParamFit-861"><a href="#CurveParamFit-861"><span class="linenos">861</span></a>        <span class="k">return</span> <span class="n">g</span>
</span></pre></div>


            <div class="docstring"><p>Class to fit a curve to a dataset using a variety of curve types.
The class uses a cross-validated approach to select the best curve type and the best set of variables.</p>

<h6 id="the-class-supports-the-following-curve-types">The class supports the following curve types:</h6>

<blockquote>
  <ul>
  <li>Logistic</li>
  <li>Reduced Logistic</li>
  <li>Fixed Logistic</li>
  <li>Double Exponential</li>
  <li>Exponential</li>
  <li>Fixed Exponential</li>
  <li>Arctan</li>
  <li>Linear</li>
  </ul>
</blockquote>

<h2 id="parameters">Parameters</h2>

<pre><code>data : pd.DataFrame
    The dataset containing the dependent and independent variables.
dep_var : str
    The name of the dependent variable.
main_indep_var : str
    The name of the main independent variable.
dep_var_name : str, optional
    The name of the dependent variable for plotting. Default is None.
main_indep_var_name : str, optional
    The name of the main independent variable for plotting. Default is None.
constant : bool, optional
    Whether to include a constant column in the independent variables. Default is True.
curves : list, optional
    The list of curve types to consider. Default is None.
Q : float, optional
    The confidence level for the confidence interval. Default is 0.9.
nFolds : int, optional
    The number of folds for cross-validation. Default is 5.
parallel : bool, optional
    Whether to run cross-validation in parallel. Default is False.
search_method : str, optional
    The method to use for variable selection. Default is 'backward'. Available options are 
    - backward: Backward elimination removing variables that are not improving the prediction accuracy
    - forward: Forward selection, adding variables only if they increase predictive power
    - all_combinations: Exhaustive search testing all variable combinations and selecting the best
</code></pre>

<h2 id="methods">Methods:</h2>

<pre><code>cross_validate(curvename, on='RMSE')
    Performs cross-validation to find the best combination of variables for the specified curve type.
variable_select(on='RMSE', verbose=True, plot=True)
    Performs variable selection for each curve type and returns the best curve based on the specified metric.
indep_vars_occurence(normalize=True, plot=True, title='')
    Gives the number of occurrences of each independent variable in the best combinations of variables for each curve.
fit_best_curves()
    Fits the best curve for each curve type based on the selected variables.
compare_best_curves(plot=True, CI = True)
    Compares the best curves for each curve type based on the performance metrics.
predict_best_curve(curvename, X=None)
    Predicts the dependent variable using the best curve for the specified curve type.
most_probable_value(curvename, known_value, verbose=True)
    Estimates the most probable value of a dependent or independent variable using a fitted curve.
plot_x_y(title ='')
    Plots the dependent variable y against all the independent variables x.
plot_curve_with_confidence_interval(ypred, yqlb=None, yqub=None, ax = None, title ='')
    Plots the fitted curve along with the confidence interval.
</code></pre>

<h2 id="attributes">Attributes:</h2>

<pre><code>varselect_result : pd.DataFrame
    The performance metrics for each curve type.
best_curves_params : dict
    The parameters for each curve type.
</code></pre>

<h2 id="example">Example:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn"><a href="">reserves_demand.curve_param_fit</a></span> <span class="kn">import</span> <span class="n">CurveParamFit</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/reserve_demand_cruve_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Initialize the CurveParamFit object</span>
<span class="n">curve_fit</span> <span class="o">=</span> <span class="n">CurveParamFit</span><span class="p">(</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="p">,</span> 
            <span class="n">dep_var</span> <span class="o">=</span> <span class="s1">&#39;Normalized&#39;</span><span class="p">,</span>
            <span class="n">main_indep_var</span><span class="o">=</span> <span class="s1">&#39;excess_reserve&#39;</span><span class="p">,</span>
            <span class="n">dep_var_name</span><span class="o">=</span> <span class="s1">&#39;Normalized Overnight Rate&#39;</span><span class="p">,</span>                 
            <span class="n">main_indep_var_name</span><span class="o">=</span> <span class="s1">&#39;Excess Reserve&#39;</span><span class="p">,</span>
        <span class="p">)</span>

<span class="c1"># Perform variable selection for each curve</span>
<span class="n">best_curve</span><span class="p">,</span> <span class="n">varselect_result</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Fit the best curves</span>
<span class="n">best_curves_params</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>

<span class="c1"># Compare the best curves</span>
<span class="n">perf_metrics_df</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">,</span> <span class="n">param_df</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="o">.</span><span class="n">compare_best_curves</span><span class="p">()</span>

<span class="c1"># Predict the dependent variable using the best curve</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">best_curve</span><span class="p">)</span>

<span class="c1"># Estimate the most probable value of a variable</span>
<span class="n">known_value</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Normalized&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">most_probable_value</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="o">.</span><span class="n">most_probable_value</span><span class="p">(</span><span class="n">best_curve</span><span class="p">,</span> <span class="n">known_value</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="CurveParamFit.__init__" class="classattr">
                                        <input id="CurveParamFit.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CurveParamFit</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">main_indep_var</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">curves</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">nFolds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">search_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span></span>)</span>

                <label class="view-source-button" for="CurveParamFit.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.__init__-130"><a href="#CurveParamFit.__init__-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="CurveParamFit.__init__-131"><a href="#CurveParamFit.__init__-131"><span class="linenos">131</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="CurveParamFit.__init__-132"><a href="#CurveParamFit.__init__-132"><span class="linenos">132</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-133"><a href="#CurveParamFit.__init__-133"><span class="linenos">133</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-134"><a href="#CurveParamFit.__init__-134"><span class="linenos">134</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="CurveParamFit.__init__-135"><a href="#CurveParamFit.__init__-135"><span class="linenos">135</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-136"><a href="#CurveParamFit.__init__-136"><span class="linenos">136</span></a>                 <span class="n">constant</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-137"><a href="#CurveParamFit.__init__-137"><span class="linenos">137</span></a>                 <span class="n">curves</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-138"><a href="#CurveParamFit.__init__-138"><span class="linenos">138</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-139"><a href="#CurveParamFit.__init__-139"><span class="linenos">139</span></a>                 <span class="n">nFolds</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-140"><a href="#CurveParamFit.__init__-140"><span class="linenos">140</span></a>                 <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-141"><a href="#CurveParamFit.__init__-141"><span class="linenos">141</span></a>                 <span class="n">search_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;backward&#39;</span>
</span><span id="CurveParamFit.__init__-142"><a href="#CurveParamFit.__init__-142"><span class="linenos">142</span></a>                 <span class="p">):</span>
</span><span id="CurveParamFit.__init__-143"><a href="#CurveParamFit.__init__-143"><span class="linenos">143</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="CurveParamFit.__init__-144"><a href="#CurveParamFit.__init__-144"><span class="linenos">144</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveParamFit.__init__-145"><a href="#CurveParamFit.__init__-145"><span class="linenos">145</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveParamFit.__init__-146"><a href="#CurveParamFit.__init__-146"><span class="linenos">146</span></a>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Q should be between 0 and 1 for valid confidence intervals&quot;</span>
</span><span id="CurveParamFit.__init__-147"><a href="#CurveParamFit.__init__-147"><span class="linenos">147</span></a>        <span class="k">assert</span> <span class="n">nFolds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;nFolds must be greater than 1 for cross-validation&quot;</span>
</span><span id="CurveParamFit.__init__-148"><a href="#CurveParamFit.__init__-148"><span class="linenos">148</span></a>        <span class="k">assert</span> <span class="n">search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">],</span> <span class="s2">&quot;search_method must be &#39;backward&#39;, &#39;forward&#39;, or &#39;all_combinations&#39;&quot;</span>
</span><span id="CurveParamFit.__init__-149"><a href="#CurveParamFit.__init__-149"><span class="linenos">149</span></a>
</span><span id="CurveParamFit.__init__-150"><a href="#CurveParamFit.__init__-150"><span class="linenos">150</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="CurveParamFit.__init__-151"><a href="#CurveParamFit.__init__-151"><span class="linenos">151</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="CurveParamFit.__init__-152"><a href="#CurveParamFit.__init__-152"><span class="linenos">152</span></a>        
</span><span id="CurveParamFit.__init__-153"><a href="#CurveParamFit.__init__-153"><span class="linenos">153</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="CurveParamFit.__init__-154"><a href="#CurveParamFit.__init__-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.__init__-155"><a href="#CurveParamFit.__init__-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="CurveParamFit.__init__-156"><a href="#CurveParamFit.__init__-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="CurveParamFit.__init__-157"><a href="#CurveParamFit.__init__-157"><span class="linenos">157</span></a>        
</span><span id="CurveParamFit.__init__-158"><a href="#CurveParamFit.__init__-158"><span class="linenos">158</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="CurveParamFit.__init__-159"><a href="#CurveParamFit.__init__-159"><span class="linenos">159</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="CurveParamFit.__init__-160"><a href="#CurveParamFit.__init__-160"><span class="linenos">160</span></a>        
</span><span id="CurveParamFit.__init__-161"><a href="#CurveParamFit.__init__-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="CurveParamFit.__init__-162"><a href="#CurveParamFit.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="CurveParamFit.__init__-163"><a href="#CurveParamFit.__init__-163"><span class="linenos">163</span></a>        
</span><span id="CurveParamFit.__init__-164"><a href="#CurveParamFit.__init__-164"><span class="linenos">164</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="CurveParamFit.__init__-165"><a href="#CurveParamFit.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CurveParamFit.__init__-166"><a href="#CurveParamFit.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CurveParamFit.__init__-167"><a href="#CurveParamFit.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveParamFit.__init__-168"><a href="#CurveParamFit.__init__-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveParamFit.__init__-169"><a href="#CurveParamFit.__init__-169"><span class="linenos">169</span></a>        
</span><span id="CurveParamFit.__init__-170"><a href="#CurveParamFit.__init__-170"><span class="linenos">170</span></a>        <span class="c1"># add constant column if requested</span>
</span><span id="CurveParamFit.__init__-171"><a href="#CurveParamFit.__init__-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
</span><span id="CurveParamFit.__init__-172"><a href="#CurveParamFit.__init__-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CurveParamFit.__init__-173"><a href="#CurveParamFit.__init__-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.__init__-174"><a href="#CurveParamFit.__init__-174"><span class="linenos">174</span></a>        
</span><span id="CurveParamFit.__init__-175"><a href="#CurveParamFit.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span> <span class="o">=</span> <span class="n">Q</span>
</span><span id="CurveParamFit.__init__-176"><a href="#CurveParamFit.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="CurveParamFit.__init__-177"><a href="#CurveParamFit.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="CurveParamFit.__init__-178"><a href="#CurveParamFit.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span> <span class="o">=</span> <span class="n">parallel</span>
</span><span id="CurveParamFit.__init__-179"><a href="#CurveParamFit.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">=</span> <span class="n">search_method</span>
</span><span id="CurveParamFit.__init__-180"><a href="#CurveParamFit.__init__-180"><span class="linenos">180</span></a>        
</span><span id="CurveParamFit.__init__-181"><a href="#CurveParamFit.__init__-181"><span class="linenos">181</span></a>        <span class="n">curves</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit.__init__-182"><a href="#CurveParamFit.__init__-182"><span class="linenos">182</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logistic</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-183"><a href="#CurveParamFit.__init__-183"><span class="linenos">183</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redLogistic</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-184"><a href="#CurveParamFit.__init__-184"><span class="linenos">184</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixLogistic</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-185"><a href="#CurveParamFit.__init__-185"><span class="linenos">185</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doubleExp</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-186"><a href="#CurveParamFit.__init__-186"><span class="linenos">186</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exponential</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-187"><a href="#CurveParamFit.__init__-187"><span class="linenos">187</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixExponential</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-188"><a href="#CurveParamFit.__init__-188"><span class="linenos">188</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arctan</span><span class="p">,</span>
</span><span id="CurveParamFit.__init__-189"><a href="#CurveParamFit.__init__-189"><span class="linenos">189</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear</span>
</span><span id="CurveParamFit.__init__-190"><a href="#CurveParamFit.__init__-190"><span class="linenos">190</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit.__init__-191"><a href="#CurveParamFit.__init__-191"><span class="linenos">191</span></a>        <span class="n">param_names</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit.__init__-192"><a href="#CurveParamFit.__init__-192"><span class="linenos">192</span></a>            <span class="c1"># Names of parameters for each curve type</span>
</span><span id="CurveParamFit.__init__-193"><a href="#CurveParamFit.__init__-193"><span class="linenos">193</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-194"><a href="#CurveParamFit.__init__-194"><span class="linenos">194</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-195"><a href="#CurveParamFit.__init__-195"><span class="linenos">195</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-196"><a href="#CurveParamFit.__init__-196"><span class="linenos">196</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-197"><a href="#CurveParamFit.__init__-197"><span class="linenos">197</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-198"><a href="#CurveParamFit.__init__-198"><span class="linenos">198</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-199"><a href="#CurveParamFit.__init__-199"><span class="linenos">199</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">],</span>
</span><span id="CurveParamFit.__init__-200"><a href="#CurveParamFit.__init__-200"><span class="linenos">200</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="CurveParamFit.__init__-201"><a href="#CurveParamFit.__init__-201"><span class="linenos">201</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit.__init__-202"><a href="#CurveParamFit.__init__-202"><span class="linenos">202</span></a>        <span class="n">init_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit.__init__-203"><a href="#CurveParamFit.__init__-203"><span class="linenos">203</span></a>            <span class="c1"># Initial parameters for each curve type</span>
</span><span id="CurveParamFit.__init__-204"><a href="#CurveParamFit.__init__-204"><span class="linenos">204</span></a>            <span class="s2">&quot;logistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
</span><span id="CurveParamFit.__init__-205"><a href="#CurveParamFit.__init__-205"><span class="linenos">205</span></a>            <span class="s2">&quot;redLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
</span><span id="CurveParamFit.__init__-206"><a href="#CurveParamFit.__init__-206"><span class="linenos">206</span></a>            <span class="s2">&quot;fixLogistic&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit.__init__-207"><a href="#CurveParamFit.__init__-207"><span class="linenos">207</span></a>            <span class="s2">&quot;doubleExp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="CurveParamFit.__init__-208"><a href="#CurveParamFit.__init__-208"><span class="linenos">208</span></a>            <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit.__init__-209"><a href="#CurveParamFit.__init__-209"><span class="linenos">209</span></a>            <span class="s2">&quot;fixExponential&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">]),</span>
</span><span id="CurveParamFit.__init__-210"><a href="#CurveParamFit.__init__-210"><span class="linenos">210</span></a>            <span class="s2">&quot;arctan&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">]),</span> 
</span><span id="CurveParamFit.__init__-211"><a href="#CurveParamFit.__init__-211"><span class="linenos">211</span></a>            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="CurveParamFit.__init__-212"><a href="#CurveParamFit.__init__-212"><span class="linenos">212</span></a>        <span class="p">}</span>
</span><span id="CurveParamFit.__init__-213"><a href="#CurveParamFit.__init__-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="n">curves</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit.__init__-214"><a href="#CurveParamFit.__init__-214"><span class="linenos">214</span></a>            <span class="n">curves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CurveParamFit.__init__-215"><a href="#CurveParamFit.__init__-215"><span class="linenos">215</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.__init__-216"><a href="#CurveParamFit.__init__-216"><span class="linenos">216</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Invalid curve type. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CurveParamFit.__init__-217"><a href="#CurveParamFit.__init__-217"><span class="linenos">217</span></a>        
</span><span id="CurveParamFit.__init__-218"><a href="#CurveParamFit.__init__-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">curves</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit.__init__-219"><a href="#CurveParamFit.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">param_names</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit.__init__-220"><a href="#CurveParamFit.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">_c</span><span class="p">:</span> <span class="n">init_params</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">}</span>
</span><span id="CurveParamFit.__init__-221"><a href="#CurveParamFit.__init__-221"><span class="linenos">221</span></a>
</span><span id="CurveParamFit.__init__-222"><a href="#CurveParamFit.__init__-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="CurveParamFit.__init__-223"><a href="#CurveParamFit.__init__-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveParamFit.__init__-224"><a href="#CurveParamFit.__init__-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="CurveParamFit.varselect_result" class="classattr">
                                <div class="attr variable">
            <span class="name">varselect_result</span>

        
    </div>
    <a class="headerlink" href="#CurveParamFit.varselect_result"></a>
    
    

                            </div>
                            <div id="CurveParamFit.best_curves_params" class="classattr">
                                <div class="attr variable">
            <span class="name">best_curves_params</span>

        
    </div>
    <a class="headerlink" href="#CurveParamFit.best_curves_params"></a>
    
    

                            </div>
                            <div id="CurveParamFit.cross_validate" class="classattr">
                                        <input id="CurveParamFit.cross_validate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cross_validate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">curvename</span>, </span><span class="param"><span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.cross_validate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.cross_validate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.cross_validate-343"><a href="#CurveParamFit.cross_validate-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit.cross_validate-344"><a href="#CurveParamFit.cross_validate-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.cross_validate-345"><a href="#CurveParamFit.cross_validate-345"><span class="linenos">345</span></a><span class="sd">        Performs cross-validation to find the best combination of variables for the specified curve type.</span>
</span><span id="CurveParamFit.cross_validate-346"><a href="#CurveParamFit.cross_validate-346"><span class="linenos">346</span></a><span class="sd">        </span>
</span><span id="CurveParamFit.cross_validate-347"><a href="#CurveParamFit.cross_validate-347"><span class="linenos">347</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit.cross_validate-348"><a href="#CurveParamFit.cross_validate-348"><span class="linenos">348</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit.cross_validate-349"><a href="#CurveParamFit.cross_validate-349"><span class="linenos">349</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit.cross_validate-350"><a href="#CurveParamFit.cross_validate-350"><span class="linenos">350</span></a><span class="sd">                The name of the curve used for fitting the data. This curve should be one of the supported curves.</span>
</span><span id="CurveParamFit.cross_validate-351"><a href="#CurveParamFit.cross_validate-351"><span class="linenos">351</span></a><span class="sd">            on : str, optional</span>
</span><span id="CurveParamFit.cross_validate-352"><a href="#CurveParamFit.cross_validate-352"><span class="linenos">352</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="CurveParamFit.cross_validate-353"><a href="#CurveParamFit.cross_validate-353"><span class="linenos">353</span></a>
</span><span id="CurveParamFit.cross_validate-354"><a href="#CurveParamFit.cross_validate-354"><span class="linenos">354</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit.cross_validate-355"><a href="#CurveParamFit.cross_validate-355"><span class="linenos">355</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit.cross_validate-356"><a href="#CurveParamFit.cross_validate-356"><span class="linenos">356</span></a><span class="sd">            best_combination : list</span>
</span><span id="CurveParamFit.cross_validate-357"><a href="#CurveParamFit.cross_validate-357"><span class="linenos">357</span></a><span class="sd">                The best combination of independent variables for the specified curve type.</span>
</span><span id="CurveParamFit.cross_validate-358"><a href="#CurveParamFit.cross_validate-358"><span class="linenos">358</span></a><span class="sd">            best_train_metrics : dict</span>
</span><span id="CurveParamFit.cross_validate-359"><a href="#CurveParamFit.cross_validate-359"><span class="linenos">359</span></a><span class="sd">                The performance metrics on the training set for the best combination.</span>
</span><span id="CurveParamFit.cross_validate-360"><a href="#CurveParamFit.cross_validate-360"><span class="linenos">360</span></a><span class="sd">            best_validation_metrics : dict</span>
</span><span id="CurveParamFit.cross_validate-361"><a href="#CurveParamFit.cross_validate-361"><span class="linenos">361</span></a><span class="sd">                The performance metrics on the validation set for the best combination.</span>
</span><span id="CurveParamFit.cross_validate-362"><a href="#CurveParamFit.cross_validate-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.cross_validate-363"><a href="#CurveParamFit.cross_validate-363"><span class="linenos">363</span></a>        <span class="n">perf_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;MSLE&#39;</span><span class="p">,</span> <span class="s1">&#39;MedianAE&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit.cross_validate-364"><a href="#CurveParamFit.cross_validate-364"><span class="linenos">364</span></a>        <span class="k">assert</span> <span class="n">on</span> <span class="ow">in</span> <span class="n">perf_stats</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Performance comparison is made on one of the following metrics </span><span class="si">{</span><span class="n">perf_stats</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="CurveParamFit.cross_validate-365"><a href="#CurveParamFit.cross_validate-365"><span class="linenos">365</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span><span id="CurveParamFit.cross_validate-366"><a href="#CurveParamFit.cross_validate-366"><span class="linenos">366</span></a>    
</span><span id="CurveParamFit.cross_validate-367"><a href="#CurveParamFit.cross_validate-367"><span class="linenos">367</span></a>        <span class="c1"># Generate combinations based on the specified search method</span>
</span><span id="CurveParamFit.cross_validate-368"><a href="#CurveParamFit.cross_validate-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">]:</span>
</span><span id="CurveParamFit.cross_validate-369"><a href="#CurveParamFit.cross_validate-369"><span class="linenos">369</span></a>            <span class="n">best_combination</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="CurveParamFit.cross_validate-370"><a href="#CurveParamFit.cross_validate-370"><span class="linenos">370</span></a>            
</span><span id="CurveParamFit.cross_validate-371"><a href="#CurveParamFit.cross_validate-371"><span class="linenos">371</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-372"><a href="#CurveParamFit.cross_validate-372"><span class="linenos">372</span></a>                <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cv</span><span class="p">(</span><span class="n">best_combination</span><span class="p">,</span> <span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit.cross_validate-373"><a href="#CurveParamFit.cross_validate-373"><span class="linenos">373</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="CurveParamFit.cross_validate-374"><a href="#CurveParamFit.cross_validate-374"><span class="linenos">374</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-375"><a href="#CurveParamFit.cross_validate-375"><span class="linenos">375</span></a>                <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># Initialize for minimization</span>
</span><span id="CurveParamFit.cross_validate-376"><a href="#CurveParamFit.cross_validate-376"><span class="linenos">376</span></a>                <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="CurveParamFit.cross_validate-377"><a href="#CurveParamFit.cross_validate-377"><span class="linenos">377</span></a>            
</span><span id="CurveParamFit.cross_validate-378"><a href="#CurveParamFit.cross_validate-378"><span class="linenos">378</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-379"><a href="#CurveParamFit.cross_validate-379"><span class="linenos">379</span></a>                <span class="c1"># Generate candidate combinations for the next iteration</span>
</span><span id="CurveParamFit.cross_validate-380"><a href="#CurveParamFit.cross_validate-380"><span class="linenos">380</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-381"><a href="#CurveParamFit.cross_validate-381"><span class="linenos">381</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">best_combination</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_combination</span><span class="p">))]</span> 
</span><span id="CurveParamFit.cross_validate-382"><a href="#CurveParamFit.cross_validate-382"><span class="linenos">382</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-383"><a href="#CurveParamFit.cross_validate-383"><span class="linenos">383</span></a>                    <span class="n">candidate_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_combination</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="CurveParamFit.cross_validate-384"><a href="#CurveParamFit.cross_validate-384"><span class="linenos">384</span></a>                
</span><span id="CurveParamFit.cross_validate-385"><a href="#CurveParamFit.cross_validate-385"><span class="linenos">385</span></a>                <span class="c1"># If no candidate combinations are available, break from the loop</span>
</span><span id="CurveParamFit.cross_validate-386"><a href="#CurveParamFit.cross_validate-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">candidate_columns</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-387"><a href="#CurveParamFit.cross_validate-387"><span class="linenos">387</span></a>                    <span class="k">break</span>
</span><span id="CurveParamFit.cross_validate-388"><a href="#CurveParamFit.cross_validate-388"><span class="linenos">388</span></a>                
</span><span id="CurveParamFit.cross_validate-389"><a href="#CurveParamFit.cross_validate-389"><span class="linenos">389</span></a>                <span class="c1"># Find the best combination from the candidates</span>
</span><span id="CurveParamFit.cross_validate-390"><a href="#CurveParamFit.cross_validate-390"><span class="linenos">390</span></a>                <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">candidate_columns</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit.cross_validate-391"><a href="#CurveParamFit.cross_validate-391"><span class="linenos">391</span></a>                <span class="k">if</span> <span class="n">candidates_best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">best_validation_metric_value</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-392"><a href="#CurveParamFit.cross_validate-392"><span class="linenos">392</span></a>                    <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="n">candidates_best_combination</span><span class="p">,</span> <span class="n">candidates_best_train_metrics</span><span class="p">,</span> <span class="n">candidates_best_validation_metrics</span>
</span><span id="CurveParamFit.cross_validate-393"><a href="#CurveParamFit.cross_validate-393"><span class="linenos">393</span></a>                    <span class="n">best_validation_metric_value</span> <span class="o">=</span> <span class="n">best_validation_metrics</span><span class="p">[</span><span class="n">on</span><span class="p">]</span>
</span><span id="CurveParamFit.cross_validate-394"><a href="#CurveParamFit.cross_validate-394"><span class="linenos">394</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-395"><a href="#CurveParamFit.cross_validate-395"><span class="linenos">395</span></a>                    <span class="k">break</span>
</span><span id="CurveParamFit.cross_validate-396"><a href="#CurveParamFit.cross_validate-396"><span class="linenos">396</span></a>                
</span><span id="CurveParamFit.cross_validate-397"><a href="#CurveParamFit.cross_validate-397"><span class="linenos">397</span></a>                <span class="c1"># In forward search, remove selected columns from the list of remaining columns</span>
</span><span id="CurveParamFit.cross_validate-398"><a href="#CurveParamFit.cross_validate-398"><span class="linenos">398</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">and</span> <span class="n">best_combination</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-399"><a href="#CurveParamFit.cross_validate-399"><span class="linenos">399</span></a>                    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_combination</span><span class="p">]</span>
</span><span id="CurveParamFit.cross_validate-400"><a href="#CurveParamFit.cross_validate-400"><span class="linenos">400</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-401"><a href="#CurveParamFit.cross_validate-401"><span class="linenos">401</span></a>                        <span class="k">break</span>
</span><span id="CurveParamFit.cross_validate-402"><a href="#CurveParamFit.cross_validate-402"><span class="linenos">402</span></a>
</span><span id="CurveParamFit.cross_validate-403"><a href="#CurveParamFit.cross_validate-403"><span class="linenos">403</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_method</span> <span class="o">==</span> <span class="s1">&#39;all_combinations&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit.cross_validate-404"><a href="#CurveParamFit.cross_validate-404"><span class="linenos">404</span></a>            <span class="c1"># Evaluate all possible combinations of columns</span>
</span><span id="CurveParamFit.cross_validate-405"><a href="#CurveParamFit.cross_validate-405"><span class="linenos">405</span></a>            <span class="n">all_combinations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>
</span><span id="CurveParamFit.cross_validate-406"><a href="#CurveParamFit.cross_validate-406"><span class="linenos">406</span></a>            <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_combination</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit.cross_validate-407"><a href="#CurveParamFit.cross_validate-407"><span class="linenos">407</span></a>
</span><span id="CurveParamFit.cross_validate-408"><a href="#CurveParamFit.cross_validate-408"><span class="linenos">408</span></a>        <span class="c1"># Return the best combination of features and the corresponding training and validation metrics</span>
</span><span id="CurveParamFit.cross_validate-409"><a href="#CurveParamFit.cross_validate-409"><span class="linenos">409</span></a>        <span class="k">return</span> <span class="n">best_combination</span><span class="p">,</span> <span class="n">best_train_metrics</span><span class="p">,</span> <span class="n">best_validation_metrics</span>
</span></pre></div>


            <div class="docstring"><p>Performs cross-validation to find the best combination of variables for the specified curve type.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>curvename : str
    The name of the curve used for fitting the data. This curve should be one of the supported curves.
on : str, optional
    The performance metric to use for comparison. Default is 'RMSE'.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>best_combination : list
    The best combination of independent variables for the specified curve type.
best_train_metrics : dict
    The performance metrics on the training set for the best combination.
best_validation_metrics : dict
    The performance metrics on the validation set for the best combination.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.variable_select" class="classattr">
                                        <input id="CurveParamFit.variable_select-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variable_select</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">plot</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.variable_select-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.variable_select"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.variable_select-411"><a href="#CurveParamFit.variable_select-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">variable_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit.variable_select-412"><a href="#CurveParamFit.variable_select-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.variable_select-413"><a href="#CurveParamFit.variable_select-413"><span class="linenos">413</span></a><span class="sd">        Performs variable selection for each curve type and returns the best curve based on the specified metric.</span>
</span><span id="CurveParamFit.variable_select-414"><a href="#CurveParamFit.variable_select-414"><span class="linenos">414</span></a><span class="sd">        The function also returns the performance metrics for each curve type.</span>
</span><span id="CurveParamFit.variable_select-415"><a href="#CurveParamFit.variable_select-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="CurveParamFit.variable_select-416"><a href="#CurveParamFit.variable_select-416"><span class="linenos">416</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit.variable_select-417"><a href="#CurveParamFit.variable_select-417"><span class="linenos">417</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit.variable_select-418"><a href="#CurveParamFit.variable_select-418"><span class="linenos">418</span></a><span class="sd">            on : str, optional</span>
</span><span id="CurveParamFit.variable_select-419"><a href="#CurveParamFit.variable_select-419"><span class="linenos">419</span></a><span class="sd">                The performance metric to use for comparison. Default is &#39;RMSE&#39;.</span>
</span><span id="CurveParamFit.variable_select-420"><a href="#CurveParamFit.variable_select-420"><span class="linenos">420</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="CurveParamFit.variable_select-421"><a href="#CurveParamFit.variable_select-421"><span class="linenos">421</span></a><span class="sd">                Whether to print the results. Default is True.</span>
</span><span id="CurveParamFit.variable_select-422"><a href="#CurveParamFit.variable_select-422"><span class="linenos">422</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit.variable_select-423"><a href="#CurveParamFit.variable_select-423"><span class="linenos">423</span></a><span class="sd">                Whether to plot the performance comparison. Default is True.</span>
</span><span id="CurveParamFit.variable_select-424"><a href="#CurveParamFit.variable_select-424"><span class="linenos">424</span></a>
</span><span id="CurveParamFit.variable_select-425"><a href="#CurveParamFit.variable_select-425"><span class="linenos">425</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit.variable_select-426"><a href="#CurveParamFit.variable_select-426"><span class="linenos">426</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit.variable_select-427"><a href="#CurveParamFit.variable_select-427"><span class="linenos">427</span></a><span class="sd">            best_curve : str</span>
</span><span id="CurveParamFit.variable_select-428"><a href="#CurveParamFit.variable_select-428"><span class="linenos">428</span></a><span class="sd">                The best curve based on the specified metric.</span>
</span><span id="CurveParamFit.variable_select-429"><a href="#CurveParamFit.variable_select-429"><span class="linenos">429</span></a><span class="sd">            varselect_result : pd.DataFrame</span>
</span><span id="CurveParamFit.variable_select-430"><a href="#CurveParamFit.variable_select-430"><span class="linenos">430</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="CurveParamFit.variable_select-431"><a href="#CurveParamFit.variable_select-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.variable_select-432"><a href="#CurveParamFit.variable_select-432"><span class="linenos">432</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveParamFit.variable_select-433"><a href="#CurveParamFit.variable_select-433"><span class="linenos">433</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CurveParamFit.variable_select-434"><a href="#CurveParamFit.variable_select-434"><span class="linenos">434</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.variable_select-435"><a href="#CurveParamFit.variable_select-435"><span class="linenos">435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-436"><a href="#CurveParamFit.variable_select-436"><span class="linenos">436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2"> curve&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-437"><a href="#CurveParamFit.variable_select-437"><span class="linenos">437</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-438"><a href="#CurveParamFit.variable_select-438"><span class="linenos">438</span></a>            <span class="c1"># Perform cross-validation and gather metrics</span>
</span><span id="CurveParamFit.variable_select-439"><a href="#CurveParamFit.variable_select-439"><span class="linenos">439</span></a>            <span class="n">combination</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-440"><a href="#CurveParamFit.variable_select-440"><span class="linenos">440</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveParamFit.variable_select-441"><a href="#CurveParamFit.variable_select-441"><span class="linenos">441</span></a>                <span class="s1">&#39;Curve&#39;</span><span class="p">:</span> <span class="n">curvename</span><span class="p">,</span>
</span><span id="CurveParamFit.variable_select-442"><a href="#CurveParamFit.variable_select-442"><span class="linenos">442</span></a>                <span class="s1">&#39;Best Combination&#39;</span><span class="p">:</span> <span class="n">combination</span><span class="p">,</span>
</span><span id="CurveParamFit.variable_select-443"><a href="#CurveParamFit.variable_select-443"><span class="linenos">443</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="CurveParamFit.variable_select-444"><a href="#CurveParamFit.variable_select-444"><span class="linenos">444</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CurveParamFit.variable_select-445"><a href="#CurveParamFit.variable_select-445"><span class="linenos">445</span></a>            <span class="p">}</span>
</span><span id="CurveParamFit.variable_select-446"><a href="#CurveParamFit.variable_select-446"><span class="linenos">446</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-447"><a href="#CurveParamFit.variable_select-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.variable_select-448"><a href="#CurveParamFit.variable_select-448"><span class="linenos">448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best combination for </span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">combination</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-449"><a href="#CurveParamFit.variable_select-449"><span class="linenos">449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-450"><a href="#CurveParamFit.variable_select-450"><span class="linenos">450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-451"><a href="#CurveParamFit.variable_select-451"><span class="linenos">451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-452"><a href="#CurveParamFit.variable_select-452"><span class="linenos">452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-453"><a href="#CurveParamFit.variable_select-453"><span class="linenos">453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-454"><a href="#CurveParamFit.variable_select-454"><span class="linenos">454</span></a>        <span class="n">cv_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># Store for later use</span>
</span><span id="CurveParamFit.variable_select-455"><a href="#CurveParamFit.variable_select-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span> <span class="o">=</span> <span class="n">cv_result</span>
</span><span id="CurveParamFit.variable_select-456"><a href="#CurveParamFit.variable_select-456"><span class="linenos">456</span></a>
</span><span id="CurveParamFit.variable_select-457"><a href="#CurveParamFit.variable_select-457"><span class="linenos">457</span></a>        <span class="c1"># Optionally identify the best curve based on a specific validation metric, e.g., RMSE</span>
</span><span id="CurveParamFit.variable_select-458"><a href="#CurveParamFit.variable_select-458"><span class="linenos">458</span></a>        <span class="n">best_curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit.variable_select-459"><a href="#CurveParamFit.variable_select-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.variable_select-460"><a href="#CurveParamFit.variable_select-460"><span class="linenos">460</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-461"><a href="#CurveParamFit.variable_select-461"><span class="linenos">461</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best curve based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_curve</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m curve&quot;</span><span class="p">)</span>            
</span><span id="CurveParamFit.variable_select-462"><a href="#CurveParamFit.variable_select-462"><span class="linenos">462</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-463"><a href="#CurveParamFit.variable_select-463"><span class="linenos">463</span></a>
</span><span id="CurveParamFit.variable_select-464"><a href="#CurveParamFit.variable_select-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit.variable_select-465"><a href="#CurveParamFit.variable_select-465"><span class="linenos">465</span></a>            <span class="n">_oncomp</span> <span class="o">=</span> <span class="n">cv_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Curve&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-466"><a href="#CurveParamFit.variable_select-466"><span class="linenos">466</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit.variable_select-467"><a href="#CurveParamFit.variable_select-467"><span class="linenos">467</span></a>            <span class="n">_oncomp</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-468"><a href="#CurveParamFit.variable_select-468"><span class="linenos">468</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-469"><a href="#CurveParamFit.variable_select-469"><span class="linenos">469</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for different curves&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-470"><a href="#CurveParamFit.variable_select-470"><span class="linenos">470</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit.variable_select-471"><a href="#CurveParamFit.variable_select-471"><span class="linenos">471</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit.variable_select-472"><a href="#CurveParamFit.variable_select-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">best_curve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span>
</span></pre></div>


            <div class="docstring"><p>Performs variable selection for each curve type and returns the best curve based on the specified metric.
The function also returns the performance metrics for each curve type.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>on : str, optional
    The performance metric to use for comparison. Default is 'RMSE'.
verbose : bool, optional
    Whether to print the results. Default is True.
plot : bool, optional
    Whether to plot the performance comparison. Default is True.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>best_curve : str
    The best curve based on the specified metric.
varselect_result : pd.DataFrame
    The performance metrics for each curve type.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.indep_vars_occurence" class="classattr">
                                        <input id="CurveParamFit.indep_vars_occurence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">indep_vars_occurence</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">plot</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.indep_vars_occurence-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.indep_vars_occurence"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.indep_vars_occurence-474"><a href="#CurveParamFit.indep_vars_occurence-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="nf">indep_vars_occurence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit.indep_vars_occurence-475"><a href="#CurveParamFit.indep_vars_occurence-475"><span class="linenos">475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.indep_vars_occurence-476"><a href="#CurveParamFit.indep_vars_occurence-476"><span class="linenos">476</span></a><span class="sd">        Gives the number of occurences of each independent variable in the best combinations of variables for each curve.</span>
</span><span id="CurveParamFit.indep_vars_occurence-477"><a href="#CurveParamFit.indep_vars_occurence-477"><span class="linenos">477</span></a><span class="sd">        The function can be used to identify the most important variables in the dataset.</span>
</span><span id="CurveParamFit.indep_vars_occurence-478"><a href="#CurveParamFit.indep_vars_occurence-478"><span class="linenos">478</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit.indep_vars_occurence-479"><a href="#CurveParamFit.indep_vars_occurence-479"><span class="linenos">479</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit.indep_vars_occurence-480"><a href="#CurveParamFit.indep_vars_occurence-480"><span class="linenos">480</span></a><span class="sd">            normalize : bool, optional</span>
</span><span id="CurveParamFit.indep_vars_occurence-481"><a href="#CurveParamFit.indep_vars_occurence-481"><span class="linenos">481</span></a><span class="sd">                Whether to normalize the occurrences as a percentage. Default is True.</span>
</span><span id="CurveParamFit.indep_vars_occurence-482"><a href="#CurveParamFit.indep_vars_occurence-482"><span class="linenos">482</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit.indep_vars_occurence-483"><a href="#CurveParamFit.indep_vars_occurence-483"><span class="linenos">483</span></a><span class="sd">                Whether to plot the occurrences. Default is True.</span>
</span><span id="CurveParamFit.indep_vars_occurence-484"><a href="#CurveParamFit.indep_vars_occurence-484"><span class="linenos">484</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit.indep_vars_occurence-485"><a href="#CurveParamFit.indep_vars_occurence-485"><span class="linenos">485</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit.indep_vars_occurence-486"><a href="#CurveParamFit.indep_vars_occurence-486"><span class="linenos">486</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit.indep_vars_occurence-487"><a href="#CurveParamFit.indep_vars_occurence-487"><span class="linenos">487</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit.indep_vars_occurence-488"><a href="#CurveParamFit.indep_vars_occurence-488"><span class="linenos">488</span></a><span class="sd">            variable_percentage : pd.Series</span>
</span><span id="CurveParamFit.indep_vars_occurence-489"><a href="#CurveParamFit.indep_vars_occurence-489"><span class="linenos">489</span></a><span class="sd">                The percentage of occurrence of each independent variable in the best combinations.</span>
</span><span id="CurveParamFit.indep_vars_occurence-490"><a href="#CurveParamFit.indep_vars_occurence-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.indep_vars_occurence-491"><a href="#CurveParamFit.indep_vars_occurence-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CurveParamFit.indep_vars_occurence-492"><a href="#CurveParamFit.indep_vars_occurence-492"><span class="linenos">492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-493"><a href="#CurveParamFit.indep_vars_occurence-493"><span class="linenos">493</span></a>        <span class="n">curves_best_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit.indep_vars_occurence-494"><a href="#CurveParamFit.indep_vars_occurence-494"><span class="linenos">494</span></a>        <span class="c1"># curves_best_combo = self.varselect_result.set_index(&#39;Curve&#39;)[&#39;Best Combination&#39;]</span>
</span><span id="CurveParamFit.indep_vars_occurence-495"><a href="#CurveParamFit.indep_vars_occurence-495"><span class="linenos">495</span></a>        <span class="n">all_variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">curves_best_combo</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</span><span id="CurveParamFit.indep_vars_occurence-496"><a href="#CurveParamFit.indep_vars_occurence-496"><span class="linenos">496</span></a>
</span><span id="CurveParamFit.indep_vars_occurence-497"><a href="#CurveParamFit.indep_vars_occurence-497"><span class="linenos">497</span></a>        <span class="c1"># Count occurrences of each variable</span>
</span><span id="CurveParamFit.indep_vars_occurence-498"><a href="#CurveParamFit.indep_vars_occurence-498"><span class="linenos">498</span></a>        <span class="n">variable_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_variables</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-499"><a href="#CurveParamFit.indep_vars_occurence-499"><span class="linenos">499</span></a>
</span><span id="CurveParamFit.indep_vars_occurence-500"><a href="#CurveParamFit.indep_vars_occurence-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="CurveParamFit.indep_vars_occurence-501"><a href="#CurveParamFit.indep_vars_occurence-501"><span class="linenos">501</span></a>            <span class="c1"># Compute the percentage for each variable</span>
</span><span id="CurveParamFit.indep_vars_occurence-502"><a href="#CurveParamFit.indep_vars_occurence-502"><span class="linenos">502</span></a>            <span class="n">total_curves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_best_combo</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-503"><a href="#CurveParamFit.indep_vars_occurence-503"><span class="linenos">503</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">total_curves</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">variable_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="CurveParamFit.indep_vars_occurence-504"><a href="#CurveParamFit.indep_vars_occurence-504"><span class="linenos">504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.indep_vars_occurence-505"><a href="#CurveParamFit.indep_vars_occurence-505"><span class="linenos">505</span></a>            <span class="n">variable_percentage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">variable_counts</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</span><span id="CurveParamFit.indep_vars_occurence-506"><a href="#CurveParamFit.indep_vars_occurence-506"><span class="linenos">506</span></a>
</span><span id="CurveParamFit.indep_vars_occurence-507"><a href="#CurveParamFit.indep_vars_occurence-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit.indep_vars_occurence-508"><a href="#CurveParamFit.indep_vars_occurence-508"><span class="linenos">508</span></a>            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Percentage of Occurrence&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;Number of Occurrence&#39;</span>
</span><span id="CurveParamFit.indep_vars_occurence-509"><a href="#CurveParamFit.indep_vars_occurence-509"><span class="linenos">509</span></a>            
</span><span id="CurveParamFit.indep_vars_occurence-510"><a href="#CurveParamFit.indep_vars_occurence-510"><span class="linenos">510</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit.indep_vars_occurence-511"><a href="#CurveParamFit.indep_vars_occurence-511"><span class="linenos">511</span></a>            <span class="n">variable_percentage</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-512"><a href="#CurveParamFit.indep_vars_occurence-512"><span class="linenos">512</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-513"><a href="#CurveParamFit.indep_vars_occurence-513"><span class="linenos">513</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Independent Variables&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-514"><a href="#CurveParamFit.indep_vars_occurence-514"><span class="linenos">514</span></a>            <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit.indep_vars_occurence-515"><a href="#CurveParamFit.indep_vars_occurence-515"><span class="linenos">515</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Occurrence of Independent Variables in best combinations per curve&#39;</span>
</span><span id="CurveParamFit.indep_vars_occurence-516"><a href="#CurveParamFit.indep_vars_occurence-516"><span class="linenos">516</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveParamFit.indep_vars_occurence-517"><a href="#CurveParamFit.indep_vars_occurence-517"><span class="linenos">517</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit.indep_vars_occurence-518"><a href="#CurveParamFit.indep_vars_occurence-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="n">variable_percentage</span>
</span></pre></div>


            <div class="docstring"><p>Gives the number of occurences of each independent variable in the best combinations of variables for each curve.
The function can be used to identify the most important variables in the dataset.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>normalize : bool, optional
    Whether to normalize the occurrences as a percentage. Default is True.
plot : bool, optional
    Whether to plot the occurrences. Default is True.
title : str, optional
    The title of the plot. Default is ''.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>variable_percentage : pd.Series
    The percentage of occurrence of each independent variable in the best combinations.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.fit_best_curves" class="classattr">
                                        <input id="CurveParamFit.fit_best_curves-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit_best_curves</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.fit_best_curves-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.fit_best_curves"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.fit_best_curves-547"><a href="#CurveParamFit.fit_best_curves-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">fit_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CurveParamFit.fit_best_curves-548"><a href="#CurveParamFit.fit_best_curves-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits the best curve for each curve type based on the selected variables.&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.fit_best_curves-549"><a href="#CurveParamFit.fit_best_curves-549"><span class="linenos">549</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-550"><a href="#CurveParamFit.fit_best_curves-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variable_select</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveParamFit.fit_best_curves-551"><a href="#CurveParamFit.fit_best_curves-551"><span class="linenos">551</span></a>        
</span><span id="CurveParamFit.fit_best_curves-552"><a href="#CurveParamFit.fit_best_curves-552"><span class="linenos">552</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parallel</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-553"><a href="#CurveParamFit.fit_best_curves-553"><span class="linenos">553</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">curvename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
</span><span id="CurveParamFit.fit_best_curves-554"><a href="#CurveParamFit.fit_best_curves-554"><span class="linenos">554</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit.fit_best_curves-555"><a href="#CurveParamFit.fit_best_curves-555"><span class="linenos">555</span></a>            <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-556"><a href="#CurveParamFit.fit_best_curves-556"><span class="linenos">556</span></a>                <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
</span><span id="CurveParamFit.fit_best_curves-557"><a href="#CurveParamFit.fit_best_curves-557"><span class="linenos">557</span></a>                
</span><span id="CurveParamFit.fit_best_curves-558"><a href="#CurveParamFit.fit_best_curves-558"><span class="linenos">558</span></a>                <span class="k">for</span> <span class="n">future</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
</span><span id="CurveParamFit.fit_best_curves-559"><a href="#CurveParamFit.fit_best_curves-559"><span class="linenos">559</span></a>                    <span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span> <span class="o">=</span> <span class="n">task</span>
</span><span id="CurveParamFit.fit_best_curves-560"><a href="#CurveParamFit.fit_best_curves-560"><span class="linenos">560</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-561"><a href="#CurveParamFit.fit_best_curves-561"><span class="linenos">561</span></a>                        <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="CurveParamFit.fit_best_curves-562"><a href="#CurveParamFit.fit_best_curves-562"><span class="linenos">562</span></a>                        <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="n">popt_down</span><span class="p">}</span>
</span><span id="CurveParamFit.fit_best_curves-563"><a href="#CurveParamFit.fit_best_curves-563"><span class="linenos">563</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-564"><a href="#CurveParamFit.fit_best_curves-564"><span class="linenos">564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">curvename</span><span class="si">}</span><span class="s1"> curve fitting generated an exception: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.fit_best_curves-565"><a href="#CurveParamFit.fit_best_curves-565"><span class="linenos">565</span></a>        <span class="k">else</span><span class="p">:</span> 
</span><span id="CurveParamFit.fit_best_curves-566"><a href="#CurveParamFit.fit_best_curves-566"><span class="linenos">566</span></a>            <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="CurveParamFit.fit_best_curves-567"><a href="#CurveParamFit.fit_best_curves-567"><span class="linenos">567</span></a>            <span class="n">_best_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit.fit_best_curves-568"><a href="#CurveParamFit.fit_best_curves-568"><span class="linenos">568</span></a>            <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="CurveParamFit.fit_best_curves-569"><a href="#CurveParamFit.fit_best_curves-569"><span class="linenos">569</span></a>                <span class="n">best_combination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">varselect_result</span><span class="p">[</span><span class="s1">&#39;Curve&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curvename</span><span class="p">,</span> <span class="s1">&#39;Best Combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit.fit_best_curves-570"><a href="#CurveParamFit.fit_best_curves-570"><span class="linenos">570</span></a>                <span class="n">popt</span><span class="p">,</span> <span class="n">popt_up</span><span class="p">,</span> <span class="n">popt_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">best_combination</span><span class="p">)</span>
</span><span id="CurveParamFit.fit_best_curves-571"><a href="#CurveParamFit.fit_best_curves-571"><span class="linenos">571</span></a>                <span class="n">_best_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vars&#39;</span><span class="p">:</span><span class="n">best_combination</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">:</span> <span class="n">popt</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span><span class="n">popt_up</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span><span class="n">popt_down</span><span class="p">}</span>
</span><span id="CurveParamFit.fit_best_curves-572"><a href="#CurveParamFit.fit_best_curves-572"><span class="linenos">572</span></a>
</span><span id="CurveParamFit.fit_best_curves-573"><a href="#CurveParamFit.fit_best_curves-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="o">=</span> <span class="n">_best_params</span>
</span><span id="CurveParamFit.fit_best_curves-574"><a href="#CurveParamFit.fit_best_curves-574"><span class="linenos">574</span></a>        <span class="k">return</span> <span class="n">_best_params</span>
</span></pre></div>


            <div class="docstring"><p>Fits the best curve for each curve type based on the selected variables.</p>
</div>


                            </div>
                            <div id="CurveParamFit.compare_best_curves" class="classattr">
                                        <input id="CurveParamFit.compare_best_curves-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compare_best_curves</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">plot</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">CI</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.compare_best_curves-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.compare_best_curves"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.compare_best_curves-576"><a href="#CurveParamFit.compare_best_curves-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">compare_best_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit.compare_best_curves-577"><a href="#CurveParamFit.compare_best_curves-577"><span class="linenos">577</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.compare_best_curves-578"><a href="#CurveParamFit.compare_best_curves-578"><span class="linenos">578</span></a><span class="sd">        Compares the best curves for each curve type based on the performance metrics.</span>
</span><span id="CurveParamFit.compare_best_curves-579"><a href="#CurveParamFit.compare_best_curves-579"><span class="linenos">579</span></a><span class="sd">        The function also returns the performance metrics, the predictions, and the parameters for each curve type.</span>
</span><span id="CurveParamFit.compare_best_curves-580"><a href="#CurveParamFit.compare_best_curves-580"><span class="linenos">580</span></a>
</span><span id="CurveParamFit.compare_best_curves-581"><a href="#CurveParamFit.compare_best_curves-581"><span class="linenos">581</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit.compare_best_curves-582"><a href="#CurveParamFit.compare_best_curves-582"><span class="linenos">582</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit.compare_best_curves-583"><a href="#CurveParamFit.compare_best_curves-583"><span class="linenos">583</span></a><span class="sd">            plot : bool, optional</span>
</span><span id="CurveParamFit.compare_best_curves-584"><a href="#CurveParamFit.compare_best_curves-584"><span class="linenos">584</span></a><span class="sd">                Whether to plot the best curves. Default is True.</span>
</span><span id="CurveParamFit.compare_best_curves-585"><a href="#CurveParamFit.compare_best_curves-585"><span class="linenos">585</span></a><span class="sd">            CI : bool, optional</span>
</span><span id="CurveParamFit.compare_best_curves-586"><a href="#CurveParamFit.compare_best_curves-586"><span class="linenos">586</span></a><span class="sd">                Whether to plot the confidence interval. Default is True.</span>
</span><span id="CurveParamFit.compare_best_curves-587"><a href="#CurveParamFit.compare_best_curves-587"><span class="linenos">587</span></a><span class="sd">            </span>
</span><span id="CurveParamFit.compare_best_curves-588"><a href="#CurveParamFit.compare_best_curves-588"><span class="linenos">588</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit.compare_best_curves-589"><a href="#CurveParamFit.compare_best_curves-589"><span class="linenos">589</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit.compare_best_curves-590"><a href="#CurveParamFit.compare_best_curves-590"><span class="linenos">590</span></a><span class="sd">            perf_metrics_df : pd.DataFrame</span>
</span><span id="CurveParamFit.compare_best_curves-591"><a href="#CurveParamFit.compare_best_curves-591"><span class="linenos">591</span></a><span class="sd">                The performance metrics for each curve type.</span>
</span><span id="CurveParamFit.compare_best_curves-592"><a href="#CurveParamFit.compare_best_curves-592"><span class="linenos">592</span></a><span class="sd">            predictions_df : pd.DataFrame</span>
</span><span id="CurveParamFit.compare_best_curves-593"><a href="#CurveParamFit.compare_best_curves-593"><span class="linenos">593</span></a><span class="sd">                The predictions for each curve type.</span>
</span><span id="CurveParamFit.compare_best_curves-594"><a href="#CurveParamFit.compare_best_curves-594"><span class="linenos">594</span></a><span class="sd">            param_df : pd.DataFrame</span>
</span><span id="CurveParamFit.compare_best_curves-595"><a href="#CurveParamFit.compare_best_curves-595"><span class="linenos">595</span></a><span class="sd">                The parameters for each curve type.</span>
</span><span id="CurveParamFit.compare_best_curves-596"><a href="#CurveParamFit.compare_best_curves-596"><span class="linenos">596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.compare_best_curves-597"><a href="#CurveParamFit.compare_best_curves-597"><span class="linenos">597</span></a>
</span><span id="CurveParamFit.compare_best_curves-598"><a href="#CurveParamFit.compare_best_curves-598"><span class="linenos">598</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit.compare_best_curves-599"><a href="#CurveParamFit.compare_best_curves-599"><span class="linenos">599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="CurveParamFit.compare_best_curves-600"><a href="#CurveParamFit.compare_best_curves-600"><span class="linenos">600</span></a>                
</span><span id="CurveParamFit.compare_best_curves-601"><a href="#CurveParamFit.compare_best_curves-601"><span class="linenos">601</span></a>        <span class="n">fitted_curves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="CurveParamFit.compare_best_curves-602"><a href="#CurveParamFit.compare_best_curves-602"><span class="linenos">602</span></a>        <span class="n">predictions_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit.compare_best_curves-603"><a href="#CurveParamFit.compare_best_curves-603"><span class="linenos">603</span></a>        <span class="n">params_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit.compare_best_curves-604"><a href="#CurveParamFit.compare_best_curves-604"><span class="linenos">604</span></a>        <span class="n">perf_metrics_d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CurveParamFit.compare_best_curves-605"><a href="#CurveParamFit.compare_best_curves-605"><span class="linenos">605</span></a>        <span class="k">for</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="n">fitted_curves</span><span class="p">:</span>
</span><span id="CurveParamFit.compare_best_curves-606"><a href="#CurveParamFit.compare_best_curves-606"><span class="linenos">606</span></a>            <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="CurveParamFit.compare_best_curves-607"><a href="#CurveParamFit.compare_best_curves-607"><span class="linenos">607</span></a>            <span class="n">params_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span> 
</span><span id="CurveParamFit.compare_best_curves-608"><a href="#CurveParamFit.compare_best_curves-608"><span class="linenos">608</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">])),</span>
</span><span id="CurveParamFit.compare_best_curves-609"><a href="#CurveParamFit.compare_best_curves-609"><span class="linenos">609</span></a>                                            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_params</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]))</span>
</span><span id="CurveParamFit.compare_best_curves-610"><a href="#CurveParamFit.compare_best_curves-610"><span class="linenos">610</span></a>                                            <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="s1">&#39;upper bound&#39;</span><span class="p">,</span> <span class="s1">&#39;lower bound&#39;</span><span class="p">])</span>
</span><span id="CurveParamFit.compare_best_curves-611"><a href="#CurveParamFit.compare_best_curves-611"><span class="linenos">611</span></a>            <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-612"><a href="#CurveParamFit.compare_best_curves-612"><span class="linenos">612</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">][</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="CurveParamFit.compare_best_curves-613"><a href="#CurveParamFit.compare_best_curves-613"><span class="linenos">613</span></a>            <span class="n">perf_metrics_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span> <span class="o">=</span> <span class="n">perf_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-614"><a href="#CurveParamFit.compare_best_curves-614"><span class="linenos">614</span></a>        
</span><span id="CurveParamFit.compare_best_curves-615"><a href="#CurveParamFit.compare_best_curves-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveParamFit.compare_best_curves-616"><a href="#CurveParamFit.compare_best_curves-616"><span class="linenos">616</span></a>            <span class="n">curves_l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictions_d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CurveParamFit.compare_best_curves-617"><a href="#CurveParamFit.compare_best_curves-617"><span class="linenos">617</span></a>            <span class="n">nplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curves_l</span><span class="p">)</span> 
</span><span id="CurveParamFit.compare_best_curves-618"><a href="#CurveParamFit.compare_best_curves-618"><span class="linenos">618</span></a>            <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="CurveParamFit.compare_best_curves-619"><a href="#CurveParamFit.compare_best_curves-619"><span class="linenos">619</span></a>            <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveParamFit.compare_best_curves-620"><a href="#CurveParamFit.compare_best_curves-620"><span class="linenos">620</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit.compare_best_curves-621"><a href="#CurveParamFit.compare_best_curves-621"><span class="linenos">621</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curvename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">curves_l</span><span class="p">):</span>
</span><span id="CurveParamFit.compare_best_curves-622"><a href="#CurveParamFit.compare_best_curves-622"><span class="linenos">622</span></a>                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-623"><a href="#CurveParamFit.compare_best_curves-623"><span class="linenos">623</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">predictions_d</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>
</span><span id="CurveParamFit.compare_best_curves-624"><a href="#CurveParamFit.compare_best_curves-624"><span class="linenos">624</span></a>                <span class="k">if</span> <span class="n">CI</span><span class="p">:</span>
</span><span id="CurveParamFit.compare_best_curves-625"><a href="#CurveParamFit.compare_best_curves-625"><span class="linenos">625</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span> 
</span><span id="CurveParamFit.compare_best_curves-626"><a href="#CurveParamFit.compare_best_curves-626"><span class="linenos">626</span></a>                <span class="k">else</span> <span class="p">:</span>
</span><span id="CurveParamFit.compare_best_curves-627"><a href="#CurveParamFit.compare_best_curves-627"><span class="linenos">627</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">curvename</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-628"><a href="#CurveParamFit.compare_best_curves-628"><span class="linenos">628</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveParamFit.compare_best_curves-629"><a href="#CurveParamFit.compare_best_curves-629"><span class="linenos">629</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit.compare_best_curves-630"><a href="#CurveParamFit.compare_best_curves-630"><span class="linenos">630</span></a>
</span><span id="CurveParamFit.compare_best_curves-631"><a href="#CurveParamFit.compare_best_curves-631"><span class="linenos">631</span></a>        <span class="n">perf_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">perf_metrics_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-632"><a href="#CurveParamFit.compare_best_curves-632"><span class="linenos">632</span></a>        <span class="n">param_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">params_d</span><span class="p">)</span>
</span><span id="CurveParamFit.compare_best_curves-633"><a href="#CurveParamFit.compare_best_curves-633"><span class="linenos">633</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">predictions_d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
</span><span id="CurveParamFit.compare_best_curves-634"><a href="#CurveParamFit.compare_best_curves-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="n">perf_metrics_df</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">,</span> <span class="n">param_df</span>
</span></pre></div>


            <div class="docstring"><p>Compares the best curves for each curve type based on the performance metrics.
The function also returns the performance metrics, the predictions, and the parameters for each curve type.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>plot : bool, optional
    Whether to plot the best curves. Default is True.
CI : bool, optional
    Whether to plot the confidence interval. Default is True.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>perf_metrics_df : pd.DataFrame
    The performance metrics for each curve type.
predictions_df : pd.DataFrame
    The predictions for each curve type.
param_df : pd.DataFrame
    The parameters for each curve type.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.predict_best_curve" class="classattr">
                                        <input id="CurveParamFit.predict_best_curve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict_best_curve</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">curvename</span>, </span><span class="param"><span class="n">X</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.predict_best_curve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.predict_best_curve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.predict_best_curve-636"><a href="#CurveParamFit.predict_best_curve-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">predict_best_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CurveParamFit.predict_best_curve-637"><a href="#CurveParamFit.predict_best_curve-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.predict_best_curve-638"><a href="#CurveParamFit.predict_best_curve-638"><span class="linenos">638</span></a><span class="sd">        Predicts the dependent variable using the best curve for the specified curve type.</span>
</span><span id="CurveParamFit.predict_best_curve-639"><a href="#CurveParamFit.predict_best_curve-639"><span class="linenos">639</span></a>
</span><span id="CurveParamFit.predict_best_curve-640"><a href="#CurveParamFit.predict_best_curve-640"><span class="linenos">640</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit.predict_best_curve-641"><a href="#CurveParamFit.predict_best_curve-641"><span class="linenos">641</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit.predict_best_curve-642"><a href="#CurveParamFit.predict_best_curve-642"><span class="linenos">642</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit.predict_best_curve-643"><a href="#CurveParamFit.predict_best_curve-643"><span class="linenos">643</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="CurveParamFit.predict_best_curve-644"><a href="#CurveParamFit.predict_best_curve-644"><span class="linenos">644</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="CurveParamFit.predict_best_curve-645"><a href="#CurveParamFit.predict_best_curve-645"><span class="linenos">645</span></a><span class="sd">            X : pd.DataFrame, optional</span>
</span><span id="CurveParamFit.predict_best_curve-646"><a href="#CurveParamFit.predict_best_curve-646"><span class="linenos">646</span></a><span class="sd">                The independent variables to use for prediction. Default is None.</span>
</span><span id="CurveParamFit.predict_best_curve-647"><a href="#CurveParamFit.predict_best_curve-647"><span class="linenos">647</span></a>
</span><span id="CurveParamFit.predict_best_curve-648"><a href="#CurveParamFit.predict_best_curve-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit.predict_best_curve-649"><a href="#CurveParamFit.predict_best_curve-649"><span class="linenos">649</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit.predict_best_curve-650"><a href="#CurveParamFit.predict_best_curve-650"><span class="linenos">650</span></a><span class="sd">            prediction : pd.DataFrame</span>
</span><span id="CurveParamFit.predict_best_curve-651"><a href="#CurveParamFit.predict_best_curve-651"><span class="linenos">651</span></a><span class="sd">                A DataFrame containing the predicted dependent variable along with the confidence interval.        </span>
</span><span id="CurveParamFit.predict_best_curve-652"><a href="#CurveParamFit.predict_best_curve-652"><span class="linenos">652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.predict_best_curve-653"><a href="#CurveParamFit.predict_best_curve-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-654"><a href="#CurveParamFit.predict_best_curve-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fit_best_curves</span><span class="p">()</span>
</span><span id="CurveParamFit.predict_best_curve-655"><a href="#CurveParamFit.predict_best_curve-655"><span class="linenos">655</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-656"><a href="#CurveParamFit.predict_best_curve-656"><span class="linenos">656</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CurveParamFit.predict_best_curve-657"><a href="#CurveParamFit.predict_best_curve-657"><span class="linenos">657</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-658"><a href="#CurveParamFit.predict_best_curve-658"><span class="linenos">658</span></a>            <span class="c1"># normalize the data</span>
</span><span id="CurveParamFit.predict_best_curve-659"><a href="#CurveParamFit.predict_best_curve-659"><span class="linenos">659</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveParamFit.predict_best_curve-660"><a href="#CurveParamFit.predict_best_curve-660"><span class="linenos">660</span></a>            <span class="c1"># add constant column if requested</span>
</span><span id="CurveParamFit.predict_best_curve-661"><a href="#CurveParamFit.predict_best_curve-661"><span class="linenos">661</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-662"><a href="#CurveParamFit.predict_best_curve-662"><span class="linenos">662</span></a>                <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.predict_best_curve-663"><a href="#CurveParamFit.predict_best_curve-663"><span class="linenos">663</span></a>
</span><span id="CurveParamFit.predict_best_curve-664"><a href="#CurveParamFit.predict_best_curve-664"><span class="linenos">664</span></a>        <span class="n">_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_curves_params</span><span class="p">[</span><span class="n">curvename</span><span class="p">]</span>       
</span><span id="CurveParamFit.predict_best_curve-665"><a href="#CurveParamFit.predict_best_curve-665"><span class="linenos">665</span></a>        <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span><span class="p">(</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;avg&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">_params</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">])</span>
</span><span id="CurveParamFit.predict_best_curve-666"><a href="#CurveParamFit.predict_best_curve-666"><span class="linenos">666</span></a>        <span class="c1"># transform back X to the original scale</span>
</span><span id="CurveParamFit.predict_best_curve-667"><a href="#CurveParamFit.predict_best_curve-667"><span class="linenos">667</span></a>        <span class="k">if</span> <span class="s1">&#39;constant&#39;</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-668"><a href="#CurveParamFit.predict_best_curve-668"><span class="linenos">668</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.predict_best_curve-669"><a href="#CurveParamFit.predict_best_curve-669"><span class="linenos">669</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="CurveParamFit.predict_best_curve-670"><a href="#CurveParamFit.predict_best_curve-670"><span class="linenos">670</span></a>            <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.predict_best_curve-671"><a href="#CurveParamFit.predict_best_curve-671"><span class="linenos">671</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.predict_best_curve-672"><a href="#CurveParamFit.predict_best_curve-672"><span class="linenos">672</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
</span><span id="CurveParamFit.predict_best_curve-673"><a href="#CurveParamFit.predict_best_curve-673"><span class="linenos">673</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.predict_best_curve-674"><a href="#CurveParamFit.predict_best_curve-674"><span class="linenos">674</span></a>        <span class="k">return</span> <span class="n">prediction</span>
</span></pre></div>


            <div class="docstring"><p>Predicts the dependent variable using the best curve for the specified curve type.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>curvename : str
    The name of the curve used to obtain the prediction. This curve should already be fitted
    and should correspond to one of the curves supported by the system.
X : pd.DataFrame, optional
    The independent variables to use for prediction. Default is None.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>prediction : pd.DataFrame
    A DataFrame containing the predicted dependent variable along with the confidence interval.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.most_probable_value" class="classattr">
                                        <input id="CurveParamFit.most_probable_value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">most_probable_value</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">curvename</span>, </span><span class="param"><span class="n">known_value</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.most_probable_value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.most_probable_value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.most_probable_value-676"><a href="#CurveParamFit.most_probable_value-676"><span class="linenos">676</span></a>    <span class="k">def</span> <span class="nf">most_probable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curvename</span><span class="p">,</span> <span class="n">known_value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveParamFit.most_probable_value-677"><a href="#CurveParamFit.most_probable_value-677"><span class="linenos">677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.most_probable_value-678"><a href="#CurveParamFit.most_probable_value-678"><span class="linenos">678</span></a><span class="sd">        Estimates the most probable value of a dependent or independent variable using a fitted curve,</span>
</span><span id="CurveParamFit.most_probable_value-679"><a href="#CurveParamFit.most_probable_value-679"><span class="linenos">679</span></a><span class="sd">        based on a provided known value. </span>
</span><span id="CurveParamFit.most_probable_value-680"><a href="#CurveParamFit.most_probable_value-680"><span class="linenos">680</span></a><span class="sd">        This method performs linear interpolation between the closest data points or uses boundary values</span>
</span><span id="CurveParamFit.most_probable_value-681"><a href="#CurveParamFit.most_probable_value-681"><span class="linenos">681</span></a><span class="sd">        if the known value exceeds the available data range.</span>
</span><span id="CurveParamFit.most_probable_value-682"><a href="#CurveParamFit.most_probable_value-682"><span class="linenos">682</span></a>
</span><span id="CurveParamFit.most_probable_value-683"><a href="#CurveParamFit.most_probable_value-683"><span class="linenos">683</span></a><span class="sd">        This function is particularly useful when you have a value of one variable and need to estimate</span>
</span><span id="CurveParamFit.most_probable_value-684"><a href="#CurveParamFit.most_probable_value-684"><span class="linenos">684</span></a><span class="sd">        the corresponding value of another variable based on the relationship defined by the specified curve.</span>
</span><span id="CurveParamFit.most_probable_value-685"><a href="#CurveParamFit.most_probable_value-685"><span class="linenos">685</span></a>
</span><span id="CurveParamFit.most_probable_value-686"><a href="#CurveParamFit.most_probable_value-686"><span class="linenos">686</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveParamFit.most_probable_value-687"><a href="#CurveParamFit.most_probable_value-687"><span class="linenos">687</span></a><span class="sd">        -----------</span>
</span><span id="CurveParamFit.most_probable_value-688"><a href="#CurveParamFit.most_probable_value-688"><span class="linenos">688</span></a><span class="sd">            curvename : str</span>
</span><span id="CurveParamFit.most_probable_value-689"><a href="#CurveParamFit.most_probable_value-689"><span class="linenos">689</span></a><span class="sd">                The name of the curve used to obtain the prediction. This curve should already be fitted</span>
</span><span id="CurveParamFit.most_probable_value-690"><a href="#CurveParamFit.most_probable_value-690"><span class="linenos">690</span></a><span class="sd">                and should correspond to one of the curves supported by the system.</span>
</span><span id="CurveParamFit.most_probable_value-691"><a href="#CurveParamFit.most_probable_value-691"><span class="linenos">691</span></a><span class="sd">            </span>
</span><span id="CurveParamFit.most_probable_value-692"><a href="#CurveParamFit.most_probable_value-692"><span class="linenos">692</span></a><span class="sd">            known_value : tuple</span>
</span><span id="CurveParamFit.most_probable_value-693"><a href="#CurveParamFit.most_probable_value-693"><span class="linenos">693</span></a><span class="sd">                A tuple containing:</span>
</span><span id="CurveParamFit.most_probable_value-694"><a href="#CurveParamFit.most_probable_value-694"><span class="linenos">694</span></a><span class="sd">                - The name of the variable (str) for which the value is known.</span>
</span><span id="CurveParamFit.most_probable_value-695"><a href="#CurveParamFit.most_probable_value-695"><span class="linenos">695</span></a><span class="sd">                - The known value (float) of that variable.</span>
</span><span id="CurveParamFit.most_probable_value-696"><a href="#CurveParamFit.most_probable_value-696"><span class="linenos">696</span></a>
</span><span id="CurveParamFit.most_probable_value-697"><a href="#CurveParamFit.most_probable_value-697"><span class="linenos">697</span></a><span class="sd">                The variable name must be one of the dependent or main independent variables used in the model.</span>
</span><span id="CurveParamFit.most_probable_value-698"><a href="#CurveParamFit.most_probable_value-698"><span class="linenos">698</span></a>
</span><span id="CurveParamFit.most_probable_value-699"><a href="#CurveParamFit.most_probable_value-699"><span class="linenos">699</span></a><span class="sd">        Returns:</span>
</span><span id="CurveParamFit.most_probable_value-700"><a href="#CurveParamFit.most_probable_value-700"><span class="linenos">700</span></a><span class="sd">        --------</span>
</span><span id="CurveParamFit.most_probable_value-701"><a href="#CurveParamFit.most_probable_value-701"><span class="linenos">701</span></a><span class="sd">            float</span>
</span><span id="CurveParamFit.most_probable_value-702"><a href="#CurveParamFit.most_probable_value-702"><span class="linenos">702</span></a><span class="sd">                The estimated value of the other variable. This could be an interpolated value between data points</span>
</span><span id="CurveParamFit.most_probable_value-703"><a href="#CurveParamFit.most_probable_value-703"><span class="linenos">703</span></a><span class="sd">                or a boundary value if the known value is outside the range of the available data.</span>
</span><span id="CurveParamFit.most_probable_value-704"><a href="#CurveParamFit.most_probable_value-704"><span class="linenos">704</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.most_probable_value-705"><a href="#CurveParamFit.most_probable_value-705"><span class="linenos">705</span></a>        <span class="n">dep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span>
</span><span id="CurveParamFit.most_probable_value-706"><a href="#CurveParamFit.most_probable_value-706"><span class="linenos">706</span></a>        <span class="n">main_indep_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span>
</span><span id="CurveParamFit.most_probable_value-707"><a href="#CurveParamFit.most_probable_value-707"><span class="linenos">707</span></a>        <span class="k">assert</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dep_var</span><span class="p">,</span> <span class="n">main_indep_var</span><span class="p">],</span> <span class="s2">&quot;known_value[0] must be either dep_var or main_indep_var&quot;</span>
</span><span id="CurveParamFit.most_probable_value-708"><a href="#CurveParamFit.most_probable_value-708"><span class="linenos">708</span></a>        
</span><span id="CurveParamFit.most_probable_value-709"><a href="#CurveParamFit.most_probable_value-709"><span class="linenos">709</span></a>        <span class="c1"># Fetch the predictions and adjust column names</span>
</span><span id="CurveParamFit.most_probable_value-710"><a href="#CurveParamFit.most_probable_value-710"><span class="linenos">710</span></a>        <span class="n">predictions_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best_curve</span><span class="p">(</span><span class="n">curvename</span><span class="o">=</span><span class="n">curvename</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-711"><a href="#CurveParamFit.most_probable_value-711"><span class="linenos">711</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">dep_var</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-712"><a href="#CurveParamFit.most_probable_value-712"><span class="linenos">712</span></a>        
</span><span id="CurveParamFit.most_probable_value-713"><a href="#CurveParamFit.most_probable_value-713"><span class="linenos">713</span></a>        <span class="c1"># Sort DataFrame by the variable of interest</span>
</span><span id="CurveParamFit.most_probable_value-714"><a href="#CurveParamFit.most_probable_value-714"><span class="linenos">714</span></a>        <span class="n">predictions_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-715"><a href="#CurveParamFit.most_probable_value-715"><span class="linenos">715</span></a>        
</span><span id="CurveParamFit.most_probable_value-716"><a href="#CurveParamFit.most_probable_value-716"><span class="linenos">716</span></a>        <span class="c1"># Find rows where the known value is just above and below the input value</span>
</span><span id="CurveParamFit.most_probable_value-717"><a href="#CurveParamFit.most_probable_value-717"><span class="linenos">717</span></a>        <span class="n">filter_above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-718"><a href="#CurveParamFit.most_probable_value-718"><span class="linenos">718</span></a>        <span class="n">filter_below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-719"><a href="#CurveParamFit.most_probable_value-719"><span class="linenos">719</span></a>        
</span><span id="CurveParamFit.most_probable_value-720"><a href="#CurveParamFit.most_probable_value-720"><span class="linenos">720</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_above</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CurveParamFit.most_probable_value-721"><a href="#CurveParamFit.most_probable_value-721"><span class="linenos">721</span></a>            <span class="c1"># If known value is above all available data points</span>
</span><span id="CurveParamFit.most_probable_value-722"><a href="#CurveParamFit.most_probable_value-722"><span class="linenos">722</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-723"><a href="#CurveParamFit.most_probable_value-723"><span class="linenos">723</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-724"><a href="#CurveParamFit.most_probable_value-724"><span class="linenos">724</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is above the highest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-725"><a href="#CurveParamFit.most_probable_value-725"><span class="linenos">725</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-726"><a href="#CurveParamFit.most_probable_value-726"><span class="linenos">726</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-727"><a href="#CurveParamFit.most_probable_value-727"><span class="linenos">727</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-728"><a href="#CurveParamFit.most_probable_value-728"><span class="linenos">728</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-729"><a href="#CurveParamFit.most_probable_value-729"><span class="linenos">729</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">filter_below</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="CurveParamFit.most_probable_value-730"><a href="#CurveParamFit.most_probable_value-730"><span class="linenos">730</span></a>            <span class="c1"># If known value is below all available data points</span>
</span><span id="CurveParamFit.most_probable_value-731"><a href="#CurveParamFit.most_probable_value-731"><span class="linenos">731</span></a>            <span class="n">boundary_value</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-732"><a href="#CurveParamFit.most_probable_value-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-733"><a href="#CurveParamFit.most_probable_value-733"><span class="linenos">733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Known value </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is below the lowest available value. Using boundary value.&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-734"><a href="#CurveParamFit.most_probable_value-734"><span class="linenos">734</span></a>            <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-735"><a href="#CurveParamFit.most_probable_value-735"><span class="linenos">735</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-736"><a href="#CurveParamFit.most_probable_value-736"><span class="linenos">736</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-737"><a href="#CurveParamFit.most_probable_value-737"><span class="linenos">737</span></a>                <span class="n">to_return</span> <span class="o">=</span> <span class="n">boundary_value</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-738"><a href="#CurveParamFit.most_probable_value-738"><span class="linenos">738</span></a>        
</span><span id="CurveParamFit.most_probable_value-739"><a href="#CurveParamFit.most_probable_value-739"><span class="linenos">739</span></a>        <span class="n">above</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_above</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-740"><a href="#CurveParamFit.most_probable_value-740"><span class="linenos">740</span></a>        <span class="n">below</span> <span class="o">=</span> <span class="n">predictions_df</span><span class="p">[</span><span class="n">filter_below</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-741"><a href="#CurveParamFit.most_probable_value-741"><span class="linenos">741</span></a>        
</span><span id="CurveParamFit.most_probable_value-742"><a href="#CurveParamFit.most_probable_value-742"><span class="linenos">742</span></a>        <span class="n">x_above</span><span class="p">,</span> <span class="n">y_above</span> <span class="o">=</span> <span class="n">above</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">above</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-743"><a href="#CurveParamFit.most_probable_value-743"><span class="linenos">743</span></a>        <span class="n">x_below</span><span class="p">,</span> <span class="n">y_below</span> <span class="o">=</span> <span class="n">below</span><span class="p">[</span><span class="n">main_indep_var</span><span class="p">],</span> <span class="n">below</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveParamFit.most_probable_value-744"><a href="#CurveParamFit.most_probable_value-744"><span class="linenos">744</span></a>
</span><span id="CurveParamFit.most_probable_value-745"><a href="#CurveParamFit.most_probable_value-745"><span class="linenos">745</span></a>        <span class="c1"># Perform linear interpolation</span>
</span><span id="CurveParamFit.most_probable_value-746"><a href="#CurveParamFit.most_probable_value-746"><span class="linenos">746</span></a>        <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">main_indep_var</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-747"><a href="#CurveParamFit.most_probable_value-747"><span class="linenos">747</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-748"><a href="#CurveParamFit.most_probable_value-748"><span class="linenos">748</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="CurveParamFit.most_probable_value-749"><a href="#CurveParamFit.most_probable_value-749"><span class="linenos">749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-750"><a href="#CurveParamFit.most_probable_value-750"><span class="linenos">750</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x_below</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_above</span> <span class="o">-</span> <span class="n">x_below</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_above</span> <span class="o">-</span> <span class="n">y_below</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-751"><a href="#CurveParamFit.most_probable_value-751"><span class="linenos">751</span></a>            <span class="n">to_return</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveParamFit.most_probable_value-752"><a href="#CurveParamFit.most_probable_value-752"><span class="linenos">752</span></a>        
</span><span id="CurveParamFit.most_probable_value-753"><a href="#CurveParamFit.most_probable_value-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveParamFit.most_probable_value-754"><a href="#CurveParamFit.most_probable_value-754"><span class="linenos">754</span></a>            <span class="n">imputname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="k">if</span> <span class="n">known_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep_var</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span>
</span><span id="CurveParamFit.most_probable_value-755"><a href="#CurveParamFit.most_probable_value-755"><span class="linenos">755</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated value of </span><span class="si">{</span><span class="n">imputname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">known_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">to_return</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveParamFit.most_probable_value-756"><a href="#CurveParamFit.most_probable_value-756"><span class="linenos">756</span></a>        <span class="k">return</span> <span class="n">to_return</span>
</span></pre></div>


            <div class="docstring"><p>Estimates the most probable value of a dependent or independent variable using a fitted curve,
based on a provided known value. 
This method performs linear interpolation between the closest data points or uses boundary values
if the known value exceeds the available data range.</p>

<p>This function is particularly useful when you have a value of one variable and need to estimate
the corresponding value of another variable based on the relationship defined by the specified curve.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>curvename : str
    The name of the curve used to obtain the prediction. This curve should already be fitted
    and should correspond to one of the curves supported by the system.

known_value : tuple
    A tuple containing:
    - The name of the variable (str) for which the value is known.
    - The known value (float) of that variable.

    The variable name must be one of the dependent or main independent variables used in the model.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>float
    The estimated value of the other variable. This could be an interpolated value between data points
    or a boundary value if the known value is outside the range of the available data.
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.plot_x_y" class="classattr">
                                        <input id="CurveParamFit.plot_x_y-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_x_y</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.plot_x_y-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.plot_x_y"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.plot_x_y-758"><a href="#CurveParamFit.plot_x_y-758"><span class="linenos">758</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit.plot_x_y-759"><a href="#CurveParamFit.plot_x_y-759"><span class="linenos">759</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.plot_x_y-760"><a href="#CurveParamFit.plot_x_y-760"><span class="linenos">760</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="CurveParamFit.plot_x_y-761"><a href="#CurveParamFit.plot_x_y-761"><span class="linenos">761</span></a>
</span><span id="CurveParamFit.plot_x_y-762"><a href="#CurveParamFit.plot_x_y-762"><span class="linenos">762</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit.plot_x_y-763"><a href="#CurveParamFit.plot_x_y-763"><span class="linenos">763</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit.plot_x_y-764"><a href="#CurveParamFit.plot_x_y-764"><span class="linenos">764</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit.plot_x_y-765"><a href="#CurveParamFit.plot_x_y-765"><span class="linenos">765</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit.plot_x_y-766"><a href="#CurveParamFit.plot_x_y-766"><span class="linenos">766</span></a>
</span><span id="CurveParamFit.plot_x_y-767"><a href="#CurveParamFit.plot_x_y-767"><span class="linenos">767</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit.plot_x_y-768"><a href="#CurveParamFit.plot_x_y-768"><span class="linenos">768</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit.plot_x_y-769"><a href="#CurveParamFit.plot_x_y-769"><span class="linenos">769</span></a><span class="sd">            None        </span>
</span><span id="CurveParamFit.plot_x_y-770"><a href="#CurveParamFit.plot_x_y-770"><span class="linenos">770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.plot_x_y-771"><a href="#CurveParamFit.plot_x_y-771"><span class="linenos">771</span></a>        
</span><span id="CurveParamFit.plot_x_y-772"><a href="#CurveParamFit.plot_x_y-772"><span class="linenos">772</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveParamFit.plot_x_y-773"><a href="#CurveParamFit.plot_x_y-773"><span class="linenos">773</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="CurveParamFit.plot_x_y-774"><a href="#CurveParamFit.plot_x_y-774"><span class="linenos">774</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveParamFit.plot_x_y-775"><a href="#CurveParamFit.plot_x_y-775"><span class="linenos">775</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveParamFit.plot_x_y-776"><a href="#CurveParamFit.plot_x_y-776"><span class="linenos">776</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="CurveParamFit.plot_x_y-777"><a href="#CurveParamFit.plot_x_y-777"><span class="linenos">777</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_x_y-778"><a href="#CurveParamFit.plot_x_y-778"><span class="linenos">778</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_x_y-779"><a href="#CurveParamFit.plot_x_y-779"><span class="linenos">779</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_x_y-780"><a href="#CurveParamFit.plot_x_y-780"><span class="linenos">780</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_x_y-781"><a href="#CurveParamFit.plot_x_y-781"><span class="linenos">781</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveParamFit.plot_x_y-782"><a href="#CurveParamFit.plot_x_y-782"><span class="linenos">782</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="CurveParamFit.plot_x_y-783"><a href="#CurveParamFit.plot_x_y-783"><span class="linenos">783</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="CurveParamFit.plot_x_y-784"><a href="#CurveParamFit.plot_x_y-784"><span class="linenos">784</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_x_y-785"><a href="#CurveParamFit.plot_x_y-785"><span class="linenos">785</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveParamFit.plot_x_y-786"><a href="#CurveParamFit.plot_x_y-786"><span class="linenos">786</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveParamFit.plot_x_y-787"><a href="#CurveParamFit.plot_x_y-787"><span class="linenos">787</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Plots the dependent variable y against all the independent variables x.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>title : str, optional
    The title of the plot. Default is ''.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>None
</code></pre>
</div>


                            </div>
                            <div id="CurveParamFit.plot_curve_with_confidence_interval" class="classattr">
                                        <input id="CurveParamFit.plot_curve_with_confidence_interval-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_curve_with_confidence_interval</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ypred</span>, </span><span class="param"><span class="n">yqlb</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">yqub</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ax</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveParamFit.plot_curve_with_confidence_interval-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveParamFit.plot_curve_with_confidence_interval"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveParamFit.plot_curve_with_confidence_interval-789"><a href="#CurveParamFit.plot_curve_with_confidence_interval-789"><span class="linenos">789</span></a>    <span class="k">def</span> <span class="nf">plot_curve_with_confidence_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yqub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-790"><a href="#CurveParamFit.plot_curve_with_confidence_interval-790"><span class="linenos">790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-791"><a href="#CurveParamFit.plot_curve_with_confidence_interval-791"><span class="linenos">791</span></a><span class="sd">        Plots the fitted curve along with the confidence interval.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-792"><a href="#CurveParamFit.plot_curve_with_confidence_interval-792"><span class="linenos">792</span></a><span class="sd">        </span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-793"><a href="#CurveParamFit.plot_curve_with_confidence_interval-793"><span class="linenos">793</span></a><span class="sd">        Parameters</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-794"><a href="#CurveParamFit.plot_curve_with_confidence_interval-794"><span class="linenos">794</span></a><span class="sd">        ----------</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-795"><a href="#CurveParamFit.plot_curve_with_confidence_interval-795"><span class="linenos">795</span></a><span class="sd">            ypred : pd.Series</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-796"><a href="#CurveParamFit.plot_curve_with_confidence_interval-796"><span class="linenos">796</span></a><span class="sd">                The predicted dependent variable.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-797"><a href="#CurveParamFit.plot_curve_with_confidence_interval-797"><span class="linenos">797</span></a><span class="sd">            yqlb : pd.Series, optional</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-798"><a href="#CurveParamFit.plot_curve_with_confidence_interval-798"><span class="linenos">798</span></a><span class="sd">                The lower bound of the confidence interval. Default is None.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-799"><a href="#CurveParamFit.plot_curve_with_confidence_interval-799"><span class="linenos">799</span></a><span class="sd">            yqub : pd.Series, optional</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-800"><a href="#CurveParamFit.plot_curve_with_confidence_interval-800"><span class="linenos">800</span></a><span class="sd">                The upper bound of the confidence interval. Default is None.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-801"><a href="#CurveParamFit.plot_curve_with_confidence_interval-801"><span class="linenos">801</span></a><span class="sd">            ax : plt.Axes, optional</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-802"><a href="#CurveParamFit.plot_curve_with_confidence_interval-802"><span class="linenos">802</span></a><span class="sd">                The axes to use for plotting. Default is None.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-803"><a href="#CurveParamFit.plot_curve_with_confidence_interval-803"><span class="linenos">803</span></a><span class="sd">            title : str, optional</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-804"><a href="#CurveParamFit.plot_curve_with_confidence_interval-804"><span class="linenos">804</span></a><span class="sd">                The title of the plot. Default is &#39;&#39;.</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-805"><a href="#CurveParamFit.plot_curve_with_confidence_interval-805"><span class="linenos">805</span></a><span class="sd">        </span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-806"><a href="#CurveParamFit.plot_curve_with_confidence_interval-806"><span class="linenos">806</span></a><span class="sd">        Returns</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-807"><a href="#CurveParamFit.plot_curve_with_confidence_interval-807"><span class="linenos">807</span></a><span class="sd">        -------</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-808"><a href="#CurveParamFit.plot_curve_with_confidence_interval-808"><span class="linenos">808</span></a><span class="sd">            ax : plt.Axes</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-809"><a href="#CurveParamFit.plot_curve_with_confidence_interval-809"><span class="linenos">809</span></a><span class="sd">                The axes used for plotting.        </span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-810"><a href="#CurveParamFit.plot_curve_with_confidence_interval-810"><span class="linenos">810</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-811"><a href="#CurveParamFit.plot_curve_with_confidence_interval-811"><span class="linenos">811</span></a>        <span class="c1"># Plot the data</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-812"><a href="#CurveParamFit.plot_curve_with_confidence_interval-812"><span class="linenos">812</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-813"><a href="#CurveParamFit.plot_curve_with_confidence_interval-813"><span class="linenos">813</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-814"><a href="#CurveParamFit.plot_curve_with_confidence_interval-814"><span class="linenos">814</span></a>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-815"><a href="#CurveParamFit.plot_curve_with_confidence_interval-815"><span class="linenos">815</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-816"><a href="#CurveParamFit.plot_curve_with_confidence_interval-816"><span class="linenos">816</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-817"><a href="#CurveParamFit.plot_curve_with_confidence_interval-817"><span class="linenos">817</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-818"><a href="#CurveParamFit.plot_curve_with_confidence_interval-818"><span class="linenos">818</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-819"><a href="#CurveParamFit.plot_curve_with_confidence_interval-819"><span class="linenos">819</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-820"><a href="#CurveParamFit.plot_curve_with_confidence_interval-820"><span class="linenos">820</span></a>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-821"><a href="#CurveParamFit.plot_curve_with_confidence_interval-821"><span class="linenos">821</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">yqlb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">yqub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-822"><a href="#CurveParamFit.plot_curve_with_confidence_interval-822"><span class="linenos">822</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-823"><a href="#CurveParamFit.plot_curve_with_confidence_interval-823"><span class="linenos">823</span></a>                            <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Q</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">% CI&#39;</span><span class="p">)</span>            
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-824"><a href="#CurveParamFit.plot_curve_with_confidence_interval-824"><span class="linenos">824</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="CurveParamFit.plot_curve_with_confidence_interval-825"><a href="#CurveParamFit.plot_curve_with_confidence_interval-825"><span class="linenos">825</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Plots the fitted curve along with the confidence interval.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>ypred : pd.Series
    The predicted dependent variable.
yqlb : pd.Series, optional
    The lower bound of the confidence interval. Default is None.
yqub : pd.Series, optional
    The upper bound of the confidence interval. Default is None.
ax : plt.Axes, optional
    The axes to use for plotting. Default is None.
title : str, optional
    The title of the plot. Default is ''.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>ax : plt.Axes
    The axes used for plotting.
</code></pre>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>