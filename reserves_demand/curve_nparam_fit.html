<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>reserves_demand.curve_nparam_fit API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../reserves_demand.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;reserves_demand</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#CurveNonParamFit">CurveNonParamFit</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CurveNonParamFit.__init__">CurveNonParamFit</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveNonParamFit.best_gam">best_gam</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveNonParamFit.best_rf">best_rf</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveNonParamFit.best_model">best_model</a>
                        </li>
                        <li>
                                <a class="variable" href="#CurveNonParamFit.best_model_type">best_model_type</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.tune_gam">tune_gam</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.tune_rf">tune_rf</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.compare_models">compare_models</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.predict_best">predict_best</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.plot_x_y">plot_x_y</a>
                        </li>
                        <li>
                                <a class="function" href="#CurveNonParamFit.plot_best">plot_best</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GAMRegressor">GAMRegressor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GAMRegressor.__init__">GAMRegressor</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.predict">predict</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.get_params">get_params</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.get_pygam_model">get_pygam_model</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.set_params">set_params</a>
                        </li>
                        <li>
                                <a class="function" href="#GAMRegressor.set_score_request">set_score_request</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../reserves_demand.html">reserves_demand</a><wbr>.curve_nparam_fit    </h1>

                
                        <input id="mod-curve_nparam_fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-curve_nparam_fit-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">pygam</span> <span class="kn">import</span> <span class="n">LinearGAM</span><span class="p">,</span> <span class="n">LogisticGAM</span><span class="p">,</span> <span class="n">GammaGAM</span><span class="p">,</span> <span class="n">s</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">mean_squared_error</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">reserves_demand.utils</span> <span class="kn">import</span> <span class="n">evaluate_metrics</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>    
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>   
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span> 
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">CurveNonParamFit</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    This class is used to fit a non-parametric curve to a dataset using two different models:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    - Generalized Additive Models (GAM) with splines</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    - Random Forest</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    </span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    In a cross-validation setting, the class compares the performance of the two models based on a specified metric.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        - The GAM models test different model types for curve fitting (linear, logistic, gamma) and different number of splines, </span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    then picks the best model.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        - The Random Forest model tests different hyperparameters (n_estimators, max_depth, min_samples_split, min_samples_leaf), </span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    then picks the best model.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    Finally, the class compares the best GAM model with the best Random Forest model based on the specified metric, and chooses the best model.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    Forecasting can be done either using the best model, or the best set-up for the GAM and Random Forest model families. </span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    The class provides a method to plot the best model&#39;s predictions.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    Parameters:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    -----------</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    - data (pd.DataFrame): The dataset to fit the curve to.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    - dep_var (str): The dependent variable to predict.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    - main_indep_var (str): The main independent variable to use for curve fitting.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    - dep_var_name (str): The name of the dependent variable.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    - main_indep_var_name (str): The name of the main independent variable.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    - nFolds (int): The number of folds to use in cross-validation.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    Methods:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    --------</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    - tune_gam(param_grid=None, verbose=False): Tune the GAM model using GridSearchCV.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    - tune_rf(param_grid=None, verbose=False): Tune the Random Forest model using GridSearchCV.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    - compare_models(on=&#39;RMSE&#39;, verbose=True, plot=True): Compare the performance of GAM and Random Forest models based on a specified metric.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    - predict_best(model, X=None): Predict the best model&#39;s output.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    - plot_x_y(title=&#39;&#39;): Plot the dependent variable y against all the independent variables x.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    - plot_best(title=&#39;Best Model Predictions&#39;): Plot the best model&#39;s predictions for both the Random Forest and GAM models families.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    Attributes:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    -----------</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    - best_gam: The best GAM model found.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    - best_rf: The best Random Forest model found.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    - best_model: The best model found based on the specified metric.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    - best_model_type: The best model type found based on the specified metric.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    Raises:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    -------</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    - AssertionError: If the data is not a DataFrame, or if the dependent or independent variables are not found in the dataset.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>                 <span class="n">nFolds</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>                 <span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="c1"># Split data</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="kc">None</span> 
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="nf">tune_gam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        A function to tune the GAM model using GridSearchCV.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        Parameters:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        -----------</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different model types,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">                number of splines, and regularization parameters.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        Returns:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        --------</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">            opt_param: dict</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">                The performance metrics on the validation set.         </span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="c1"># Define parameter grid, including model_type to test different GAMs</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;logistic&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">],</span> 
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="s1">&#39;n_splines&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                <span class="s1">&#39;lam&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="p">}</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="c1"># Define a scorer, e.g., MSE for regression problems</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">mse_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="c1"># Initialize the GAMRegressor</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="n">gam_regressor</span> <span class="o">=</span> <span class="n">GAMRegressor</span><span class="p">()</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="c1"># Setup GridSearchCV</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">gam_regressor</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="n">mse_scorer</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">tune_rf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        A function to tune the Random Forest model using GridSearchCV.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        Parameters:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        -----------</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different n_estimators,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">                max_depth, min_samples_split, and min_samples_leaf.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        --------</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            opt_param: dict</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">                The performance metrics on the validation set.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># Define the parameter grid for Random Forest</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>                <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="p">}</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="c1"># Initialize GridSearchCV</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> 
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> 
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                                   <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="c1"># Fit and find best estimator</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">compare_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        A function to compare the performance of GAM and Random Forest models based on a specified metric.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Parameters:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        -----------</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">            on: str, default=&#39;RMSE&#39;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">                The metric to compare the models on. Options: &#39;RMSE&#39;, &#39;MAE&#39;, &#39;R2&#39;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            verbose: bool, default=True</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">                If True, prints the best model based on the specified metric and the comparison results.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            plot: bool, default=True</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">                If True, plots a comparison of the specified metric for different models.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        Returns:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        --------</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            best_model_type: str</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">                The best model based on the specified metric.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            comparison_result: pd.DataFrame</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">                A DataFrame containing the comparison results of the two models based on the specified metric.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">model_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> model&quot;</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="c1"># Perform cross-validation and gather metrics. </span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_gam</span><span class="p">()</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_rf</span><span class="p">()</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                <span class="s1">&#39;Model Type&#39;</span><span class="p">:</span> <span class="n">model_type</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="p">}</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">opt_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="c1"># Convert results to DataFrame for easier handling</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="n">comparison_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="c1"># Identify the best model based on a specific validation metric</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">best_model_type</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Model Type&#39;</span><span class="p">]</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="c1"># set the best models information</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="n">best_model_type</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="k">elif</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>        
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best model based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_model_type</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="c1"># Plot comparison of the specified metric for different models            </span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">metric_comparison</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Model Type&#39;</span><span class="p">)[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">metric_comparison</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for Different Models&#39;</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">best_model_type</span><span class="p">,</span> <span class="n">comparison_result</span>     
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>    
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">predict_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        A function to predict the best model&#39;s output.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        Parameters:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        -----------</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            model: str</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">                The model to use for prediction. Options: &#39;GAM Splines&#39;, &#39;Random Forest&#39;, &#39;Best Model&#39;.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            X: pd.DataFrame, default=None</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">                The data to predict on. If None, the function will use the training data.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        Returns:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        --------</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">            prediction: pd.DataFrame</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">                A DataFrame containing the predictions, upper and lower bounds of the 90% confidence interval.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="k">assert</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">],</span> <span class="s2">&quot;model must be &#39;GAM Splines&#39;, &#39;Random Forest&#39;, or &#39;Best Model&#39;&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="c1"># normalize the data</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">:</span> 
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="n">gam_intervals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_pygam_model</span><span class="p">()</span><span class="o">.</span><span class="n">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="n">rf_preds_per_tree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">])</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">yqlb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">yqub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="n">prediction</span> 
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        Parameters:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        -----------</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            title: str, default=&#39;&#39;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">                The title of the plot.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        Returns:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        --------</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            None</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">plot_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Best Model Predictions&#39;</span><span class="p">):</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        A function to plot the best model&#39;s predictions for both the Random Forest and GAM models families.</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Parameters:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        -----------</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">            title: str, default=&#39;Best Model Predictions&#39;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">                The title of the plot.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Returns:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        --------</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            None</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                                      
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;90% CI&#39;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="k">class</span> <span class="nc">GAMRegressor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">):</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">    A wrapper class to define a Generalized Additive Model (GAM) regressor using pyGAM.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">    Parameters:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">    -----------</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">    - model_type: str, default=&#39;linear&#39;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        The type of model to use for curve fitting. Options: &#39;linear&#39;, &#39;logistic&#39;, &#39;gamma&#39;.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">    - n_splines: int, default=25</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        The number of splines to use in the model.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">    - lam: float, default=0.6</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        The regularization parameter to use in the model.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">    Methods:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">    --------</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    - fit(X, y): Fit the GAM model to the data.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">    - predict(X): Predict the output using the fitted model.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">    - get_params(): Get the parameters of the model.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">    - get_pygam_model(): Get the pyGAM model.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">    - set_params(**parameters): Set the parameters of the model.</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">    Raises:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">    -------</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">    - AssertionError: If the model type is not one of &#39;linear&#39;, &#39;logistic&#39;, or &#39;gamma&#39;.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span> <span class="o">=</span> <span class="n">n_splines</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        Fit the GAM model to the data.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">        Parameters:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        -----------</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">            X: np.array</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">                The independent variables.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">            y: np.array</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">                The dependent variable.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        Returns:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        --------</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">            self: GAMRegressor</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">                The fitted GAM model.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LinearGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;logistic&#39;</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LogisticGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">GammaGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="c1"># Add additional model types as needed</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        Predict the output using the fitted model.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Parameters:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        -----------</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">            X: np.array</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">                The independent variables.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        Returns:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">        --------</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">            ypred: np.array</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">                The predicted output.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        Get the parameters of the model.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span> <span class="s2">&quot;n_splines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">,</span> <span class="s2">&quot;lam&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">}</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">get_pygam_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        Get the pyGAM model.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Set the parameters of the model.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        
</span></pre></div>


            </section>
                <section id="CurveNonParamFit">
                            <input id="CurveNonParamFit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CurveNonParamFit</span>:

                <label class="view-source-button" for="CurveNonParamFit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit-23"><a href="#CurveNonParamFit-23"><span class="linenos"> 23</span></a><span class="k">class</span> <span class="nc">CurveNonParamFit</span><span class="p">:</span>
</span><span id="CurveNonParamFit-24"><a href="#CurveNonParamFit-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-25"><a href="#CurveNonParamFit-25"><span class="linenos"> 25</span></a><span class="sd">    This class is used to fit a non-parametric curve to a dataset using two different models:</span>
</span><span id="CurveNonParamFit-26"><a href="#CurveNonParamFit-26"><span class="linenos"> 26</span></a><span class="sd">    - Generalized Additive Models (GAM) with splines</span>
</span><span id="CurveNonParamFit-27"><a href="#CurveNonParamFit-27"><span class="linenos"> 27</span></a><span class="sd">    - Random Forest</span>
</span><span id="CurveNonParamFit-28"><a href="#CurveNonParamFit-28"><span class="linenos"> 28</span></a><span class="sd">    </span>
</span><span id="CurveNonParamFit-29"><a href="#CurveNonParamFit-29"><span class="linenos"> 29</span></a><span class="sd">    In a cross-validation setting, the class compares the performance of the two models based on a specified metric.</span>
</span><span id="CurveNonParamFit-30"><a href="#CurveNonParamFit-30"><span class="linenos"> 30</span></a><span class="sd">        - The GAM models test different model types for curve fitting (linear, logistic, gamma) and different number of splines, </span>
</span><span id="CurveNonParamFit-31"><a href="#CurveNonParamFit-31"><span class="linenos"> 31</span></a><span class="sd">    then picks the best model.</span>
</span><span id="CurveNonParamFit-32"><a href="#CurveNonParamFit-32"><span class="linenos"> 32</span></a><span class="sd">        - The Random Forest model tests different hyperparameters (n_estimators, max_depth, min_samples_split, min_samples_leaf), </span>
</span><span id="CurveNonParamFit-33"><a href="#CurveNonParamFit-33"><span class="linenos"> 33</span></a><span class="sd">    then picks the best model.</span>
</span><span id="CurveNonParamFit-34"><a href="#CurveNonParamFit-34"><span class="linenos"> 34</span></a>
</span><span id="CurveNonParamFit-35"><a href="#CurveNonParamFit-35"><span class="linenos"> 35</span></a><span class="sd">    Finally, the class compares the best GAM model with the best Random Forest model based on the specified metric, and chooses the best model.</span>
</span><span id="CurveNonParamFit-36"><a href="#CurveNonParamFit-36"><span class="linenos"> 36</span></a><span class="sd">    Forecasting can be done either using the best model, or the best set-up for the GAM and Random Forest model families. </span>
</span><span id="CurveNonParamFit-37"><a href="#CurveNonParamFit-37"><span class="linenos"> 37</span></a><span class="sd">    The class provides a method to plot the best model&#39;s predictions.</span>
</span><span id="CurveNonParamFit-38"><a href="#CurveNonParamFit-38"><span class="linenos"> 38</span></a>
</span><span id="CurveNonParamFit-39"><a href="#CurveNonParamFit-39"><span class="linenos"> 39</span></a><span class="sd">    Parameters:</span>
</span><span id="CurveNonParamFit-40"><a href="#CurveNonParamFit-40"><span class="linenos"> 40</span></a><span class="sd">    -----------</span>
</span><span id="CurveNonParamFit-41"><a href="#CurveNonParamFit-41"><span class="linenos"> 41</span></a><span class="sd">    - data (pd.DataFrame): The dataset to fit the curve to.</span>
</span><span id="CurveNonParamFit-42"><a href="#CurveNonParamFit-42"><span class="linenos"> 42</span></a><span class="sd">    - dep_var (str): The dependent variable to predict.</span>
</span><span id="CurveNonParamFit-43"><a href="#CurveNonParamFit-43"><span class="linenos"> 43</span></a><span class="sd">    - main_indep_var (str): The main independent variable to use for curve fitting.</span>
</span><span id="CurveNonParamFit-44"><a href="#CurveNonParamFit-44"><span class="linenos"> 44</span></a><span class="sd">    - dep_var_name (str): The name of the dependent variable.</span>
</span><span id="CurveNonParamFit-45"><a href="#CurveNonParamFit-45"><span class="linenos"> 45</span></a><span class="sd">    - main_indep_var_name (str): The name of the main independent variable.</span>
</span><span id="CurveNonParamFit-46"><a href="#CurveNonParamFit-46"><span class="linenos"> 46</span></a><span class="sd">    - nFolds (int): The number of folds to use in cross-validation.</span>
</span><span id="CurveNonParamFit-47"><a href="#CurveNonParamFit-47"><span class="linenos"> 47</span></a>
</span><span id="CurveNonParamFit-48"><a href="#CurveNonParamFit-48"><span class="linenos"> 48</span></a><span class="sd">    Methods:</span>
</span><span id="CurveNonParamFit-49"><a href="#CurveNonParamFit-49"><span class="linenos"> 49</span></a><span class="sd">    --------</span>
</span><span id="CurveNonParamFit-50"><a href="#CurveNonParamFit-50"><span class="linenos"> 50</span></a><span class="sd">    - tune_gam(param_grid=None, verbose=False): Tune the GAM model using GridSearchCV.</span>
</span><span id="CurveNonParamFit-51"><a href="#CurveNonParamFit-51"><span class="linenos"> 51</span></a><span class="sd">    - tune_rf(param_grid=None, verbose=False): Tune the Random Forest model using GridSearchCV.</span>
</span><span id="CurveNonParamFit-52"><a href="#CurveNonParamFit-52"><span class="linenos"> 52</span></a><span class="sd">    - compare_models(on=&#39;RMSE&#39;, verbose=True, plot=True): Compare the performance of GAM and Random Forest models based on a specified metric.</span>
</span><span id="CurveNonParamFit-53"><a href="#CurveNonParamFit-53"><span class="linenos"> 53</span></a><span class="sd">    - predict_best(model, X=None): Predict the best model&#39;s output.</span>
</span><span id="CurveNonParamFit-54"><a href="#CurveNonParamFit-54"><span class="linenos"> 54</span></a><span class="sd">    - plot_x_y(title=&#39;&#39;): Plot the dependent variable y against all the independent variables x.</span>
</span><span id="CurveNonParamFit-55"><a href="#CurveNonParamFit-55"><span class="linenos"> 55</span></a><span class="sd">    - plot_best(title=&#39;Best Model Predictions&#39;): Plot the best model&#39;s predictions for both the Random Forest and GAM models families.</span>
</span><span id="CurveNonParamFit-56"><a href="#CurveNonParamFit-56"><span class="linenos"> 56</span></a>
</span><span id="CurveNonParamFit-57"><a href="#CurveNonParamFit-57"><span class="linenos"> 57</span></a><span class="sd">    Attributes:</span>
</span><span id="CurveNonParamFit-58"><a href="#CurveNonParamFit-58"><span class="linenos"> 58</span></a><span class="sd">    -----------</span>
</span><span id="CurveNonParamFit-59"><a href="#CurveNonParamFit-59"><span class="linenos"> 59</span></a><span class="sd">    - best_gam: The best GAM model found.</span>
</span><span id="CurveNonParamFit-60"><a href="#CurveNonParamFit-60"><span class="linenos"> 60</span></a><span class="sd">    - best_rf: The best Random Forest model found.</span>
</span><span id="CurveNonParamFit-61"><a href="#CurveNonParamFit-61"><span class="linenos"> 61</span></a><span class="sd">    - best_model: The best model found based on the specified metric.</span>
</span><span id="CurveNonParamFit-62"><a href="#CurveNonParamFit-62"><span class="linenos"> 62</span></a><span class="sd">    - best_model_type: The best model type found based on the specified metric.</span>
</span><span id="CurveNonParamFit-63"><a href="#CurveNonParamFit-63"><span class="linenos"> 63</span></a>
</span><span id="CurveNonParamFit-64"><a href="#CurveNonParamFit-64"><span class="linenos"> 64</span></a><span class="sd">    Raises:</span>
</span><span id="CurveNonParamFit-65"><a href="#CurveNonParamFit-65"><span class="linenos"> 65</span></a><span class="sd">    -------</span>
</span><span id="CurveNonParamFit-66"><a href="#CurveNonParamFit-66"><span class="linenos"> 66</span></a><span class="sd">    - AssertionError: If the data is not a DataFrame, or if the dependent or independent variables are not found in the dataset.</span>
</span><span id="CurveNonParamFit-67"><a href="#CurveNonParamFit-67"><span class="linenos"> 67</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-68"><a href="#CurveNonParamFit-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="CurveNonParamFit-69"><a href="#CurveNonParamFit-69"><span class="linenos"> 69</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="CurveNonParamFit-70"><a href="#CurveNonParamFit-70"><span class="linenos"> 70</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CurveNonParamFit-71"><a href="#CurveNonParamFit-71"><span class="linenos"> 71</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="CurveNonParamFit-72"><a href="#CurveNonParamFit-72"><span class="linenos"> 72</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="CurveNonParamFit-73"><a href="#CurveNonParamFit-73"><span class="linenos"> 73</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveNonParamFit-74"><a href="#CurveNonParamFit-74"><span class="linenos"> 74</span></a>                 <span class="n">nFolds</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="CurveNonParamFit-75"><a href="#CurveNonParamFit-75"><span class="linenos"> 75</span></a>                 <span class="p">):</span>
</span><span id="CurveNonParamFit-76"><a href="#CurveNonParamFit-76"><span class="linenos"> 76</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="CurveNonParamFit-77"><a href="#CurveNonParamFit-77"><span class="linenos"> 77</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveNonParamFit-78"><a href="#CurveNonParamFit-78"><span class="linenos"> 78</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveNonParamFit-79"><a href="#CurveNonParamFit-79"><span class="linenos"> 79</span></a>
</span><span id="CurveNonParamFit-80"><a href="#CurveNonParamFit-80"><span class="linenos"> 80</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="CurveNonParamFit-81"><a href="#CurveNonParamFit-81"><span class="linenos"> 81</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="CurveNonParamFit-82"><a href="#CurveNonParamFit-82"><span class="linenos"> 82</span></a>        
</span><span id="CurveNonParamFit-83"><a href="#CurveNonParamFit-83"><span class="linenos"> 83</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="CurveNonParamFit-84"><a href="#CurveNonParamFit-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveNonParamFit-85"><a href="#CurveNonParamFit-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="CurveNonParamFit-86"><a href="#CurveNonParamFit-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="CurveNonParamFit-87"><a href="#CurveNonParamFit-87"><span class="linenos"> 87</span></a>        
</span><span id="CurveNonParamFit-88"><a href="#CurveNonParamFit-88"><span class="linenos"> 88</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="CurveNonParamFit-89"><a href="#CurveNonParamFit-89"><span class="linenos"> 89</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="CurveNonParamFit-90"><a href="#CurveNonParamFit-90"><span class="linenos"> 90</span></a>        
</span><span id="CurveNonParamFit-91"><a href="#CurveNonParamFit-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="CurveNonParamFit-92"><a href="#CurveNonParamFit-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="CurveNonParamFit-93"><a href="#CurveNonParamFit-93"><span class="linenos"> 93</span></a>        
</span><span id="CurveNonParamFit-94"><a href="#CurveNonParamFit-94"><span class="linenos"> 94</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="CurveNonParamFit-95"><a href="#CurveNonParamFit-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CurveNonParamFit-96"><a href="#CurveNonParamFit-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CurveNonParamFit-97"><a href="#CurveNonParamFit-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveNonParamFit-98"><a href="#CurveNonParamFit-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveNonParamFit-99"><a href="#CurveNonParamFit-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="CurveNonParamFit-100"><a href="#CurveNonParamFit-100"><span class="linenos">100</span></a>        
</span><span id="CurveNonParamFit-101"><a href="#CurveNonParamFit-101"><span class="linenos">101</span></a>        <span class="c1"># Split data</span>
</span><span id="CurveNonParamFit-102"><a href="#CurveNonParamFit-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span><span id="CurveNonParamFit-103"><a href="#CurveNonParamFit-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="CurveNonParamFit-104"><a href="#CurveNonParamFit-104"><span class="linenos">104</span></a>
</span><span id="CurveNonParamFit-105"><a href="#CurveNonParamFit-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit-106"><a href="#CurveNonParamFit-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit-107"><a href="#CurveNonParamFit-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit-108"><a href="#CurveNonParamFit-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit-109"><a href="#CurveNonParamFit-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="kc">None</span> 
</span><span id="CurveNonParamFit-110"><a href="#CurveNonParamFit-110"><span class="linenos">110</span></a>    
</span><span id="CurveNonParamFit-111"><a href="#CurveNonParamFit-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">tune_gam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CurveNonParamFit-112"><a href="#CurveNonParamFit-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-113"><a href="#CurveNonParamFit-113"><span class="linenos">113</span></a><span class="sd">        A function to tune the GAM model using GridSearchCV.</span>
</span><span id="CurveNonParamFit-114"><a href="#CurveNonParamFit-114"><span class="linenos">114</span></a><span class="sd">        </span>
</span><span id="CurveNonParamFit-115"><a href="#CurveNonParamFit-115"><span class="linenos">115</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-116"><a href="#CurveNonParamFit-116"><span class="linenos">116</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-117"><a href="#CurveNonParamFit-117"><span class="linenos">117</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="CurveNonParamFit-118"><a href="#CurveNonParamFit-118"><span class="linenos">118</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different model types,</span>
</span><span id="CurveNonParamFit-119"><a href="#CurveNonParamFit-119"><span class="linenos">119</span></a><span class="sd">                number of splines, and regularization parameters.</span>
</span><span id="CurveNonParamFit-120"><a href="#CurveNonParamFit-120"><span class="linenos">120</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="CurveNonParamFit-121"><a href="#CurveNonParamFit-121"><span class="linenos">121</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="CurveNonParamFit-122"><a href="#CurveNonParamFit-122"><span class="linenos">122</span></a>
</span><span id="CurveNonParamFit-123"><a href="#CurveNonParamFit-123"><span class="linenos">123</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-124"><a href="#CurveNonParamFit-124"><span class="linenos">124</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-125"><a href="#CurveNonParamFit-125"><span class="linenos">125</span></a><span class="sd">            opt_param: dict</span>
</span><span id="CurveNonParamFit-126"><a href="#CurveNonParamFit-126"><span class="linenos">126</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="CurveNonParamFit-127"><a href="#CurveNonParamFit-127"><span class="linenos">127</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="CurveNonParamFit-128"><a href="#CurveNonParamFit-128"><span class="linenos">128</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="CurveNonParamFit-129"><a href="#CurveNonParamFit-129"><span class="linenos">129</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="CurveNonParamFit-130"><a href="#CurveNonParamFit-130"><span class="linenos">130</span></a><span class="sd">                The performance metrics on the validation set.         </span>
</span><span id="CurveNonParamFit-131"><a href="#CurveNonParamFit-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-132"><a href="#CurveNonParamFit-132"><span class="linenos">132</span></a>        <span class="c1"># Define parameter grid, including model_type to test different GAMs</span>
</span><span id="CurveNonParamFit-133"><a href="#CurveNonParamFit-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit-134"><a href="#CurveNonParamFit-134"><span class="linenos">134</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit-135"><a href="#CurveNonParamFit-135"><span class="linenos">135</span></a>                <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;logistic&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">],</span> 
</span><span id="CurveNonParamFit-136"><a href="#CurveNonParamFit-136"><span class="linenos">136</span></a>                <span class="s1">&#39;n_splines&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="CurveNonParamFit-137"><a href="#CurveNonParamFit-137"><span class="linenos">137</span></a>                <span class="s1">&#39;lam&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="CurveNonParamFit-138"><a href="#CurveNonParamFit-138"><span class="linenos">138</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit-139"><a href="#CurveNonParamFit-139"><span class="linenos">139</span></a>
</span><span id="CurveNonParamFit-140"><a href="#CurveNonParamFit-140"><span class="linenos">140</span></a>        <span class="c1"># Define a scorer, e.g., MSE for regression problems</span>
</span><span id="CurveNonParamFit-141"><a href="#CurveNonParamFit-141"><span class="linenos">141</span></a>        <span class="n">mse_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveNonParamFit-142"><a href="#CurveNonParamFit-142"><span class="linenos">142</span></a>
</span><span id="CurveNonParamFit-143"><a href="#CurveNonParamFit-143"><span class="linenos">143</span></a>        <span class="c1"># Initialize the GAMRegressor</span>
</span><span id="CurveNonParamFit-144"><a href="#CurveNonParamFit-144"><span class="linenos">144</span></a>        <span class="n">gam_regressor</span> <span class="o">=</span> <span class="n">GAMRegressor</span><span class="p">()</span>
</span><span id="CurveNonParamFit-145"><a href="#CurveNonParamFit-145"><span class="linenos">145</span></a>        
</span><span id="CurveNonParamFit-146"><a href="#CurveNonParamFit-146"><span class="linenos">146</span></a>        <span class="c1"># Setup GridSearchCV</span>
</span><span id="CurveNonParamFit-147"><a href="#CurveNonParamFit-147"><span class="linenos">147</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">gam_regressor</span><span class="p">,</span>
</span><span id="CurveNonParamFit-148"><a href="#CurveNonParamFit-148"><span class="linenos">148</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
</span><span id="CurveNonParamFit-149"><a href="#CurveNonParamFit-149"><span class="linenos">149</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="CurveNonParamFit-150"><a href="#CurveNonParamFit-150"><span class="linenos">150</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="n">mse_scorer</span><span class="p">)</span>
</span><span id="CurveNonParamFit-151"><a href="#CurveNonParamFit-151"><span class="linenos">151</span></a>
</span><span id="CurveNonParamFit-152"><a href="#CurveNonParamFit-152"><span class="linenos">152</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="CurveNonParamFit-153"><a href="#CurveNonParamFit-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="CurveNonParamFit-154"><a href="#CurveNonParamFit-154"><span class="linenos">154</span></a>        
</span><span id="CurveNonParamFit-155"><a href="#CurveNonParamFit-155"><span class="linenos">155</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="CurveNonParamFit-156"><a href="#CurveNonParamFit-156"><span class="linenos">156</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="CurveNonParamFit-157"><a href="#CurveNonParamFit-157"><span class="linenos">157</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="CurveNonParamFit-158"><a href="#CurveNonParamFit-158"><span class="linenos">158</span></a>
</span><span id="CurveNonParamFit-159"><a href="#CurveNonParamFit-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="CurveNonParamFit-160"><a href="#CurveNonParamFit-160"><span class="linenos">160</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="CurveNonParamFit-161"><a href="#CurveNonParamFit-161"><span class="linenos">161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="CurveNonParamFit-162"><a href="#CurveNonParamFit-162"><span class="linenos">162</span></a>        
</span><span id="CurveNonParamFit-163"><a href="#CurveNonParamFit-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span><span id="CurveNonParamFit-164"><a href="#CurveNonParamFit-164"><span class="linenos">164</span></a>
</span><span id="CurveNonParamFit-165"><a href="#CurveNonParamFit-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">tune_rf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CurveNonParamFit-166"><a href="#CurveNonParamFit-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-167"><a href="#CurveNonParamFit-167"><span class="linenos">167</span></a><span class="sd">        A function to tune the Random Forest model using GridSearchCV.</span>
</span><span id="CurveNonParamFit-168"><a href="#CurveNonParamFit-168"><span class="linenos">168</span></a>
</span><span id="CurveNonParamFit-169"><a href="#CurveNonParamFit-169"><span class="linenos">169</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-170"><a href="#CurveNonParamFit-170"><span class="linenos">170</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-171"><a href="#CurveNonParamFit-171"><span class="linenos">171</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="CurveNonParamFit-172"><a href="#CurveNonParamFit-172"><span class="linenos">172</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different n_estimators,</span>
</span><span id="CurveNonParamFit-173"><a href="#CurveNonParamFit-173"><span class="linenos">173</span></a><span class="sd">                max_depth, min_samples_split, and min_samples_leaf.</span>
</span><span id="CurveNonParamFit-174"><a href="#CurveNonParamFit-174"><span class="linenos">174</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="CurveNonParamFit-175"><a href="#CurveNonParamFit-175"><span class="linenos">175</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="CurveNonParamFit-176"><a href="#CurveNonParamFit-176"><span class="linenos">176</span></a>
</span><span id="CurveNonParamFit-177"><a href="#CurveNonParamFit-177"><span class="linenos">177</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-178"><a href="#CurveNonParamFit-178"><span class="linenos">178</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-179"><a href="#CurveNonParamFit-179"><span class="linenos">179</span></a><span class="sd">            opt_param: dict</span>
</span><span id="CurveNonParamFit-180"><a href="#CurveNonParamFit-180"><span class="linenos">180</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="CurveNonParamFit-181"><a href="#CurveNonParamFit-181"><span class="linenos">181</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="CurveNonParamFit-182"><a href="#CurveNonParamFit-182"><span class="linenos">182</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="CurveNonParamFit-183"><a href="#CurveNonParamFit-183"><span class="linenos">183</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="CurveNonParamFit-184"><a href="#CurveNonParamFit-184"><span class="linenos">184</span></a><span class="sd">                The performance metrics on the validation set.</span>
</span><span id="CurveNonParamFit-185"><a href="#CurveNonParamFit-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="CurveNonParamFit-186"><a href="#CurveNonParamFit-186"><span class="linenos">186</span></a>        <span class="c1"># Define the parameter grid for Random Forest</span>
</span><span id="CurveNonParamFit-187"><a href="#CurveNonParamFit-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit-188"><a href="#CurveNonParamFit-188"><span class="linenos">188</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit-189"><a href="#CurveNonParamFit-189"><span class="linenos">189</span></a>                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="CurveNonParamFit-190"><a href="#CurveNonParamFit-190"><span class="linenos">190</span></a>                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="CurveNonParamFit-191"><a href="#CurveNonParamFit-191"><span class="linenos">191</span></a>                <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="CurveNonParamFit-192"><a href="#CurveNonParamFit-192"><span class="linenos">192</span></a>                <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="CurveNonParamFit-193"><a href="#CurveNonParamFit-193"><span class="linenos">193</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit-194"><a href="#CurveNonParamFit-194"><span class="linenos">194</span></a>        
</span><span id="CurveNonParamFit-195"><a href="#CurveNonParamFit-195"><span class="linenos">195</span></a>        <span class="c1"># Initialize GridSearchCV</span>
</span><span id="CurveNonParamFit-196"><a href="#CurveNonParamFit-196"><span class="linenos">196</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> 
</span><span id="CurveNonParamFit-197"><a href="#CurveNonParamFit-197"><span class="linenos">197</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> 
</span><span id="CurveNonParamFit-198"><a href="#CurveNonParamFit-198"><span class="linenos">198</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="CurveNonParamFit-199"><a href="#CurveNonParamFit-199"><span class="linenos">199</span></a>                                   <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="CurveNonParamFit-200"><a href="#CurveNonParamFit-200"><span class="linenos">200</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-201"><a href="#CurveNonParamFit-201"><span class="linenos">201</span></a>        
</span><span id="CurveNonParamFit-202"><a href="#CurveNonParamFit-202"><span class="linenos">202</span></a>        <span class="c1"># Fit and find best estimator</span>
</span><span id="CurveNonParamFit-203"><a href="#CurveNonParamFit-203"><span class="linenos">203</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="CurveNonParamFit-204"><a href="#CurveNonParamFit-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="CurveNonParamFit-205"><a href="#CurveNonParamFit-205"><span class="linenos">205</span></a>        
</span><span id="CurveNonParamFit-206"><a href="#CurveNonParamFit-206"><span class="linenos">206</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="CurveNonParamFit-207"><a href="#CurveNonParamFit-207"><span class="linenos">207</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="CurveNonParamFit-208"><a href="#CurveNonParamFit-208"><span class="linenos">208</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="CurveNonParamFit-209"><a href="#CurveNonParamFit-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="CurveNonParamFit-210"><a href="#CurveNonParamFit-210"><span class="linenos">210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="CurveNonParamFit-211"><a href="#CurveNonParamFit-211"><span class="linenos">211</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="CurveNonParamFit-212"><a href="#CurveNonParamFit-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span><span id="CurveNonParamFit-213"><a href="#CurveNonParamFit-213"><span class="linenos">213</span></a>
</span><span id="CurveNonParamFit-214"><a href="#CurveNonParamFit-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">compare_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveNonParamFit-215"><a href="#CurveNonParamFit-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-216"><a href="#CurveNonParamFit-216"><span class="linenos">216</span></a><span class="sd">        A function to compare the performance of GAM and Random Forest models based on a specified metric.</span>
</span><span id="CurveNonParamFit-217"><a href="#CurveNonParamFit-217"><span class="linenos">217</span></a>
</span><span id="CurveNonParamFit-218"><a href="#CurveNonParamFit-218"><span class="linenos">218</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-219"><a href="#CurveNonParamFit-219"><span class="linenos">219</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-220"><a href="#CurveNonParamFit-220"><span class="linenos">220</span></a><span class="sd">            on: str, default=&#39;RMSE&#39;</span>
</span><span id="CurveNonParamFit-221"><a href="#CurveNonParamFit-221"><span class="linenos">221</span></a><span class="sd">                The metric to compare the models on. Options: &#39;RMSE&#39;, &#39;MAE&#39;, &#39;R2&#39;</span>
</span><span id="CurveNonParamFit-222"><a href="#CurveNonParamFit-222"><span class="linenos">222</span></a><span class="sd">            verbose: bool, default=True</span>
</span><span id="CurveNonParamFit-223"><a href="#CurveNonParamFit-223"><span class="linenos">223</span></a><span class="sd">                If True, prints the best model based on the specified metric and the comparison results.</span>
</span><span id="CurveNonParamFit-224"><a href="#CurveNonParamFit-224"><span class="linenos">224</span></a><span class="sd">            plot: bool, default=True</span>
</span><span id="CurveNonParamFit-225"><a href="#CurveNonParamFit-225"><span class="linenos">225</span></a><span class="sd">                If True, plots a comparison of the specified metric for different models.</span>
</span><span id="CurveNonParamFit-226"><a href="#CurveNonParamFit-226"><span class="linenos">226</span></a>
</span><span id="CurveNonParamFit-227"><a href="#CurveNonParamFit-227"><span class="linenos">227</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-228"><a href="#CurveNonParamFit-228"><span class="linenos">228</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-229"><a href="#CurveNonParamFit-229"><span class="linenos">229</span></a><span class="sd">            best_model_type: str</span>
</span><span id="CurveNonParamFit-230"><a href="#CurveNonParamFit-230"><span class="linenos">230</span></a><span class="sd">                The best model based on the specified metric.</span>
</span><span id="CurveNonParamFit-231"><a href="#CurveNonParamFit-231"><span class="linenos">231</span></a><span class="sd">            comparison_result: pd.DataFrame</span>
</span><span id="CurveNonParamFit-232"><a href="#CurveNonParamFit-232"><span class="linenos">232</span></a><span class="sd">                A DataFrame containing the comparison results of the two models based on the specified metric.</span>
</span><span id="CurveNonParamFit-233"><a href="#CurveNonParamFit-233"><span class="linenos">233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-234"><a href="#CurveNonParamFit-234"><span class="linenos">234</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveNonParamFit-235"><a href="#CurveNonParamFit-235"><span class="linenos">235</span></a>        <span class="n">model_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit-236"><a href="#CurveNonParamFit-236"><span class="linenos">236</span></a>
</span><span id="CurveNonParamFit-237"><a href="#CurveNonParamFit-237"><span class="linenos">237</span></a>        <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">:</span>
</span><span id="CurveNonParamFit-238"><a href="#CurveNonParamFit-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit-239"><a href="#CurveNonParamFit-239"><span class="linenos">239</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit-240"><a href="#CurveNonParamFit-240"><span class="linenos">240</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> model&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-241"><a href="#CurveNonParamFit-241"><span class="linenos">241</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit-242"><a href="#CurveNonParamFit-242"><span class="linenos">242</span></a>            
</span><span id="CurveNonParamFit-243"><a href="#CurveNonParamFit-243"><span class="linenos">243</span></a>            <span class="c1"># Perform cross-validation and gather metrics. </span>
</span><span id="CurveNonParamFit-244"><a href="#CurveNonParamFit-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-245"><a href="#CurveNonParamFit-245"><span class="linenos">245</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_gam</span><span class="p">()</span>
</span><span id="CurveNonParamFit-246"><a href="#CurveNonParamFit-246"><span class="linenos">246</span></a>            <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-247"><a href="#CurveNonParamFit-247"><span class="linenos">247</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_rf</span><span class="p">()</span>
</span><span id="CurveNonParamFit-248"><a href="#CurveNonParamFit-248"><span class="linenos">248</span></a>            
</span><span id="CurveNonParamFit-249"><a href="#CurveNonParamFit-249"><span class="linenos">249</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit-250"><a href="#CurveNonParamFit-250"><span class="linenos">250</span></a>                <span class="s1">&#39;Model Type&#39;</span><span class="p">:</span> <span class="n">model_type</span><span class="p">,</span>
</span><span id="CurveNonParamFit-251"><a href="#CurveNonParamFit-251"><span class="linenos">251</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="CurveNonParamFit-252"><a href="#CurveNonParamFit-252"><span class="linenos">252</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CurveNonParamFit-253"><a href="#CurveNonParamFit-253"><span class="linenos">253</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit-254"><a href="#CurveNonParamFit-254"><span class="linenos">254</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="CurveNonParamFit-255"><a href="#CurveNonParamFit-255"><span class="linenos">255</span></a>            
</span><span id="CurveNonParamFit-256"><a href="#CurveNonParamFit-256"><span class="linenos">256</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit-257"><a href="#CurveNonParamFit-257"><span class="linenos">257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">opt_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-258"><a href="#CurveNonParamFit-258"><span class="linenos">258</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-259"><a href="#CurveNonParamFit-259"><span class="linenos">259</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveNonParamFit-260"><a href="#CurveNonParamFit-260"><span class="linenos">260</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-261"><a href="#CurveNonParamFit-261"><span class="linenos">261</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="CurveNonParamFit-262"><a href="#CurveNonParamFit-262"><span class="linenos">262</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-263"><a href="#CurveNonParamFit-263"><span class="linenos">263</span></a>
</span><span id="CurveNonParamFit-264"><a href="#CurveNonParamFit-264"><span class="linenos">264</span></a>        <span class="c1"># Convert results to DataFrame for easier handling</span>
</span><span id="CurveNonParamFit-265"><a href="#CurveNonParamFit-265"><span class="linenos">265</span></a>        <span class="n">comparison_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  
</span><span id="CurveNonParamFit-266"><a href="#CurveNonParamFit-266"><span class="linenos">266</span></a>
</span><span id="CurveNonParamFit-267"><a href="#CurveNonParamFit-267"><span class="linenos">267</span></a>        <span class="c1"># Identify the best model based on a specific validation metric</span>
</span><span id="CurveNonParamFit-268"><a href="#CurveNonParamFit-268"><span class="linenos">268</span></a>        <span class="n">best_model_type</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Model Type&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit-269"><a href="#CurveNonParamFit-269"><span class="linenos">269</span></a>        
</span><span id="CurveNonParamFit-270"><a href="#CurveNonParamFit-270"><span class="linenos">270</span></a>        <span class="c1"># set the best models information</span>
</span><span id="CurveNonParamFit-271"><a href="#CurveNonParamFit-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="n">best_model_type</span>
</span><span id="CurveNonParamFit-272"><a href="#CurveNonParamFit-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-273"><a href="#CurveNonParamFit-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="CurveNonParamFit-274"><a href="#CurveNonParamFit-274"><span class="linenos">274</span></a>        <span class="k">elif</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-275"><a href="#CurveNonParamFit-275"><span class="linenos">275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>        
</span><span id="CurveNonParamFit-276"><a href="#CurveNonParamFit-276"><span class="linenos">276</span></a>
</span><span id="CurveNonParamFit-277"><a href="#CurveNonParamFit-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit-278"><a href="#CurveNonParamFit-278"><span class="linenos">278</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit-279"><a href="#CurveNonParamFit-279"><span class="linenos">279</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best model based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_model_type</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-280"><a href="#CurveNonParamFit-280"><span class="linenos">280</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit-281"><a href="#CurveNonParamFit-281"><span class="linenos">281</span></a>
</span><span id="CurveNonParamFit-282"><a href="#CurveNonParamFit-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveNonParamFit-283"><a href="#CurveNonParamFit-283"><span class="linenos">283</span></a>            <span class="c1"># Plot comparison of the specified metric for different models            </span>
</span><span id="CurveNonParamFit-284"><a href="#CurveNonParamFit-284"><span class="linenos">284</span></a>            <span class="n">metric_comparison</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Model Type&#39;</span><span class="p">)[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span>
</span><span id="CurveNonParamFit-285"><a href="#CurveNonParamFit-285"><span class="linenos">285</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit-286"><a href="#CurveNonParamFit-286"><span class="linenos">286</span></a>            <span class="n">metric_comparison</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveNonParamFit-287"><a href="#CurveNonParamFit-287"><span class="linenos">287</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="CurveNonParamFit-288"><a href="#CurveNonParamFit-288"><span class="linenos">288</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for Different Models&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-289"><a href="#CurveNonParamFit-289"><span class="linenos">289</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveNonParamFit-290"><a href="#CurveNonParamFit-290"><span class="linenos">290</span></a>
</span><span id="CurveNonParamFit-291"><a href="#CurveNonParamFit-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">best_model_type</span><span class="p">,</span> <span class="n">comparison_result</span>     
</span><span id="CurveNonParamFit-292"><a href="#CurveNonParamFit-292"><span class="linenos">292</span></a>    
</span><span id="CurveNonParamFit-293"><a href="#CurveNonParamFit-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">predict_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CurveNonParamFit-294"><a href="#CurveNonParamFit-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-295"><a href="#CurveNonParamFit-295"><span class="linenos">295</span></a><span class="sd">        A function to predict the best model&#39;s output.</span>
</span><span id="CurveNonParamFit-296"><a href="#CurveNonParamFit-296"><span class="linenos">296</span></a>
</span><span id="CurveNonParamFit-297"><a href="#CurveNonParamFit-297"><span class="linenos">297</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-298"><a href="#CurveNonParamFit-298"><span class="linenos">298</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-299"><a href="#CurveNonParamFit-299"><span class="linenos">299</span></a><span class="sd">            model: str</span>
</span><span id="CurveNonParamFit-300"><a href="#CurveNonParamFit-300"><span class="linenos">300</span></a><span class="sd">                The model to use for prediction. Options: &#39;GAM Splines&#39;, &#39;Random Forest&#39;, &#39;Best Model&#39;.</span>
</span><span id="CurveNonParamFit-301"><a href="#CurveNonParamFit-301"><span class="linenos">301</span></a><span class="sd">            X: pd.DataFrame, default=None</span>
</span><span id="CurveNonParamFit-302"><a href="#CurveNonParamFit-302"><span class="linenos">302</span></a><span class="sd">                The data to predict on. If None, the function will use the training data.</span>
</span><span id="CurveNonParamFit-303"><a href="#CurveNonParamFit-303"><span class="linenos">303</span></a>
</span><span id="CurveNonParamFit-304"><a href="#CurveNonParamFit-304"><span class="linenos">304</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-305"><a href="#CurveNonParamFit-305"><span class="linenos">305</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-306"><a href="#CurveNonParamFit-306"><span class="linenos">306</span></a><span class="sd">            prediction: pd.DataFrame</span>
</span><span id="CurveNonParamFit-307"><a href="#CurveNonParamFit-307"><span class="linenos">307</span></a><span class="sd">                A DataFrame containing the predictions, upper and lower bounds of the 90% confidence interval.</span>
</span><span id="CurveNonParamFit-308"><a href="#CurveNonParamFit-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-309"><a href="#CurveNonParamFit-309"><span class="linenos">309</span></a>        <span class="k">assert</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">],</span> <span class="s2">&quot;model must be &#39;GAM Splines&#39;, &#39;Random Forest&#39;, or &#39;Best Model&#39;&quot;</span>
</span><span id="CurveNonParamFit-310"><a href="#CurveNonParamFit-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit-311"><a href="#CurveNonParamFit-311"><span class="linenos">311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="CurveNonParamFit-312"><a href="#CurveNonParamFit-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit-313"><a href="#CurveNonParamFit-313"><span class="linenos">313</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CurveNonParamFit-314"><a href="#CurveNonParamFit-314"><span class="linenos">314</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveNonParamFit-315"><a href="#CurveNonParamFit-315"><span class="linenos">315</span></a>            <span class="c1"># normalize the data</span>
</span><span id="CurveNonParamFit-316"><a href="#CurveNonParamFit-316"><span class="linenos">316</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveNonParamFit-317"><a href="#CurveNonParamFit-317"><span class="linenos">317</span></a>        
</span><span id="CurveNonParamFit-318"><a href="#CurveNonParamFit-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">:</span> 
</span><span id="CurveNonParamFit-319"><a href="#CurveNonParamFit-319"><span class="linenos">319</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span>
</span><span id="CurveNonParamFit-320"><a href="#CurveNonParamFit-320"><span class="linenos">320</span></a>
</span><span id="CurveNonParamFit-321"><a href="#CurveNonParamFit-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-322"><a href="#CurveNonParamFit-322"><span class="linenos">322</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="CurveNonParamFit-323"><a href="#CurveNonParamFit-323"><span class="linenos">323</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="CurveNonParamFit-324"><a href="#CurveNonParamFit-324"><span class="linenos">324</span></a>            <span class="n">gam_intervals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_pygam_model</span><span class="p">()</span><span class="o">.</span><span class="n">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveNonParamFit-325"><a href="#CurveNonParamFit-325"><span class="linenos">325</span></a>            <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="CurveNonParamFit-326"><a href="#CurveNonParamFit-326"><span class="linenos">326</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-327"><a href="#CurveNonParamFit-327"><span class="linenos">327</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>
</span><span id="CurveNonParamFit-328"><a href="#CurveNonParamFit-328"><span class="linenos">328</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="CurveNonParamFit-329"><a href="#CurveNonParamFit-329"><span class="linenos">329</span></a>            <span class="n">rf_preds_per_tree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">])</span>
</span><span id="CurveNonParamFit-330"><a href="#CurveNonParamFit-330"><span class="linenos">330</span></a>            <span class="n">yqlb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CurveNonParamFit-331"><a href="#CurveNonParamFit-331"><span class="linenos">331</span></a>            <span class="n">yqub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CurveNonParamFit-332"><a href="#CurveNonParamFit-332"><span class="linenos">332</span></a>        
</span><span id="CurveNonParamFit-333"><a href="#CurveNonParamFit-333"><span class="linenos">333</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveNonParamFit-334"><a href="#CurveNonParamFit-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">prediction</span> 
</span><span id="CurveNonParamFit-335"><a href="#CurveNonParamFit-335"><span class="linenos">335</span></a>
</span><span id="CurveNonParamFit-336"><a href="#CurveNonParamFit-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit-337"><a href="#CurveNonParamFit-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-338"><a href="#CurveNonParamFit-338"><span class="linenos">338</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="CurveNonParamFit-339"><a href="#CurveNonParamFit-339"><span class="linenos">339</span></a>
</span><span id="CurveNonParamFit-340"><a href="#CurveNonParamFit-340"><span class="linenos">340</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-341"><a href="#CurveNonParamFit-341"><span class="linenos">341</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-342"><a href="#CurveNonParamFit-342"><span class="linenos">342</span></a><span class="sd">            title: str, default=&#39;&#39;</span>
</span><span id="CurveNonParamFit-343"><a href="#CurveNonParamFit-343"><span class="linenos">343</span></a><span class="sd">                The title of the plot.</span>
</span><span id="CurveNonParamFit-344"><a href="#CurveNonParamFit-344"><span class="linenos">344</span></a>
</span><span id="CurveNonParamFit-345"><a href="#CurveNonParamFit-345"><span class="linenos">345</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-346"><a href="#CurveNonParamFit-346"><span class="linenos">346</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-347"><a href="#CurveNonParamFit-347"><span class="linenos">347</span></a><span class="sd">            None</span>
</span><span id="CurveNonParamFit-348"><a href="#CurveNonParamFit-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-349"><a href="#CurveNonParamFit-349"><span class="linenos">349</span></a>        
</span><span id="CurveNonParamFit-350"><a href="#CurveNonParamFit-350"><span class="linenos">350</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveNonParamFit-351"><a href="#CurveNonParamFit-351"><span class="linenos">351</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="CurveNonParamFit-352"><a href="#CurveNonParamFit-352"><span class="linenos">352</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveNonParamFit-353"><a href="#CurveNonParamFit-353"><span class="linenos">353</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit-354"><a href="#CurveNonParamFit-354"><span class="linenos">354</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="CurveNonParamFit-355"><a href="#CurveNonParamFit-355"><span class="linenos">355</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveNonParamFit-356"><a href="#CurveNonParamFit-356"><span class="linenos">356</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="CurveNonParamFit-357"><a href="#CurveNonParamFit-357"><span class="linenos">357</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="CurveNonParamFit-358"><a href="#CurveNonParamFit-358"><span class="linenos">358</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit-359"><a href="#CurveNonParamFit-359"><span class="linenos">359</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit-360"><a href="#CurveNonParamFit-360"><span class="linenos">360</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="CurveNonParamFit-361"><a href="#CurveNonParamFit-361"><span class="linenos">361</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="CurveNonParamFit-362"><a href="#CurveNonParamFit-362"><span class="linenos">362</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveNonParamFit-363"><a href="#CurveNonParamFit-363"><span class="linenos">363</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveNonParamFit-364"><a href="#CurveNonParamFit-364"><span class="linenos">364</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveNonParamFit-365"><a href="#CurveNonParamFit-365"><span class="linenos">365</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit-366"><a href="#CurveNonParamFit-366"><span class="linenos">366</span></a>    
</span><span id="CurveNonParamFit-367"><a href="#CurveNonParamFit-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">plot_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Best Model Predictions&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit-368"><a href="#CurveNonParamFit-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-369"><a href="#CurveNonParamFit-369"><span class="linenos">369</span></a><span class="sd">        A function to plot the best model&#39;s predictions for both the Random Forest and GAM models families.</span>
</span><span id="CurveNonParamFit-370"><a href="#CurveNonParamFit-370"><span class="linenos">370</span></a>
</span><span id="CurveNonParamFit-371"><a href="#CurveNonParamFit-371"><span class="linenos">371</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit-372"><a href="#CurveNonParamFit-372"><span class="linenos">372</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit-373"><a href="#CurveNonParamFit-373"><span class="linenos">373</span></a><span class="sd">            title: str, default=&#39;Best Model Predictions&#39;</span>
</span><span id="CurveNonParamFit-374"><a href="#CurveNonParamFit-374"><span class="linenos">374</span></a><span class="sd">                The title of the plot.</span>
</span><span id="CurveNonParamFit-375"><a href="#CurveNonParamFit-375"><span class="linenos">375</span></a>
</span><span id="CurveNonParamFit-376"><a href="#CurveNonParamFit-376"><span class="linenos">376</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit-377"><a href="#CurveNonParamFit-377"><span class="linenos">377</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit-378"><a href="#CurveNonParamFit-378"><span class="linenos">378</span></a><span class="sd">            None</span>
</span><span id="CurveNonParamFit-379"><a href="#CurveNonParamFit-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit-380"><a href="#CurveNonParamFit-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit-381"><a href="#CurveNonParamFit-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="CurveNonParamFit-382"><a href="#CurveNonParamFit-382"><span class="linenos">382</span></a>        
</span><span id="CurveNonParamFit-383"><a href="#CurveNonParamFit-383"><span class="linenos">383</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit-384"><a href="#CurveNonParamFit-384"><span class="linenos">384</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]):</span>
</span><span id="CurveNonParamFit-385"><a href="#CurveNonParamFit-385"><span class="linenos">385</span></a>                                      
</span><span id="CurveNonParamFit-386"><a href="#CurveNonParamFit-386"><span class="linenos">386</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="CurveNonParamFit-387"><a href="#CurveNonParamFit-387"><span class="linenos">387</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit-388"><a href="#CurveNonParamFit-388"><span class="linenos">388</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="CurveNonParamFit-389"><a href="#CurveNonParamFit-389"><span class="linenos">389</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-390"><a href="#CurveNonParamFit-390"><span class="linenos">390</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-391"><a href="#CurveNonParamFit-391"><span class="linenos">391</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;90% CI&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-392"><a href="#CurveNonParamFit-392"><span class="linenos">392</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit-393"><a href="#CurveNonParamFit-393"><span class="linenos">393</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit-394"><a href="#CurveNonParamFit-394"><span class="linenos">394</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit-395"><a href="#CurveNonParamFit-395"><span class="linenos">395</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveNonParamFit-396"><a href="#CurveNonParamFit-396"><span class="linenos">396</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveNonParamFit-397"><a href="#CurveNonParamFit-397"><span class="linenos">397</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveNonParamFit-398"><a href="#CurveNonParamFit-398"><span class="linenos">398</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>This class is used to fit a non-parametric curve to a dataset using two different models:</p>

<ul>
<li>Generalized Additive Models (GAM) with splines</li>
<li>Random Forest</li>
</ul>

<p>In a cross-validation setting, the class compares the performance of the two models based on a specified metric.
    - The GAM models test different model types for curve fitting (linear, logistic, gamma) and different number of splines, 
then picks the best model.
    - The Random Forest model tests different hyperparameters (n_estimators, max_depth, min_samples_split, min_samples_leaf), 
then picks the best model.</p>

<p>Finally, the class compares the best GAM model with the best Random Forest model based on the specified metric, and chooses the best model.
Forecasting can be done either using the best model, or the best set-up for the GAM and Random Forest model families. 
The class provides a method to plot the best model's predictions.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>data (pd.DataFrame): The dataset to fit the curve to.</li>
<li>dep_var (str): The dependent variable to predict.</li>
<li>main_indep_var (str): The main independent variable to use for curve fitting.</li>
<li>dep_var_name (str): The name of the dependent variable.</li>
<li>main_indep_var_name (str): The name of the main independent variable.</li>
<li>nFolds (int): The number of folds to use in cross-validation.</li>
</ul>

<h2 id="methods">Methods:</h2>

<ul>
<li>tune_gam(param_grid=None, verbose=False): Tune the GAM model using GridSearchCV.</li>
<li>tune_rf(param_grid=None, verbose=False): Tune the Random Forest model using GridSearchCV.</li>
<li>compare_models(on='RMSE', verbose=True, plot=True): Compare the performance of GAM and Random Forest models based on a specified metric.</li>
<li>predict_best(model, X=None): Predict the best model's output.</li>
<li>plot_x_y(title=''): Plot the dependent variable y against all the independent variables x.</li>
<li>plot_best(title='Best Model Predictions'): Plot the best model's predictions for both the Random Forest and GAM models families.</li>
</ul>

<h2 id="attributes">Attributes:</h2>

<ul>
<li>best_gam: The best GAM model found.</li>
<li>best_rf: The best Random Forest model found.</li>
<li>best_model: The best model found based on the specified metric.</li>
<li>best_model_type: The best model type found based on the specified metric.</li>
</ul>

<h2 id="raises">Raises:</h2>

<ul>
<li>AssertionError: If the data is not a DataFrame, or if the dependent or independent variables are not found in the dataset.</li>
</ul>
</div>


                            <div id="CurveNonParamFit.__init__" class="classattr">
                                        <input id="CurveNonParamFit.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CurveNonParamFit</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">main_indep_var</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nFolds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span></span>)</span>

                <label class="view-source-button" for="CurveNonParamFit.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.__init__-68"><a href="#CurveNonParamFit.__init__-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="CurveNonParamFit.__init__-69"><a href="#CurveNonParamFit.__init__-69"><span class="linenos"> 69</span></a>                 <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
</span><span id="CurveNonParamFit.__init__-70"><a href="#CurveNonParamFit.__init__-70"><span class="linenos"> 70</span></a>                 <span class="n">dep_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="CurveNonParamFit.__init__-71"><a href="#CurveNonParamFit.__init__-71"><span class="linenos"> 71</span></a>                 <span class="n">main_indep_var</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span>
</span><span id="CurveNonParamFit.__init__-72"><a href="#CurveNonParamFit.__init__-72"><span class="linenos"> 72</span></a>                 <span class="n">dep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 
</span><span id="CurveNonParamFit.__init__-73"><a href="#CurveNonParamFit.__init__-73"><span class="linenos"> 73</span></a>                 <span class="n">main_indep_var_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CurveNonParamFit.__init__-74"><a href="#CurveNonParamFit.__init__-74"><span class="linenos"> 74</span></a>                 <span class="n">nFolds</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="CurveNonParamFit.__init__-75"><a href="#CurveNonParamFit.__init__-75"><span class="linenos"> 75</span></a>                 <span class="p">):</span>
</span><span id="CurveNonParamFit.__init__-76"><a href="#CurveNonParamFit.__init__-76"><span class="linenos"> 76</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;data must be a DataFrame&quot;</span>
</span><span id="CurveNonParamFit.__init__-77"><a href="#CurveNonParamFit.__init__-77"><span class="linenos"> 77</span></a>        <span class="k">assert</span> <span class="n">dep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveNonParamFit.__init__-78"><a href="#CurveNonParamFit.__init__-78"><span class="linenos"> 78</span></a>        <span class="k">assert</span> <span class="n">main_indep_var</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_indep_var</span><span class="si">}</span><span class="s2"> not found in the dataset&quot;</span>
</span><span id="CurveNonParamFit.__init__-79"><a href="#CurveNonParamFit.__init__-79"><span class="linenos"> 79</span></a>
</span><span id="CurveNonParamFit.__init__-80"><a href="#CurveNonParamFit.__init__-80"><span class="linenos"> 80</span></a>        <span class="c1"># Preprocessing data</span>
</span><span id="CurveNonParamFit.__init__-81"><a href="#CurveNonParamFit.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">main_indep_var</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
</span><span id="CurveNonParamFit.__init__-82"><a href="#CurveNonParamFit.__init__-82"><span class="linenos"> 82</span></a>        
</span><span id="CurveNonParamFit.__init__-83"><a href="#CurveNonParamFit.__init__-83"><span class="linenos"> 83</span></a>        <span class="c1"># Prepare the y variable</span>
</span><span id="CurveNonParamFit.__init__-84"><a href="#CurveNonParamFit.__init__-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">dep_var</span><span class="p">]</span>
</span><span id="CurveNonParamFit.__init__-85"><a href="#CurveNonParamFit.__init__-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
</span><span id="CurveNonParamFit.__init__-86"><a href="#CurveNonParamFit.__init__-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span> <span class="o">=</span> <span class="n">dep_var_name</span> <span class="k">if</span> <span class="n">dep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dep_var</span>
</span><span id="CurveNonParamFit.__init__-87"><a href="#CurveNonParamFit.__init__-87"><span class="linenos"> 87</span></a>        
</span><span id="CurveNonParamFit.__init__-88"><a href="#CurveNonParamFit.__init__-88"><span class="linenos"> 88</span></a>        <span class="c1"># Prepare the x variables</span>
</span><span id="CurveNonParamFit.__init__-89"><a href="#CurveNonParamFit.__init__-89"><span class="linenos"> 89</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">dep_var</span><span class="p">])</span>
</span><span id="CurveNonParamFit.__init__-90"><a href="#CurveNonParamFit.__init__-90"><span class="linenos"> 90</span></a>        
</span><span id="CurveNonParamFit.__init__-91"><a href="#CurveNonParamFit.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span> <span class="o">=</span> <span class="n">main_indep_var</span>
</span><span id="CurveNonParamFit.__init__-92"><a href="#CurveNonParamFit.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span> <span class="o">=</span> <span class="n">main_indep_var_name</span> <span class="k">if</span> <span class="n">main_indep_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">main_indep_var</span>
</span><span id="CurveNonParamFit.__init__-93"><a href="#CurveNonParamFit.__init__-93"><span class="linenos"> 93</span></a>        
</span><span id="CurveNonParamFit.__init__-94"><a href="#CurveNonParamFit.__init__-94"><span class="linenos"> 94</span></a>        <span class="c1"># Normalize x to make the optimization easier</span>
</span><span id="CurveNonParamFit.__init__-95"><a href="#CurveNonParamFit.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="CurveNonParamFit.__init__-96"><a href="#CurveNonParamFit.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="CurveNonParamFit.__init__-97"><a href="#CurveNonParamFit.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="CurveNonParamFit.__init__-98"><a href="#CurveNonParamFit.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>  <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveNonParamFit.__init__-99"><a href="#CurveNonParamFit.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span> <span class="o">=</span> <span class="n">nFolds</span>
</span><span id="CurveNonParamFit.__init__-100"><a href="#CurveNonParamFit.__init__-100"><span class="linenos">100</span></a>        
</span><span id="CurveNonParamFit.__init__-101"><a href="#CurveNonParamFit.__init__-101"><span class="linenos">101</span></a>        <span class="c1"># Split data</span>
</span><span id="CurveNonParamFit.__init__-102"><a href="#CurveNonParamFit.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span><span id="CurveNonParamFit.__init__-103"><a href="#CurveNonParamFit.__init__-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="CurveNonParamFit.__init__-104"><a href="#CurveNonParamFit.__init__-104"><span class="linenos">104</span></a>
</span><span id="CurveNonParamFit.__init__-105"><a href="#CurveNonParamFit.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit.__init__-106"><a href="#CurveNonParamFit.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit.__init__-107"><a href="#CurveNonParamFit.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit.__init__-108"><a href="#CurveNonParamFit.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CurveNonParamFit.__init__-109"><a href="#CurveNonParamFit.__init__-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="kc">None</span> 
</span></pre></div>


    

                            </div>
                            <div id="CurveNonParamFit.best_gam" class="classattr">
                                <div class="attr variable">
            <span class="name">best_gam</span>

        
    </div>
    <a class="headerlink" href="#CurveNonParamFit.best_gam"></a>
    
    

                            </div>
                            <div id="CurveNonParamFit.best_rf" class="classattr">
                                <div class="attr variable">
            <span class="name">best_rf</span>

        
    </div>
    <a class="headerlink" href="#CurveNonParamFit.best_rf"></a>
    
    

                            </div>
                            <div id="CurveNonParamFit.best_model" class="classattr">
                                <div class="attr variable">
            <span class="name">best_model</span>

        
    </div>
    <a class="headerlink" href="#CurveNonParamFit.best_model"></a>
    
    

                            </div>
                            <div id="CurveNonParamFit.best_model_type" class="classattr">
                                <div class="attr variable">
            <span class="name">best_model_type</span>

        
    </div>
    <a class="headerlink" href="#CurveNonParamFit.best_model_type"></a>
    
    

                            </div>
                            <div id="CurveNonParamFit.tune_gam" class="classattr">
                                        <input id="CurveNonParamFit.tune_gam-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tune_gam</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.tune_gam-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.tune_gam"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.tune_gam-111"><a href="#CurveNonParamFit.tune_gam-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">tune_gam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CurveNonParamFit.tune_gam-112"><a href="#CurveNonParamFit.tune_gam-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.tune_gam-113"><a href="#CurveNonParamFit.tune_gam-113"><span class="linenos">113</span></a><span class="sd">        A function to tune the GAM model using GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_gam-114"><a href="#CurveNonParamFit.tune_gam-114"><span class="linenos">114</span></a><span class="sd">        </span>
</span><span id="CurveNonParamFit.tune_gam-115"><a href="#CurveNonParamFit.tune_gam-115"><span class="linenos">115</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.tune_gam-116"><a href="#CurveNonParamFit.tune_gam-116"><span class="linenos">116</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.tune_gam-117"><a href="#CurveNonParamFit.tune_gam-117"><span class="linenos">117</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="CurveNonParamFit.tune_gam-118"><a href="#CurveNonParamFit.tune_gam-118"><span class="linenos">118</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different model types,</span>
</span><span id="CurveNonParamFit.tune_gam-119"><a href="#CurveNonParamFit.tune_gam-119"><span class="linenos">119</span></a><span class="sd">                number of splines, and regularization parameters.</span>
</span><span id="CurveNonParamFit.tune_gam-120"><a href="#CurveNonParamFit.tune_gam-120"><span class="linenos">120</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="CurveNonParamFit.tune_gam-121"><a href="#CurveNonParamFit.tune_gam-121"><span class="linenos">121</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_gam-122"><a href="#CurveNonParamFit.tune_gam-122"><span class="linenos">122</span></a>
</span><span id="CurveNonParamFit.tune_gam-123"><a href="#CurveNonParamFit.tune_gam-123"><span class="linenos">123</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.tune_gam-124"><a href="#CurveNonParamFit.tune_gam-124"><span class="linenos">124</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.tune_gam-125"><a href="#CurveNonParamFit.tune_gam-125"><span class="linenos">125</span></a><span class="sd">            opt_param: dict</span>
</span><span id="CurveNonParamFit.tune_gam-126"><a href="#CurveNonParamFit.tune_gam-126"><span class="linenos">126</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_gam-127"><a href="#CurveNonParamFit.tune_gam-127"><span class="linenos">127</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="CurveNonParamFit.tune_gam-128"><a href="#CurveNonParamFit.tune_gam-128"><span class="linenos">128</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="CurveNonParamFit.tune_gam-129"><a href="#CurveNonParamFit.tune_gam-129"><span class="linenos">129</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="CurveNonParamFit.tune_gam-130"><a href="#CurveNonParamFit.tune_gam-130"><span class="linenos">130</span></a><span class="sd">                The performance metrics on the validation set.         </span>
</span><span id="CurveNonParamFit.tune_gam-131"><a href="#CurveNonParamFit.tune_gam-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.tune_gam-132"><a href="#CurveNonParamFit.tune_gam-132"><span class="linenos">132</span></a>        <span class="c1"># Define parameter grid, including model_type to test different GAMs</span>
</span><span id="CurveNonParamFit.tune_gam-133"><a href="#CurveNonParamFit.tune_gam-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit.tune_gam-134"><a href="#CurveNonParamFit.tune_gam-134"><span class="linenos">134</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit.tune_gam-135"><a href="#CurveNonParamFit.tune_gam-135"><span class="linenos">135</span></a>                <span class="s1">&#39;model_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;logistic&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">],</span> 
</span><span id="CurveNonParamFit.tune_gam-136"><a href="#CurveNonParamFit.tune_gam-136"><span class="linenos">136</span></a>                <span class="s1">&#39;n_splines&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="CurveNonParamFit.tune_gam-137"><a href="#CurveNonParamFit.tune_gam-137"><span class="linenos">137</span></a>                <span class="s1">&#39;lam&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="CurveNonParamFit.tune_gam-138"><a href="#CurveNonParamFit.tune_gam-138"><span class="linenos">138</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit.tune_gam-139"><a href="#CurveNonParamFit.tune_gam-139"><span class="linenos">139</span></a>
</span><span id="CurveNonParamFit.tune_gam-140"><a href="#CurveNonParamFit.tune_gam-140"><span class="linenos">140</span></a>        <span class="c1"># Define a scorer, e.g., MSE for regression problems</span>
</span><span id="CurveNonParamFit.tune_gam-141"><a href="#CurveNonParamFit.tune_gam-141"><span class="linenos">141</span></a>        <span class="n">mse_scorer</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_gam-142"><a href="#CurveNonParamFit.tune_gam-142"><span class="linenos">142</span></a>
</span><span id="CurveNonParamFit.tune_gam-143"><a href="#CurveNonParamFit.tune_gam-143"><span class="linenos">143</span></a>        <span class="c1"># Initialize the GAMRegressor</span>
</span><span id="CurveNonParamFit.tune_gam-144"><a href="#CurveNonParamFit.tune_gam-144"><span class="linenos">144</span></a>        <span class="n">gam_regressor</span> <span class="o">=</span> <span class="n">GAMRegressor</span><span class="p">()</span>
</span><span id="CurveNonParamFit.tune_gam-145"><a href="#CurveNonParamFit.tune_gam-145"><span class="linenos">145</span></a>        
</span><span id="CurveNonParamFit.tune_gam-146"><a href="#CurveNonParamFit.tune_gam-146"><span class="linenos">146</span></a>        <span class="c1"># Setup GridSearchCV</span>
</span><span id="CurveNonParamFit.tune_gam-147"><a href="#CurveNonParamFit.tune_gam-147"><span class="linenos">147</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">gam_regressor</span><span class="p">,</span>
</span><span id="CurveNonParamFit.tune_gam-148"><a href="#CurveNonParamFit.tune_gam-148"><span class="linenos">148</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
</span><span id="CurveNonParamFit.tune_gam-149"><a href="#CurveNonParamFit.tune_gam-149"><span class="linenos">149</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="CurveNonParamFit.tune_gam-150"><a href="#CurveNonParamFit.tune_gam-150"><span class="linenos">150</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="n">mse_scorer</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_gam-151"><a href="#CurveNonParamFit.tune_gam-151"><span class="linenos">151</span></a>
</span><span id="CurveNonParamFit.tune_gam-152"><a href="#CurveNonParamFit.tune_gam-152"><span class="linenos">152</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_gam-153"><a href="#CurveNonParamFit.tune_gam-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="CurveNonParamFit.tune_gam-154"><a href="#CurveNonParamFit.tune_gam-154"><span class="linenos">154</span></a>        
</span><span id="CurveNonParamFit.tune_gam-155"><a href="#CurveNonParamFit.tune_gam-155"><span class="linenos">155</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="CurveNonParamFit.tune_gam-156"><a href="#CurveNonParamFit.tune_gam-156"><span class="linenos">156</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="CurveNonParamFit.tune_gam-157"><a href="#CurveNonParamFit.tune_gam-157"><span class="linenos">157</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="CurveNonParamFit.tune_gam-158"><a href="#CurveNonParamFit.tune_gam-158"><span class="linenos">158</span></a>
</span><span id="CurveNonParamFit.tune_gam-159"><a href="#CurveNonParamFit.tune_gam-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="CurveNonParamFit.tune_gam-160"><a href="#CurveNonParamFit.tune_gam-160"><span class="linenos">160</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_gam-161"><a href="#CurveNonParamFit.tune_gam-161"><span class="linenos">161</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_gam-162"><a href="#CurveNonParamFit.tune_gam-162"><span class="linenos">162</span></a>        
</span><span id="CurveNonParamFit.tune_gam-163"><a href="#CurveNonParamFit.tune_gam-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span></pre></div>


            <div class="docstring"><p>A function to tune the GAM model using GridSearchCV.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>param_grid: dict, default=None
    A dictionary containing the hyperparameters to tune. If None, the function will test different model types,
    number of splines, and regularization parameters.
verbose: bool, default=False
    If True, prints the best parameters found and the best score from GridSearchCV.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>opt_param: dict
    The optimal parameters found by GridSearchCV.
train_metrics: dict
    The performance metrics on the training set.
val_metrics: dict
    The performance metrics on the validation set.
</code></pre>
</div>


                            </div>
                            <div id="CurveNonParamFit.tune_rf" class="classattr">
                                        <input id="CurveNonParamFit.tune_rf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tune_rf</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.tune_rf-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.tune_rf"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.tune_rf-165"><a href="#CurveNonParamFit.tune_rf-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">tune_rf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="CurveNonParamFit.tune_rf-166"><a href="#CurveNonParamFit.tune_rf-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.tune_rf-167"><a href="#CurveNonParamFit.tune_rf-167"><span class="linenos">167</span></a><span class="sd">        A function to tune the Random Forest model using GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_rf-168"><a href="#CurveNonParamFit.tune_rf-168"><span class="linenos">168</span></a>
</span><span id="CurveNonParamFit.tune_rf-169"><a href="#CurveNonParamFit.tune_rf-169"><span class="linenos">169</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.tune_rf-170"><a href="#CurveNonParamFit.tune_rf-170"><span class="linenos">170</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.tune_rf-171"><a href="#CurveNonParamFit.tune_rf-171"><span class="linenos">171</span></a><span class="sd">            param_grid: dict, default=None</span>
</span><span id="CurveNonParamFit.tune_rf-172"><a href="#CurveNonParamFit.tune_rf-172"><span class="linenos">172</span></a><span class="sd">                A dictionary containing the hyperparameters to tune. If None, the function will test different n_estimators,</span>
</span><span id="CurveNonParamFit.tune_rf-173"><a href="#CurveNonParamFit.tune_rf-173"><span class="linenos">173</span></a><span class="sd">                max_depth, min_samples_split, and min_samples_leaf.</span>
</span><span id="CurveNonParamFit.tune_rf-174"><a href="#CurveNonParamFit.tune_rf-174"><span class="linenos">174</span></a><span class="sd">            verbose: bool, default=False</span>
</span><span id="CurveNonParamFit.tune_rf-175"><a href="#CurveNonParamFit.tune_rf-175"><span class="linenos">175</span></a><span class="sd">                If True, prints the best parameters found and the best score from GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_rf-176"><a href="#CurveNonParamFit.tune_rf-176"><span class="linenos">176</span></a>
</span><span id="CurveNonParamFit.tune_rf-177"><a href="#CurveNonParamFit.tune_rf-177"><span class="linenos">177</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.tune_rf-178"><a href="#CurveNonParamFit.tune_rf-178"><span class="linenos">178</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.tune_rf-179"><a href="#CurveNonParamFit.tune_rf-179"><span class="linenos">179</span></a><span class="sd">            opt_param: dict</span>
</span><span id="CurveNonParamFit.tune_rf-180"><a href="#CurveNonParamFit.tune_rf-180"><span class="linenos">180</span></a><span class="sd">                The optimal parameters found by GridSearchCV.</span>
</span><span id="CurveNonParamFit.tune_rf-181"><a href="#CurveNonParamFit.tune_rf-181"><span class="linenos">181</span></a><span class="sd">            train_metrics: dict</span>
</span><span id="CurveNonParamFit.tune_rf-182"><a href="#CurveNonParamFit.tune_rf-182"><span class="linenos">182</span></a><span class="sd">                The performance metrics on the training set.</span>
</span><span id="CurveNonParamFit.tune_rf-183"><a href="#CurveNonParamFit.tune_rf-183"><span class="linenos">183</span></a><span class="sd">            val_metrics: dict</span>
</span><span id="CurveNonParamFit.tune_rf-184"><a href="#CurveNonParamFit.tune_rf-184"><span class="linenos">184</span></a><span class="sd">                The performance metrics on the validation set.</span>
</span><span id="CurveNonParamFit.tune_rf-185"><a href="#CurveNonParamFit.tune_rf-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="CurveNonParamFit.tune_rf-186"><a href="#CurveNonParamFit.tune_rf-186"><span class="linenos">186</span></a>        <span class="c1"># Define the parameter grid for Random Forest</span>
</span><span id="CurveNonParamFit.tune_rf-187"><a href="#CurveNonParamFit.tune_rf-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">param_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit.tune_rf-188"><a href="#CurveNonParamFit.tune_rf-188"><span class="linenos">188</span></a>            <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit.tune_rf-189"><a href="#CurveNonParamFit.tune_rf-189"><span class="linenos">189</span></a>                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
</span><span id="CurveNonParamFit.tune_rf-190"><a href="#CurveNonParamFit.tune_rf-190"><span class="linenos">190</span></a>                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
</span><span id="CurveNonParamFit.tune_rf-191"><a href="#CurveNonParamFit.tune_rf-191"><span class="linenos">191</span></a>                <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
</span><span id="CurveNonParamFit.tune_rf-192"><a href="#CurveNonParamFit.tune_rf-192"><span class="linenos">192</span></a>                <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="CurveNonParamFit.tune_rf-193"><a href="#CurveNonParamFit.tune_rf-193"><span class="linenos">193</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit.tune_rf-194"><a href="#CurveNonParamFit.tune_rf-194"><span class="linenos">194</span></a>        
</span><span id="CurveNonParamFit.tune_rf-195"><a href="#CurveNonParamFit.tune_rf-195"><span class="linenos">195</span></a>        <span class="c1"># Initialize GridSearchCV</span>
</span><span id="CurveNonParamFit.tune_rf-196"><a href="#CurveNonParamFit.tune_rf-196"><span class="linenos">196</span></a>        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> 
</span><span id="CurveNonParamFit.tune_rf-197"><a href="#CurveNonParamFit.tune_rf-197"><span class="linenos">197</span></a>                                   <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> 
</span><span id="CurveNonParamFit.tune_rf-198"><a href="#CurveNonParamFit.tune_rf-198"><span class="linenos">198</span></a>                                   <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nFolds</span><span class="p">,</span>
</span><span id="CurveNonParamFit.tune_rf-199"><a href="#CurveNonParamFit.tune_rf-199"><span class="linenos">199</span></a>                                   <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="CurveNonParamFit.tune_rf-200"><a href="#CurveNonParamFit.tune_rf-200"><span class="linenos">200</span></a>                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_rf-201"><a href="#CurveNonParamFit.tune_rf-201"><span class="linenos">201</span></a>        
</span><span id="CurveNonParamFit.tune_rf-202"><a href="#CurveNonParamFit.tune_rf-202"><span class="linenos">202</span></a>        <span class="c1"># Fit and find best estimator</span>
</span><span id="CurveNonParamFit.tune_rf-203"><a href="#CurveNonParamFit.tune_rf-203"><span class="linenos">203</span></a>        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_rf-204"><a href="#CurveNonParamFit.tune_rf-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</span><span id="CurveNonParamFit.tune_rf-205"><a href="#CurveNonParamFit.tune_rf-205"><span class="linenos">205</span></a>        
</span><span id="CurveNonParamFit.tune_rf-206"><a href="#CurveNonParamFit.tune_rf-206"><span class="linenos">206</span></a>        <span class="n">opt_param</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
</span><span id="CurveNonParamFit.tune_rf-207"><a href="#CurveNonParamFit.tune_rf-207"><span class="linenos">207</span></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_train</span><span class="p">))</span>
</span><span id="CurveNonParamFit.tune_rf-208"><a href="#CurveNonParamFit.tune_rf-208"><span class="linenos">208</span></a>        <span class="n">val_metrics</span> <span class="o">=</span> <span class="n">evaluate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_X_val</span><span class="p">))</span>
</span><span id="CurveNonParamFit.tune_rf-209"><a href="#CurveNonParamFit.tune_rf-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
</span><span id="CurveNonParamFit.tune_rf-210"><a href="#CurveNonParamFit.tune_rf-210"><span class="linenos">210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters found:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_rf-211"><a href="#CurveNonParamFit.tune_rf-211"><span class="linenos">211</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best score from GridSearchCV:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</span><span id="CurveNonParamFit.tune_rf-212"><a href="#CurveNonParamFit.tune_rf-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span>
</span></pre></div>


            <div class="docstring"><p>A function to tune the Random Forest model using GridSearchCV.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>param_grid: dict, default=None
    A dictionary containing the hyperparameters to tune. If None, the function will test different n_estimators,
    max_depth, min_samples_split, and min_samples_leaf.
verbose: bool, default=False
    If True, prints the best parameters found and the best score from GridSearchCV.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>opt_param: dict
    The optimal parameters found by GridSearchCV.
train_metrics: dict
    The performance metrics on the training set.
val_metrics: dict
    The performance metrics on the validation set.
</code></pre>
</div>


                            </div>
                            <div id="CurveNonParamFit.compare_models" class="classattr">
                                        <input id="CurveNonParamFit.compare_models-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compare_models</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">plot</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.compare_models-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.compare_models"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.compare_models-214"><a href="#CurveNonParamFit.compare_models-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">compare_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="CurveNonParamFit.compare_models-215"><a href="#CurveNonParamFit.compare_models-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.compare_models-216"><a href="#CurveNonParamFit.compare_models-216"><span class="linenos">216</span></a><span class="sd">        A function to compare the performance of GAM and Random Forest models based on a specified metric.</span>
</span><span id="CurveNonParamFit.compare_models-217"><a href="#CurveNonParamFit.compare_models-217"><span class="linenos">217</span></a>
</span><span id="CurveNonParamFit.compare_models-218"><a href="#CurveNonParamFit.compare_models-218"><span class="linenos">218</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.compare_models-219"><a href="#CurveNonParamFit.compare_models-219"><span class="linenos">219</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.compare_models-220"><a href="#CurveNonParamFit.compare_models-220"><span class="linenos">220</span></a><span class="sd">            on: str, default=&#39;RMSE&#39;</span>
</span><span id="CurveNonParamFit.compare_models-221"><a href="#CurveNonParamFit.compare_models-221"><span class="linenos">221</span></a><span class="sd">                The metric to compare the models on. Options: &#39;RMSE&#39;, &#39;MAE&#39;, &#39;R2&#39;</span>
</span><span id="CurveNonParamFit.compare_models-222"><a href="#CurveNonParamFit.compare_models-222"><span class="linenos">222</span></a><span class="sd">            verbose: bool, default=True</span>
</span><span id="CurveNonParamFit.compare_models-223"><a href="#CurveNonParamFit.compare_models-223"><span class="linenos">223</span></a><span class="sd">                If True, prints the best model based on the specified metric and the comparison results.</span>
</span><span id="CurveNonParamFit.compare_models-224"><a href="#CurveNonParamFit.compare_models-224"><span class="linenos">224</span></a><span class="sd">            plot: bool, default=True</span>
</span><span id="CurveNonParamFit.compare_models-225"><a href="#CurveNonParamFit.compare_models-225"><span class="linenos">225</span></a><span class="sd">                If True, plots a comparison of the specified metric for different models.</span>
</span><span id="CurveNonParamFit.compare_models-226"><a href="#CurveNonParamFit.compare_models-226"><span class="linenos">226</span></a>
</span><span id="CurveNonParamFit.compare_models-227"><a href="#CurveNonParamFit.compare_models-227"><span class="linenos">227</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.compare_models-228"><a href="#CurveNonParamFit.compare_models-228"><span class="linenos">228</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.compare_models-229"><a href="#CurveNonParamFit.compare_models-229"><span class="linenos">229</span></a><span class="sd">            best_model_type: str</span>
</span><span id="CurveNonParamFit.compare_models-230"><a href="#CurveNonParamFit.compare_models-230"><span class="linenos">230</span></a><span class="sd">                The best model based on the specified metric.</span>
</span><span id="CurveNonParamFit.compare_models-231"><a href="#CurveNonParamFit.compare_models-231"><span class="linenos">231</span></a><span class="sd">            comparison_result: pd.DataFrame</span>
</span><span id="CurveNonParamFit.compare_models-232"><a href="#CurveNonParamFit.compare_models-232"><span class="linenos">232</span></a><span class="sd">                A DataFrame containing the comparison results of the two models based on the specified metric.</span>
</span><span id="CurveNonParamFit.compare_models-233"><a href="#CurveNonParamFit.compare_models-233"><span class="linenos">233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.compare_models-234"><a href="#CurveNonParamFit.compare_models-234"><span class="linenos">234</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CurveNonParamFit.compare_models-235"><a href="#CurveNonParamFit.compare_models-235"><span class="linenos">235</span></a>        <span class="n">model_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit.compare_models-236"><a href="#CurveNonParamFit.compare_models-236"><span class="linenos">236</span></a>
</span><span id="CurveNonParamFit.compare_models-237"><a href="#CurveNonParamFit.compare_models-237"><span class="linenos">237</span></a>        <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-238"><a href="#CurveNonParamFit.compare_models-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-239"><a href="#CurveNonParamFit.compare_models-239"><span class="linenos">239</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-240"><a href="#CurveNonParamFit.compare_models-240"><span class="linenos">240</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running cross-validation for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> model&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-241"><a href="#CurveNonParamFit.compare_models-241"><span class="linenos">241</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-242"><a href="#CurveNonParamFit.compare_models-242"><span class="linenos">242</span></a>            
</span><span id="CurveNonParamFit.compare_models-243"><a href="#CurveNonParamFit.compare_models-243"><span class="linenos">243</span></a>            <span class="c1"># Perform cross-validation and gather metrics. </span>
</span><span id="CurveNonParamFit.compare_models-244"><a href="#CurveNonParamFit.compare_models-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-245"><a href="#CurveNonParamFit.compare_models-245"><span class="linenos">245</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_gam</span><span class="p">()</span>
</span><span id="CurveNonParamFit.compare_models-246"><a href="#CurveNonParamFit.compare_models-246"><span class="linenos">246</span></a>            <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-247"><a href="#CurveNonParamFit.compare_models-247"><span class="linenos">247</span></a>                <span class="n">opt_param</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">val_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tune_rf</span><span class="p">()</span>
</span><span id="CurveNonParamFit.compare_models-248"><a href="#CurveNonParamFit.compare_models-248"><span class="linenos">248</span></a>            
</span><span id="CurveNonParamFit.compare_models-249"><a href="#CurveNonParamFit.compare_models-249"><span class="linenos">249</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CurveNonParamFit.compare_models-250"><a href="#CurveNonParamFit.compare_models-250"><span class="linenos">250</span></a>                <span class="s1">&#39;Model Type&#39;</span><span class="p">:</span> <span class="n">model_type</span><span class="p">,</span>
</span><span id="CurveNonParamFit.compare_models-251"><a href="#CurveNonParamFit.compare_models-251"><span class="linenos">251</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="CurveNonParamFit.compare_models-252"><a href="#CurveNonParamFit.compare_models-252"><span class="linenos">252</span></a>                <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="CurveNonParamFit.compare_models-253"><a href="#CurveNonParamFit.compare_models-253"><span class="linenos">253</span></a>            <span class="p">}</span>
</span><span id="CurveNonParamFit.compare_models-254"><a href="#CurveNonParamFit.compare_models-254"><span class="linenos">254</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-255"><a href="#CurveNonParamFit.compare_models-255"><span class="linenos">255</span></a>            
</span><span id="CurveNonParamFit.compare_models-256"><a href="#CurveNonParamFit.compare_models-256"><span class="linenos">256</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-257"><a href="#CurveNonParamFit.compare_models-257"><span class="linenos">257</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">opt_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-258"><a href="#CurveNonParamFit.compare_models-258"><span class="linenos">258</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-259"><a href="#CurveNonParamFit.compare_models-259"><span class="linenos">259</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-260"><a href="#CurveNonParamFit.compare_models-260"><span class="linenos">260</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation Metrics:&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-261"><a href="#CurveNonParamFit.compare_models-261"><span class="linenos">261</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-262"><a href="#CurveNonParamFit.compare_models-262"><span class="linenos">262</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-263"><a href="#CurveNonParamFit.compare_models-263"><span class="linenos">263</span></a>
</span><span id="CurveNonParamFit.compare_models-264"><a href="#CurveNonParamFit.compare_models-264"><span class="linenos">264</span></a>        <span class="c1"># Convert results to DataFrame for easier handling</span>
</span><span id="CurveNonParamFit.compare_models-265"><a href="#CurveNonParamFit.compare_models-265"><span class="linenos">265</span></a>        <span class="n">comparison_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  
</span><span id="CurveNonParamFit.compare_models-266"><a href="#CurveNonParamFit.compare_models-266"><span class="linenos">266</span></a>
</span><span id="CurveNonParamFit.compare_models-267"><a href="#CurveNonParamFit.compare_models-267"><span class="linenos">267</span></a>        <span class="c1"># Identify the best model based on a specific validation metric</span>
</span><span id="CurveNonParamFit.compare_models-268"><a href="#CurveNonParamFit.compare_models-268"><span class="linenos">268</span></a>        <span class="n">best_model_type</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Model Type&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit.compare_models-269"><a href="#CurveNonParamFit.compare_models-269"><span class="linenos">269</span></a>        
</span><span id="CurveNonParamFit.compare_models-270"><a href="#CurveNonParamFit.compare_models-270"><span class="linenos">270</span></a>        <span class="c1"># set the best models information</span>
</span><span id="CurveNonParamFit.compare_models-271"><a href="#CurveNonParamFit.compare_models-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span> <span class="o">=</span> <span class="n">best_model_type</span>
</span><span id="CurveNonParamFit.compare_models-272"><a href="#CurveNonParamFit.compare_models-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-273"><a href="#CurveNonParamFit.compare_models-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="CurveNonParamFit.compare_models-274"><a href="#CurveNonParamFit.compare_models-274"><span class="linenos">274</span></a>        <span class="k">elif</span> <span class="n">best_model_type</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-275"><a href="#CurveNonParamFit.compare_models-275"><span class="linenos">275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>        
</span><span id="CurveNonParamFit.compare_models-276"><a href="#CurveNonParamFit.compare_models-276"><span class="linenos">276</span></a>
</span><span id="CurveNonParamFit.compare_models-277"><a href="#CurveNonParamFit.compare_models-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-278"><a href="#CurveNonParamFit.compare_models-278"><span class="linenos">278</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-279"><a href="#CurveNonParamFit.compare_models-279"><span class="linenos">279</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best model based on Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s2">: </span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">best_model_type</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-280"><a href="#CurveNonParamFit.compare_models-280"><span class="linenos">280</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-281"><a href="#CurveNonParamFit.compare_models-281"><span class="linenos">281</span></a>
</span><span id="CurveNonParamFit.compare_models-282"><a href="#CurveNonParamFit.compare_models-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="CurveNonParamFit.compare_models-283"><a href="#CurveNonParamFit.compare_models-283"><span class="linenos">283</span></a>            <span class="c1"># Plot comparison of the specified metric for different models            </span>
</span><span id="CurveNonParamFit.compare_models-284"><a href="#CurveNonParamFit.compare_models-284"><span class="linenos">284</span></a>            <span class="n">metric_comparison</span> <span class="o">=</span> <span class="n">comparison_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Model Type&#39;</span><span class="p">)[[</span><span class="sa">f</span><span class="s1">&#39;Train </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Validation </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span>
</span><span id="CurveNonParamFit.compare_models-285"><a href="#CurveNonParamFit.compare_models-285"><span class="linenos">285</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit.compare_models-286"><a href="#CurveNonParamFit.compare_models-286"><span class="linenos">286</span></a>            <span class="n">metric_comparison</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-287"><a href="#CurveNonParamFit.compare_models-287"><span class="linenos">287</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-288"><a href="#CurveNonParamFit.compare_models-288"><span class="linenos">288</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comparison of </span><span class="si">{</span><span class="n">on</span><span class="si">}</span><span class="s1"> for Different Models&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.compare_models-289"><a href="#CurveNonParamFit.compare_models-289"><span class="linenos">289</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveNonParamFit.compare_models-290"><a href="#CurveNonParamFit.compare_models-290"><span class="linenos">290</span></a>
</span><span id="CurveNonParamFit.compare_models-291"><a href="#CurveNonParamFit.compare_models-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">best_model_type</span><span class="p">,</span> <span class="n">comparison_result</span>     
</span></pre></div>


            <div class="docstring"><p>A function to compare the performance of GAM and Random Forest models based on a specified metric.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>on: str, default='RMSE'
    The metric to compare the models on. Options: 'RMSE', 'MAE', 'R2'
verbose: bool, default=True
    If True, prints the best model based on the specified metric and the comparison results.
plot: bool, default=True
    If True, plots a comparison of the specified metric for different models.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>best_model_type: str
    The best model based on the specified metric.
comparison_result: pd.DataFrame
    A DataFrame containing the comparison results of the two models based on the specified metric.
</code></pre>
</div>


                            </div>
                            <div id="CurveNonParamFit.predict_best" class="classattr">
                                        <input id="CurveNonParamFit.predict_best-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict_best</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model</span>, </span><span class="param"><span class="n">X</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.predict_best-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.predict_best"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.predict_best-293"><a href="#CurveNonParamFit.predict_best-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">predict_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="CurveNonParamFit.predict_best-294"><a href="#CurveNonParamFit.predict_best-294"><span class="linenos">294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.predict_best-295"><a href="#CurveNonParamFit.predict_best-295"><span class="linenos">295</span></a><span class="sd">        A function to predict the best model&#39;s output.</span>
</span><span id="CurveNonParamFit.predict_best-296"><a href="#CurveNonParamFit.predict_best-296"><span class="linenos">296</span></a>
</span><span id="CurveNonParamFit.predict_best-297"><a href="#CurveNonParamFit.predict_best-297"><span class="linenos">297</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.predict_best-298"><a href="#CurveNonParamFit.predict_best-298"><span class="linenos">298</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.predict_best-299"><a href="#CurveNonParamFit.predict_best-299"><span class="linenos">299</span></a><span class="sd">            model: str</span>
</span><span id="CurveNonParamFit.predict_best-300"><a href="#CurveNonParamFit.predict_best-300"><span class="linenos">300</span></a><span class="sd">                The model to use for prediction. Options: &#39;GAM Splines&#39;, &#39;Random Forest&#39;, &#39;Best Model&#39;.</span>
</span><span id="CurveNonParamFit.predict_best-301"><a href="#CurveNonParamFit.predict_best-301"><span class="linenos">301</span></a><span class="sd">            X: pd.DataFrame, default=None</span>
</span><span id="CurveNonParamFit.predict_best-302"><a href="#CurveNonParamFit.predict_best-302"><span class="linenos">302</span></a><span class="sd">                The data to predict on. If None, the function will use the training data.</span>
</span><span id="CurveNonParamFit.predict_best-303"><a href="#CurveNonParamFit.predict_best-303"><span class="linenos">303</span></a>
</span><span id="CurveNonParamFit.predict_best-304"><a href="#CurveNonParamFit.predict_best-304"><span class="linenos">304</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.predict_best-305"><a href="#CurveNonParamFit.predict_best-305"><span class="linenos">305</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.predict_best-306"><a href="#CurveNonParamFit.predict_best-306"><span class="linenos">306</span></a><span class="sd">            prediction: pd.DataFrame</span>
</span><span id="CurveNonParamFit.predict_best-307"><a href="#CurveNonParamFit.predict_best-307"><span class="linenos">307</span></a><span class="sd">                A DataFrame containing the predictions, upper and lower bounds of the 90% confidence interval.</span>
</span><span id="CurveNonParamFit.predict_best-308"><a href="#CurveNonParamFit.predict_best-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.predict_best-309"><a href="#CurveNonParamFit.predict_best-309"><span class="linenos">309</span></a>        <span class="k">assert</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">],</span> <span class="s2">&quot;model must be &#39;GAM Splines&#39;, &#39;Random Forest&#39;, or &#39;Best Model&#39;&quot;</span>
</span><span id="CurveNonParamFit.predict_best-310"><a href="#CurveNonParamFit.predict_best-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit.predict_best-311"><a href="#CurveNonParamFit.predict_best-311"><span class="linenos">311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="CurveNonParamFit.predict_best-312"><a href="#CurveNonParamFit.predict_best-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CurveNonParamFit.predict_best-313"><a href="#CurveNonParamFit.predict_best-313"><span class="linenos">313</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="CurveNonParamFit.predict_best-314"><a href="#CurveNonParamFit.predict_best-314"><span class="linenos">314</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CurveNonParamFit.predict_best-315"><a href="#CurveNonParamFit.predict_best-315"><span class="linenos">315</span></a>            <span class="c1"># normalize the data</span>
</span><span id="CurveNonParamFit.predict_best-316"><a href="#CurveNonParamFit.predict_best-316"><span class="linenos">316</span></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_min</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-317"><a href="#CurveNonParamFit.predict_best-317"><span class="linenos">317</span></a>        
</span><span id="CurveNonParamFit.predict_best-318"><a href="#CurveNonParamFit.predict_best-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Best Model&#39;</span><span class="p">:</span> 
</span><span id="CurveNonParamFit.predict_best-319"><a href="#CurveNonParamFit.predict_best-319"><span class="linenos">319</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_model_type</span>
</span><span id="CurveNonParamFit.predict_best-320"><a href="#CurveNonParamFit.predict_best-320"><span class="linenos">320</span></a>
</span><span id="CurveNonParamFit.predict_best-321"><a href="#CurveNonParamFit.predict_best-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;GAM Splines&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.predict_best-322"><a href="#CurveNonParamFit.predict_best-322"><span class="linenos">322</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_gam</span>
</span><span id="CurveNonParamFit.predict_best-323"><a href="#CurveNonParamFit.predict_best-323"><span class="linenos">323</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-324"><a href="#CurveNonParamFit.predict_best-324"><span class="linenos">324</span></a>            <span class="n">gam_intervals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_pygam_model</span><span class="p">()</span><span class="o">.</span><span class="n">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-325"><a href="#CurveNonParamFit.predict_best-325"><span class="linenos">325</span></a>            <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gam_intervals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="CurveNonParamFit.predict_best-326"><a href="#CurveNonParamFit.predict_best-326"><span class="linenos">326</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.predict_best-327"><a href="#CurveNonParamFit.predict_best-327"><span class="linenos">327</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_rf</span>
</span><span id="CurveNonParamFit.predict_best-328"><a href="#CurveNonParamFit.predict_best-328"><span class="linenos">328</span></a>            <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-329"><a href="#CurveNonParamFit.predict_best-329"><span class="linenos">329</span></a>            <span class="n">rf_preds_per_tree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">estimators_</span><span class="p">])</span>
</span><span id="CurveNonParamFit.predict_best-330"><a href="#CurveNonParamFit.predict_best-330"><span class="linenos">330</span></a>            <span class="n">yqlb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-331"><a href="#CurveNonParamFit.predict_best-331"><span class="linenos">331</span></a>            <span class="n">yqub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">rf_preds_per_tree</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-332"><a href="#CurveNonParamFit.predict_best-332"><span class="linenos">332</span></a>        
</span><span id="CurveNonParamFit.predict_best-333"><a href="#CurveNonParamFit.predict_best-333"><span class="linenos">333</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;ypred&#39;</span><span class="p">:</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;ypred_upper&#39;</span><span class="p">:</span> <span class="n">yqlb</span><span class="p">,</span> <span class="s1">&#39;ypred_lower&#39;</span><span class="p">:</span> <span class="n">yqub</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveNonParamFit.predict_best-334"><a href="#CurveNonParamFit.predict_best-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">prediction</span> 
</span></pre></div>


            <div class="docstring"><p>A function to predict the best model's output.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>model: str
    The model to use for prediction. Options: 'GAM Splines', 'Random Forest', 'Best Model'.
X: pd.DataFrame, default=None
    The data to predict on. If None, the function will use the training data.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>prediction: pd.DataFrame
    A DataFrame containing the predictions, upper and lower bounds of the 90% confidence interval.
</code></pre>
</div>


                            </div>
                            <div id="CurveNonParamFit.plot_x_y" class="classattr">
                                        <input id="CurveNonParamFit.plot_x_y-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_x_y</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.plot_x_y-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.plot_x_y"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.plot_x_y-336"><a href="#CurveNonParamFit.plot_x_y-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">plot_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit.plot_x_y-337"><a href="#CurveNonParamFit.plot_x_y-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.plot_x_y-338"><a href="#CurveNonParamFit.plot_x_y-338"><span class="linenos">338</span></a><span class="sd">        Plots the dependent variable y against all the independent variables x.</span>
</span><span id="CurveNonParamFit.plot_x_y-339"><a href="#CurveNonParamFit.plot_x_y-339"><span class="linenos">339</span></a>
</span><span id="CurveNonParamFit.plot_x_y-340"><a href="#CurveNonParamFit.plot_x_y-340"><span class="linenos">340</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.plot_x_y-341"><a href="#CurveNonParamFit.plot_x_y-341"><span class="linenos">341</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.plot_x_y-342"><a href="#CurveNonParamFit.plot_x_y-342"><span class="linenos">342</span></a><span class="sd">            title: str, default=&#39;&#39;</span>
</span><span id="CurveNonParamFit.plot_x_y-343"><a href="#CurveNonParamFit.plot_x_y-343"><span class="linenos">343</span></a><span class="sd">                The title of the plot.</span>
</span><span id="CurveNonParamFit.plot_x_y-344"><a href="#CurveNonParamFit.plot_x_y-344"><span class="linenos">344</span></a>
</span><span id="CurveNonParamFit.plot_x_y-345"><a href="#CurveNonParamFit.plot_x_y-345"><span class="linenos">345</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.plot_x_y-346"><a href="#CurveNonParamFit.plot_x_y-346"><span class="linenos">346</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.plot_x_y-347"><a href="#CurveNonParamFit.plot_x_y-347"><span class="linenos">347</span></a><span class="sd">            None</span>
</span><span id="CurveNonParamFit.plot_x_y-348"><a href="#CurveNonParamFit.plot_x_y-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.plot_x_y-349"><a href="#CurveNonParamFit.plot_x_y-349"><span class="linenos">349</span></a>        
</span><span id="CurveNonParamFit.plot_x_y-350"><a href="#CurveNonParamFit.plot_x_y-350"><span class="linenos">350</span></a>        <span class="n">nplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="CurveNonParamFit.plot_x_y-351"><a href="#CurveNonParamFit.plot_x_y-351"><span class="linenos">351</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">nplots</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="CurveNonParamFit.plot_x_y-352"><a href="#CurveNonParamFit.plot_x_y-352"><span class="linenos">352</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nplots</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
</span><span id="CurveNonParamFit.plot_x_y-353"><a href="#CurveNonParamFit.plot_x_y-353"><span class="linenos">353</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit.plot_x_y-354"><a href="#CurveNonParamFit.plot_x_y-354"><span class="linenos">354</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="CurveNonParamFit.plot_x_y-355"><a href="#CurveNonParamFit.plot_x_y-355"><span class="linenos">355</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_x_y-356"><a href="#CurveNonParamFit.plot_x_y-356"><span class="linenos">356</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_x_y-357"><a href="#CurveNonParamFit.plot_x_y-357"><span class="linenos">357</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_x_y-358"><a href="#CurveNonParamFit.plot_x_y-358"><span class="linenos">358</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_x_y-359"><a href="#CurveNonParamFit.plot_x_y-359"><span class="linenos">359</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="CurveNonParamFit.plot_x_y-360"><a href="#CurveNonParamFit.plot_x_y-360"><span class="linenos">360</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="si">}</span><span class="s2"> against independent variables&quot;</span>
</span><span id="CurveNonParamFit.plot_x_y-361"><a href="#CurveNonParamFit.plot_x_y-361"><span class="linenos">361</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
</span><span id="CurveNonParamFit.plot_x_y-362"><a href="#CurveNonParamFit.plot_x_y-362"><span class="linenos">362</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_x_y-363"><a href="#CurveNonParamFit.plot_x_y-363"><span class="linenos">363</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveNonParamFit.plot_x_y-364"><a href="#CurveNonParamFit.plot_x_y-364"><span class="linenos">364</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="CurveNonParamFit.plot_x_y-365"><a href="#CurveNonParamFit.plot_x_y-365"><span class="linenos">365</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Plots the dependent variable y against all the independent variables x.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>title: str, default=''
    The title of the plot.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None
</code></pre>
</div>


                            </div>
                            <div id="CurveNonParamFit.plot_best" class="classattr">
                                        <input id="CurveNonParamFit.plot_best-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_best</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Best Model Predictions&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CurveNonParamFit.plot_best-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CurveNonParamFit.plot_best"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CurveNonParamFit.plot_best-367"><a href="#CurveNonParamFit.plot_best-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">plot_best</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;Best Model Predictions&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit.plot_best-368"><a href="#CurveNonParamFit.plot_best-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.plot_best-369"><a href="#CurveNonParamFit.plot_best-369"><span class="linenos">369</span></a><span class="sd">        A function to plot the best model&#39;s predictions for both the Random Forest and GAM models families.</span>
</span><span id="CurveNonParamFit.plot_best-370"><a href="#CurveNonParamFit.plot_best-370"><span class="linenos">370</span></a>
</span><span id="CurveNonParamFit.plot_best-371"><a href="#CurveNonParamFit.plot_best-371"><span class="linenos">371</span></a><span class="sd">        Parameters:</span>
</span><span id="CurveNonParamFit.plot_best-372"><a href="#CurveNonParamFit.plot_best-372"><span class="linenos">372</span></a><span class="sd">        -----------</span>
</span><span id="CurveNonParamFit.plot_best-373"><a href="#CurveNonParamFit.plot_best-373"><span class="linenos">373</span></a><span class="sd">            title: str, default=&#39;Best Model Predictions&#39;</span>
</span><span id="CurveNonParamFit.plot_best-374"><a href="#CurveNonParamFit.plot_best-374"><span class="linenos">374</span></a><span class="sd">                The title of the plot.</span>
</span><span id="CurveNonParamFit.plot_best-375"><a href="#CurveNonParamFit.plot_best-375"><span class="linenos">375</span></a>
</span><span id="CurveNonParamFit.plot_best-376"><a href="#CurveNonParamFit.plot_best-376"><span class="linenos">376</span></a><span class="sd">        Returns:</span>
</span><span id="CurveNonParamFit.plot_best-377"><a href="#CurveNonParamFit.plot_best-377"><span class="linenos">377</span></a><span class="sd">        --------</span>
</span><span id="CurveNonParamFit.plot_best-378"><a href="#CurveNonParamFit.plot_best-378"><span class="linenos">378</span></a><span class="sd">            None</span>
</span><span id="CurveNonParamFit.plot_best-379"><a href="#CurveNonParamFit.plot_best-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CurveNonParamFit.plot_best-380"><a href="#CurveNonParamFit.plot_best-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;best_model&#39;</span><span class="p">):</span>
</span><span id="CurveNonParamFit.plot_best-381"><a href="#CurveNonParamFit.plot_best-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">compare_models</span><span class="p">()</span>
</span><span id="CurveNonParamFit.plot_best-382"><a href="#CurveNonParamFit.plot_best-382"><span class="linenos">382</span></a>        
</span><span id="CurveNonParamFit.plot_best-383"><a href="#CurveNonParamFit.plot_best-383"><span class="linenos">383</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="CurveNonParamFit.plot_best-384"><a href="#CurveNonParamFit.plot_best-384"><span class="linenos">384</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;GAM Splines&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">]):</span>
</span><span id="CurveNonParamFit.plot_best-385"><a href="#CurveNonParamFit.plot_best-385"><span class="linenos">385</span></a>                                      
</span><span id="CurveNonParamFit.plot_best-386"><a href="#CurveNonParamFit.plot_best-386"><span class="linenos">386</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_best</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-387"><a href="#CurveNonParamFit.plot_best-387"><span class="linenos">387</span></a>            <span class="n">ypred</span><span class="p">,</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_lower&#39;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s1">&#39;ypred_upper&#39;</span><span class="p">]</span>
</span><span id="CurveNonParamFit.plot_best-388"><a href="#CurveNonParamFit.plot_best-388"><span class="linenos">388</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="CurveNonParamFit.plot_best-389"><a href="#CurveNonParamFit.plot_best-389"><span class="linenos">389</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-390"><a href="#CurveNonParamFit.plot_best-390"><span class="linenos">390</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-391"><a href="#CurveNonParamFit.plot_best-391"><span class="linenos">391</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_raw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var</span><span class="p">],</span> <span class="n">yqlb</span><span class="p">,</span> <span class="n">yqub</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;90% CI&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-392"><a href="#CurveNonParamFit.plot_best-392"><span class="linenos">392</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_main_indep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-393"><a href="#CurveNonParamFit.plot_best-393"><span class="linenos">393</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var_name</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-394"><a href="#CurveNonParamFit.plot_best-394"><span class="linenos">394</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-395"><a href="#CurveNonParamFit.plot_best-395"><span class="linenos">395</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-396"><a href="#CurveNonParamFit.plot_best-396"><span class="linenos">396</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="CurveNonParamFit.plot_best-397"><a href="#CurveNonParamFit.plot_best-397"><span class="linenos">397</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="CurveNonParamFit.plot_best-398"><a href="#CurveNonParamFit.plot_best-398"><span class="linenos">398</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>A function to plot the best model's predictions for both the Random Forest and GAM models families.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>title: str, default='Best Model Predictions'
    The title of the plot.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>None
</code></pre>
</div>


                            </div>
                </section>
                <section id="GAMRegressor">
                            <input id="GAMRegressor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GAMRegressor</span><wbr>(<span class="base">sklearn.base.BaseEstimator</span>, <span class="base">sklearn.base.RegressorMixin</span>):

                <label class="view-source-button" for="GAMRegressor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor-400"><a href="#GAMRegressor-400"><span class="linenos">400</span></a><span class="k">class</span> <span class="nc">GAMRegressor</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">):</span>
</span><span id="GAMRegressor-401"><a href="#GAMRegressor-401"><span class="linenos">401</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-402"><a href="#GAMRegressor-402"><span class="linenos">402</span></a><span class="sd">    A wrapper class to define a Generalized Additive Model (GAM) regressor using pyGAM.</span>
</span><span id="GAMRegressor-403"><a href="#GAMRegressor-403"><span class="linenos">403</span></a>
</span><span id="GAMRegressor-404"><a href="#GAMRegressor-404"><span class="linenos">404</span></a><span class="sd">    Parameters:</span>
</span><span id="GAMRegressor-405"><a href="#GAMRegressor-405"><span class="linenos">405</span></a><span class="sd">    -----------</span>
</span><span id="GAMRegressor-406"><a href="#GAMRegressor-406"><span class="linenos">406</span></a><span class="sd">    - model_type: str, default=&#39;linear&#39;</span>
</span><span id="GAMRegressor-407"><a href="#GAMRegressor-407"><span class="linenos">407</span></a><span class="sd">        The type of model to use for curve fitting. Options: &#39;linear&#39;, &#39;logistic&#39;, &#39;gamma&#39;.</span>
</span><span id="GAMRegressor-408"><a href="#GAMRegressor-408"><span class="linenos">408</span></a><span class="sd">    - n_splines: int, default=25</span>
</span><span id="GAMRegressor-409"><a href="#GAMRegressor-409"><span class="linenos">409</span></a><span class="sd">        The number of splines to use in the model.</span>
</span><span id="GAMRegressor-410"><a href="#GAMRegressor-410"><span class="linenos">410</span></a><span class="sd">    - lam: float, default=0.6</span>
</span><span id="GAMRegressor-411"><a href="#GAMRegressor-411"><span class="linenos">411</span></a><span class="sd">        The regularization parameter to use in the model.</span>
</span><span id="GAMRegressor-412"><a href="#GAMRegressor-412"><span class="linenos">412</span></a>
</span><span id="GAMRegressor-413"><a href="#GAMRegressor-413"><span class="linenos">413</span></a><span class="sd">    Methods:</span>
</span><span id="GAMRegressor-414"><a href="#GAMRegressor-414"><span class="linenos">414</span></a><span class="sd">    --------</span>
</span><span id="GAMRegressor-415"><a href="#GAMRegressor-415"><span class="linenos">415</span></a><span class="sd">    - fit(X, y): Fit the GAM model to the data.</span>
</span><span id="GAMRegressor-416"><a href="#GAMRegressor-416"><span class="linenos">416</span></a><span class="sd">    - predict(X): Predict the output using the fitted model.</span>
</span><span id="GAMRegressor-417"><a href="#GAMRegressor-417"><span class="linenos">417</span></a><span class="sd">    - get_params(): Get the parameters of the model.</span>
</span><span id="GAMRegressor-418"><a href="#GAMRegressor-418"><span class="linenos">418</span></a><span class="sd">    - get_pygam_model(): Get the pyGAM model.</span>
</span><span id="GAMRegressor-419"><a href="#GAMRegressor-419"><span class="linenos">419</span></a><span class="sd">    - set_params(**parameters): Set the parameters of the model.</span>
</span><span id="GAMRegressor-420"><a href="#GAMRegressor-420"><span class="linenos">420</span></a>
</span><span id="GAMRegressor-421"><a href="#GAMRegressor-421"><span class="linenos">421</span></a><span class="sd">    Raises:</span>
</span><span id="GAMRegressor-422"><a href="#GAMRegressor-422"><span class="linenos">422</span></a><span class="sd">    -------</span>
</span><span id="GAMRegressor-423"><a href="#GAMRegressor-423"><span class="linenos">423</span></a><span class="sd">    - AssertionError: If the model type is not one of &#39;linear&#39;, &#39;logistic&#39;, or &#39;gamma&#39;.</span>
</span><span id="GAMRegressor-424"><a href="#GAMRegressor-424"><span class="linenos">424</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-425"><a href="#GAMRegressor-425"><span class="linenos">425</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="GAMRegressor-426"><a href="#GAMRegressor-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
</span><span id="GAMRegressor-427"><a href="#GAMRegressor-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span> <span class="o">=</span> <span class="n">n_splines</span>
</span><span id="GAMRegressor-428"><a href="#GAMRegressor-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="GAMRegressor-429"><a href="#GAMRegressor-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GAMRegressor-430"><a href="#GAMRegressor-430"><span class="linenos">430</span></a>
</span><span id="GAMRegressor-431"><a href="#GAMRegressor-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="GAMRegressor-432"><a href="#GAMRegressor-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-433"><a href="#GAMRegressor-433"><span class="linenos">433</span></a><span class="sd">        Fit the GAM model to the data.</span>
</span><span id="GAMRegressor-434"><a href="#GAMRegressor-434"><span class="linenos">434</span></a>
</span><span id="GAMRegressor-435"><a href="#GAMRegressor-435"><span class="linenos">435</span></a><span class="sd">        Parameters:</span>
</span><span id="GAMRegressor-436"><a href="#GAMRegressor-436"><span class="linenos">436</span></a><span class="sd">        -----------</span>
</span><span id="GAMRegressor-437"><a href="#GAMRegressor-437"><span class="linenos">437</span></a><span class="sd">            X: np.array</span>
</span><span id="GAMRegressor-438"><a href="#GAMRegressor-438"><span class="linenos">438</span></a><span class="sd">                The independent variables.</span>
</span><span id="GAMRegressor-439"><a href="#GAMRegressor-439"><span class="linenos">439</span></a><span class="sd">            y: np.array</span>
</span><span id="GAMRegressor-440"><a href="#GAMRegressor-440"><span class="linenos">440</span></a><span class="sd">                The dependent variable.</span>
</span><span id="GAMRegressor-441"><a href="#GAMRegressor-441"><span class="linenos">441</span></a>
</span><span id="GAMRegressor-442"><a href="#GAMRegressor-442"><span class="linenos">442</span></a><span class="sd">        Returns:</span>
</span><span id="GAMRegressor-443"><a href="#GAMRegressor-443"><span class="linenos">443</span></a><span class="sd">        --------</span>
</span><span id="GAMRegressor-444"><a href="#GAMRegressor-444"><span class="linenos">444</span></a><span class="sd">            self: GAMRegressor</span>
</span><span id="GAMRegressor-445"><a href="#GAMRegressor-445"><span class="linenos">445</span></a><span class="sd">                The fitted GAM model.</span>
</span><span id="GAMRegressor-446"><a href="#GAMRegressor-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-447"><a href="#GAMRegressor-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor-448"><a href="#GAMRegressor-448"><span class="linenos">448</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LinearGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor-449"><a href="#GAMRegressor-449"><span class="linenos">449</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;logistic&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor-450"><a href="#GAMRegressor-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LogisticGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor-451"><a href="#GAMRegressor-451"><span class="linenos">451</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor-452"><a href="#GAMRegressor-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">GammaGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor-453"><a href="#GAMRegressor-453"><span class="linenos">453</span></a>        <span class="c1"># Add additional model types as needed</span>
</span><span id="GAMRegressor-454"><a href="#GAMRegressor-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="GAMRegressor-455"><a href="#GAMRegressor-455"><span class="linenos">455</span></a>
</span><span id="GAMRegressor-456"><a href="#GAMRegressor-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="GAMRegressor-457"><a href="#GAMRegressor-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-458"><a href="#GAMRegressor-458"><span class="linenos">458</span></a><span class="sd">        Predict the output using the fitted model.</span>
</span><span id="GAMRegressor-459"><a href="#GAMRegressor-459"><span class="linenos">459</span></a>
</span><span id="GAMRegressor-460"><a href="#GAMRegressor-460"><span class="linenos">460</span></a><span class="sd">        Parameters:</span>
</span><span id="GAMRegressor-461"><a href="#GAMRegressor-461"><span class="linenos">461</span></a><span class="sd">        -----------</span>
</span><span id="GAMRegressor-462"><a href="#GAMRegressor-462"><span class="linenos">462</span></a><span class="sd">            X: np.array</span>
</span><span id="GAMRegressor-463"><a href="#GAMRegressor-463"><span class="linenos">463</span></a><span class="sd">                The independent variables.</span>
</span><span id="GAMRegressor-464"><a href="#GAMRegressor-464"><span class="linenos">464</span></a>
</span><span id="GAMRegressor-465"><a href="#GAMRegressor-465"><span class="linenos">465</span></a><span class="sd">        Returns:</span>
</span><span id="GAMRegressor-466"><a href="#GAMRegressor-466"><span class="linenos">466</span></a><span class="sd">        --------</span>
</span><span id="GAMRegressor-467"><a href="#GAMRegressor-467"><span class="linenos">467</span></a><span class="sd">            ypred: np.array</span>
</span><span id="GAMRegressor-468"><a href="#GAMRegressor-468"><span class="linenos">468</span></a><span class="sd">                The predicted output.</span>
</span><span id="GAMRegressor-469"><a href="#GAMRegressor-469"><span class="linenos">469</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-470"><a href="#GAMRegressor-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="GAMRegressor-471"><a href="#GAMRegressor-471"><span class="linenos">471</span></a>
</span><span id="GAMRegressor-472"><a href="#GAMRegressor-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="GAMRegressor-473"><a href="#GAMRegressor-473"><span class="linenos">473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-474"><a href="#GAMRegressor-474"><span class="linenos">474</span></a><span class="sd">        Get the parameters of the model.</span>
</span><span id="GAMRegressor-475"><a href="#GAMRegressor-475"><span class="linenos">475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-476"><a href="#GAMRegressor-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span> <span class="s2">&quot;n_splines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">,</span> <span class="s2">&quot;lam&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">}</span>
</span><span id="GAMRegressor-477"><a href="#GAMRegressor-477"><span class="linenos">477</span></a>
</span><span id="GAMRegressor-478"><a href="#GAMRegressor-478"><span class="linenos">478</span></a>    <span class="k">def</span> <span class="nf">get_pygam_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GAMRegressor-479"><a href="#GAMRegressor-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-480"><a href="#GAMRegressor-480"><span class="linenos">480</span></a><span class="sd">        Get the pyGAM model.</span>
</span><span id="GAMRegressor-481"><a href="#GAMRegressor-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-482"><a href="#GAMRegressor-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="GAMRegressor-483"><a href="#GAMRegressor-483"><span class="linenos">483</span></a>    
</span><span id="GAMRegressor-484"><a href="#GAMRegressor-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="GAMRegressor-485"><a href="#GAMRegressor-485"><span class="linenos">485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor-486"><a href="#GAMRegressor-486"><span class="linenos">486</span></a><span class="sd">        Set the parameters of the model.</span>
</span><span id="GAMRegressor-487"><a href="#GAMRegressor-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor-488"><a href="#GAMRegressor-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GAMRegressor-489"><a href="#GAMRegressor-489"><span class="linenos">489</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="GAMRegressor-490"><a href="#GAMRegressor-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>A wrapper class to define a Generalized Additive Model (GAM) regressor using pyGAM.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>model_type: str, default='linear'
The type of model to use for curve fitting. Options: 'linear', 'logistic', 'gamma'.</li>
<li>n_splines: int, default=25
The number of splines to use in the model.</li>
<li>lam: float, default=0.6
The regularization parameter to use in the model.</li>
</ul>

<h2 id="methods">Methods:</h2>

<ul>
<li>fit(X, y): Fit the GAM model to the data.</li>
<li>predict(X): Predict the output using the fitted model.</li>
<li>get_params(): Get the parameters of the model.</li>
<li>get_pygam_model(): Get the pyGAM model.</li>
<li>set_params(**parameters): Set the parameters of the model.</li>
</ul>

<h2 id="raises">Raises:</h2>

<ul>
<li>AssertionError: If the model type is not one of 'linear', 'logistic', or 'gamma'.</li>
</ul>
</div>


                            <div id="GAMRegressor.__init__" class="classattr">
                                        <input id="GAMRegressor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GAMRegressor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span>, </span><span class="param"><span class="n">n_splines</span><span class="o">=</span><span class="mi">25</span>, </span><span class="param"><span class="n">lam</span><span class="o">=</span><span class="mf">0.6</span></span>)</span>

                <label class="view-source-button" for="GAMRegressor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.__init__-425"><a href="#GAMRegressor.__init__-425"><span class="linenos">425</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="GAMRegressor.__init__-426"><a href="#GAMRegressor.__init__-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
</span><span id="GAMRegressor.__init__-427"><a href="#GAMRegressor.__init__-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span> <span class="o">=</span> <span class="n">n_splines</span>
</span><span id="GAMRegressor.__init__-428"><a href="#GAMRegressor.__init__-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span> <span class="o">=</span> <span class="n">lam</span>
</span><span id="GAMRegressor.__init__-429"><a href="#GAMRegressor.__init__-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="GAMRegressor.fit" class="classattr">
                                        <input id="GAMRegressor.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">X</span>, </span><span class="param"><span class="n">y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GAMRegressor.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.fit-431"><a href="#GAMRegressor.fit-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="GAMRegressor.fit-432"><a href="#GAMRegressor.fit-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor.fit-433"><a href="#GAMRegressor.fit-433"><span class="linenos">433</span></a><span class="sd">        Fit the GAM model to the data.</span>
</span><span id="GAMRegressor.fit-434"><a href="#GAMRegressor.fit-434"><span class="linenos">434</span></a>
</span><span id="GAMRegressor.fit-435"><a href="#GAMRegressor.fit-435"><span class="linenos">435</span></a><span class="sd">        Parameters:</span>
</span><span id="GAMRegressor.fit-436"><a href="#GAMRegressor.fit-436"><span class="linenos">436</span></a><span class="sd">        -----------</span>
</span><span id="GAMRegressor.fit-437"><a href="#GAMRegressor.fit-437"><span class="linenos">437</span></a><span class="sd">            X: np.array</span>
</span><span id="GAMRegressor.fit-438"><a href="#GAMRegressor.fit-438"><span class="linenos">438</span></a><span class="sd">                The independent variables.</span>
</span><span id="GAMRegressor.fit-439"><a href="#GAMRegressor.fit-439"><span class="linenos">439</span></a><span class="sd">            y: np.array</span>
</span><span id="GAMRegressor.fit-440"><a href="#GAMRegressor.fit-440"><span class="linenos">440</span></a><span class="sd">                The dependent variable.</span>
</span><span id="GAMRegressor.fit-441"><a href="#GAMRegressor.fit-441"><span class="linenos">441</span></a>
</span><span id="GAMRegressor.fit-442"><a href="#GAMRegressor.fit-442"><span class="linenos">442</span></a><span class="sd">        Returns:</span>
</span><span id="GAMRegressor.fit-443"><a href="#GAMRegressor.fit-443"><span class="linenos">443</span></a><span class="sd">        --------</span>
</span><span id="GAMRegressor.fit-444"><a href="#GAMRegressor.fit-444"><span class="linenos">444</span></a><span class="sd">            self: GAMRegressor</span>
</span><span id="GAMRegressor.fit-445"><a href="#GAMRegressor.fit-445"><span class="linenos">445</span></a><span class="sd">                The fitted GAM model.</span>
</span><span id="GAMRegressor.fit-446"><a href="#GAMRegressor.fit-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor.fit-447"><a href="#GAMRegressor.fit-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor.fit-448"><a href="#GAMRegressor.fit-448"><span class="linenos">448</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LinearGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor.fit-449"><a href="#GAMRegressor.fit-449"><span class="linenos">449</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;logistic&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor.fit-450"><a href="#GAMRegressor.fit-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">LogisticGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor.fit-451"><a href="#GAMRegressor.fit-451"><span class="linenos">451</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span>
</span><span id="GAMRegressor.fit-452"><a href="#GAMRegressor.fit-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">GammaGAM</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_splines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">),</span> <span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="GAMRegressor.fit-453"><a href="#GAMRegressor.fit-453"><span class="linenos">453</span></a>        <span class="c1"># Add additional model types as needed</span>
</span><span id="GAMRegressor.fit-454"><a href="#GAMRegressor.fit-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Fit the GAM model to the data.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>X: np.array
    The independent variables.
y: np.array
    The dependent variable.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>self: GAMRegressor
    The fitted GAM model.
</code></pre>
</div>


                            </div>
                            <div id="GAMRegressor.predict" class="classattr">
                                        <input id="GAMRegressor.predict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">predict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">X</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GAMRegressor.predict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.predict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.predict-456"><a href="#GAMRegressor.predict-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="GAMRegressor.predict-457"><a href="#GAMRegressor.predict-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor.predict-458"><a href="#GAMRegressor.predict-458"><span class="linenos">458</span></a><span class="sd">        Predict the output using the fitted model.</span>
</span><span id="GAMRegressor.predict-459"><a href="#GAMRegressor.predict-459"><span class="linenos">459</span></a>
</span><span id="GAMRegressor.predict-460"><a href="#GAMRegressor.predict-460"><span class="linenos">460</span></a><span class="sd">        Parameters:</span>
</span><span id="GAMRegressor.predict-461"><a href="#GAMRegressor.predict-461"><span class="linenos">461</span></a><span class="sd">        -----------</span>
</span><span id="GAMRegressor.predict-462"><a href="#GAMRegressor.predict-462"><span class="linenos">462</span></a><span class="sd">            X: np.array</span>
</span><span id="GAMRegressor.predict-463"><a href="#GAMRegressor.predict-463"><span class="linenos">463</span></a><span class="sd">                The independent variables.</span>
</span><span id="GAMRegressor.predict-464"><a href="#GAMRegressor.predict-464"><span class="linenos">464</span></a>
</span><span id="GAMRegressor.predict-465"><a href="#GAMRegressor.predict-465"><span class="linenos">465</span></a><span class="sd">        Returns:</span>
</span><span id="GAMRegressor.predict-466"><a href="#GAMRegressor.predict-466"><span class="linenos">466</span></a><span class="sd">        --------</span>
</span><span id="GAMRegressor.predict-467"><a href="#GAMRegressor.predict-467"><span class="linenos">467</span></a><span class="sd">            ypred: np.array</span>
</span><span id="GAMRegressor.predict-468"><a href="#GAMRegressor.predict-468"><span class="linenos">468</span></a><span class="sd">                The predicted output.</span>
</span><span id="GAMRegressor.predict-469"><a href="#GAMRegressor.predict-469"><span class="linenos">469</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor.predict-470"><a href="#GAMRegressor.predict-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Predict the output using the fitted model.</p>

<h2 id="parameters">Parameters:</h2>

<pre><code>X: np.array
    The independent variables.
</code></pre>

<h2 id="returns">Returns:</h2>

<pre><code>ypred: np.array
    The predicted output.
</code></pre>
</div>


                            </div>
                            <div id="GAMRegressor.get_params" class="classattr">
                                        <input id="GAMRegressor.get_params-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_params</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">deep</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GAMRegressor.get_params-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.get_params"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.get_params-472"><a href="#GAMRegressor.get_params-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="GAMRegressor.get_params-473"><a href="#GAMRegressor.get_params-473"><span class="linenos">473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor.get_params-474"><a href="#GAMRegressor.get_params-474"><span class="linenos">474</span></a><span class="sd">        Get the parameters of the model.</span>
</span><span id="GAMRegressor.get_params-475"><a href="#GAMRegressor.get_params-475"><span class="linenos">475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor.get_params-476"><a href="#GAMRegressor.get_params-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span> <span class="s2">&quot;n_splines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_splines</span><span class="p">,</span> <span class="s2">&quot;lam&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lam</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Get the parameters of the model.</p>
</div>


                            </div>
                            <div id="GAMRegressor.get_pygam_model" class="classattr">
                                        <input id="GAMRegressor.get_pygam_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pygam_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GAMRegressor.get_pygam_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.get_pygam_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.get_pygam_model-478"><a href="#GAMRegressor.get_pygam_model-478"><span class="linenos">478</span></a>    <span class="k">def</span> <span class="nf">get_pygam_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GAMRegressor.get_pygam_model-479"><a href="#GAMRegressor.get_pygam_model-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor.get_pygam_model-480"><a href="#GAMRegressor.get_pygam_model-480"><span class="linenos">480</span></a><span class="sd">        Get the pyGAM model.</span>
</span><span id="GAMRegressor.get_pygam_model-481"><a href="#GAMRegressor.get_pygam_model-481"><span class="linenos">481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor.get_pygam_model-482"><a href="#GAMRegressor.get_pygam_model-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span></pre></div>


            <div class="docstring"><p>Get the pyGAM model.</p>
</div>


                            </div>
                            <div id="GAMRegressor.set_params" class="classattr">
                                        <input id="GAMRegressor.set_params-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_params</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">parameters</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GAMRegressor.set_params-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GAMRegressor.set_params"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GAMRegressor.set_params-484"><a href="#GAMRegressor.set_params-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
</span><span id="GAMRegressor.set_params-485"><a href="#GAMRegressor.set_params-485"><span class="linenos">485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GAMRegressor.set_params-486"><a href="#GAMRegressor.set_params-486"><span class="linenos">486</span></a><span class="sd">        Set the parameters of the model.</span>
</span><span id="GAMRegressor.set_params-487"><a href="#GAMRegressor.set_params-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GAMRegressor.set_params-488"><a href="#GAMRegressor.set_params-488"><span class="linenos">488</span></a>        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GAMRegressor.set_params-489"><a href="#GAMRegressor.set_params-489"><span class="linenos">489</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="GAMRegressor.set_params-490"><a href="#GAMRegressor.set_params-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Set the parameters of the model.</p>
</div>


                            </div>
                            <div id="GAMRegressor.set_score_request" class="classattr">
                                <div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_score_request</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unknown</span></span><span class="return-annotation">):</span></span>

        
    </div>
    <a class="headerlink" href="#GAMRegressor.set_score_request"></a>
    
            <div class="docstring"><p>A descriptor for request methods.</p>

<p><em>New in version 1.3.</em></p>

<h2 id="parameters">Parameters</h2>

<p>name : str
    The name of the method for which the request function should be
    created, e.g. <code>"fit"</code> would create a <code>set_fit_request</code> function.</p>

<p>keys : list of str
    A list of strings which are accepted parameters by the created
    function, e.g. <code>["sample_weight"]</code> if the corresponding method
    accepts it as a metadata.</p>

<p>validate_keys : bool, default=True
    Whether to check if the requested parameters fit the actual parameters
    of the method.</p>

<h2 id="notes">Notes</h2>

<p>This class is a descriptor <sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup> and uses PEP-362 to set the signature of
the returned function <sup class="footnote-ref" id="fnref-2"><a href="#fn-2">2</a></sup>.</p>

<h2 id="references">References</h2>

<div class="footnotes">
<hr />
<ol>
<li id="fn-1">
<p><a href="https://docs.python.org/3/howto/descriptor.html">https://docs.python.org/3/howto/descriptor.html</a>&#160;<a href="#fnref-1" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">&#8617;</a></p>
</li>

<li id="fn-2">
<p><a href="https://www.python.org/dev/peps/pep-0362/">https://www.python.org/dev/peps/pep-0362/</a>&#160;<a href="#fnref-2" class="footnoteBackLink" title="Jump back to footnote 2 in the text.">&#8617;</a></p>
</li>
</ol>
</div>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>sklearn.utils._metadata_requests._MetadataRequester</dt>
                                <dd id="GAMRegressor.get_metadata_routing" class="function">get_metadata_routing</dd>

            </div>
            <div><dt>sklearn.base.RegressorMixin</dt>
                                <dd id="GAMRegressor.score" class="function">score</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>